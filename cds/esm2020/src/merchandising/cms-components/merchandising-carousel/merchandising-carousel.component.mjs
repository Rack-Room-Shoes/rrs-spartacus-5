/*
 * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component } from '@angular/core';
import { of, using } from 'rxjs';
import { distinctUntilKeyChanged, filter, map, shareReplay, switchMap, switchMapTo, take, tap, } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@spartacus/storefront";
import * as i2 from "./merchandising-carousel.component.service";
import * as i3 from "@spartacus/core";
import * as i4 from "@angular/common";
import * as i5 from "../directives/attributes/attributes.directive";
import * as i6 from "@angular/router";
export class MerchandisingCarouselComponent {
    constructor(componentData, merchandisingCarouselComponentService, routingService, intersectionService, el) {
        this.componentData = componentData;
        this.merchandisingCarouselComponentService = merchandisingCarouselComponentService;
        this.routingService = routingService;
        this.intersectionService = intersectionService;
        this.el = el;
        this.fetchProducts$ = this.componentData.data$.pipe(filter((data) => Boolean(data)), distinctUntilKeyChanged('strategy'), switchMap((data) => this.merchandisingCarouselComponentService.getMerchandisingCarouselModel(data)), tap((data) => {
            if (typeof data.backgroundColor === 'string') {
                this.el.nativeElement.style.setProperty('--cx-color-background', data.backgroundColor);
            }
            if (typeof data.textColor === 'string') {
                this.el.nativeElement.style.setProperty('--cx-color-text', data.textColor);
            }
        }), shareReplay({ bufferSize: 1, refCount: true }));
        this.intersection$ = this.fetchProducts$.pipe(take(1), switchMapTo(this.routingService.getPageContext().pipe(switchMapTo(this.componentData.data$), map((data) => this.merchandisingCarouselComponentService.getMerchandisingCaourselViewportThreshold(data)), switchMap((threshold) => this.intersectionService
            .isIntersected(this.el.nativeElement, {
            threshold,
        })
            .pipe(filter((carouselIsVisible) => carouselIsVisible), switchMap((_) => {
            return this.merchandisingCarouselComponentService
                .sendCarouselViewEvent(this.lastEventModelId, this.fetchProducts$)
                .pipe(tap((model) => {
                this.lastEventModelId = model.id;
            }), switchMapTo(of()));
        }))))));
        this.merchandisingCarouselModel$ = using(() => this.intersection$.subscribe(), () => this.fetchProducts$);
        this.lastEventModelId = '';
    }
    onMerchandisingCarouselItemClick(merchandisingCarouselModel, clickedProduct) {
        this.merchandisingCarouselComponentService.sendCarouselItemClickedEvent(merchandisingCarouselModel, clickedProduct);
    }
}
MerchandisingCarouselComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: MerchandisingCarouselComponent, deps: [{ token: i1.CmsComponentData }, { token: i2.MerchandisingCarouselComponentService }, { token: i3.RoutingService }, { token: i1.IntersectionService }, { token: i0.ElementRef }], target: i0.ɵɵFactoryTarget.Component });
MerchandisingCarouselComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.2.3", type: MerchandisingCarouselComponent, selector: "cx-merchandising-carousel", ngImport: i0, template: "<ng-container\n  *ngIf=\"merchandisingCarouselModel$ | async as merchandisingCarouselModel\"\n>\n  <div\n    class=\"data-cx-merchandising-carousel\"\n    [cxAttributes]=\"merchandisingCarouselModel.metadata\"\n    [cxAttributesNamePrefix]=\"'data-cx-merchandising-carousel'\"\n  ></div>\n  <cx-carousel\n    [items]=\"merchandisingCarouselModel.items$\"\n    [title]=\"merchandisingCarouselModel.title\"\n    [template]=\"carouselItem\"\n    itemWidth=\"285px\"\n  >\n  </cx-carousel>\n\n  <ng-template #carouselItem let-item=\"item\">\n    <div\n      class=\"data-cx-merchandising-product\"\n      [cxAttributes]=\"item.metadata\"\n      [cxAttributesNamePrefix]=\"'data-cx-merchandising-product'\"\n    ></div>\n    <a\n      tabindex=\"0\"\n      [routerLink]=\"{ cxRoute: 'product', params: item } | cxUrl\"\n      (click)=\"\n        onMerchandisingCarouselItemClick(merchandisingCarouselModel, item)\n      \"\n    >\n      <cx-media\n        *ngIf=\"item.images?.PRIMARY\"\n        [container]=\"item.images.PRIMARY\"\n        format=\"product\"\n      >\n      </cx-media>\n      <h4>{{ item.name }}</h4>\n      <div class=\"price\">\n        {{ item.price?.formattedValue }}\n      </div>\n      <div class=\"price\" *ngIf=\"item.stock?.stockLevel > 0; else outOfStock\">\n        {{ item.stock?.stockLevelStatus }} : {{ item.stock?.stockLevel }}\n      </div>\n      <ng-template #outOfStock>\n        <div class=\"price\">\n          {{ item.stock?.stockLevelStatus }}\n        </div>\n      </ng-template>\n    </a>\n  </ng-template>\n</ng-container>\n", dependencies: [{ kind: "directive", type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i5.AttributesDirective, selector: "[cxAttributes]", inputs: ["cxAttributes", "cxAttributesNamePrefix"] }, { kind: "component", type: i1.CarouselComponent, selector: "cx-carousel", inputs: ["title", "items", "template", "itemWidth", "hideIndicators", "indicatorIcon", "previousIcon", "nextIcon"] }, { kind: "component", type: i1.MediaComponent, selector: "cx-media", inputs: ["container", "format", "alt", "role", "loading"], outputs: ["loaded"] }, { kind: "directive", type: i6.RouterLinkWithHref, selector: "a[routerLink],area[routerLink]", inputs: ["target", "queryParams", "fragment", "queryParamsHandling", "state", "relativeTo", "preserveFragment", "skipLocationChange", "replaceUrl", "routerLink"] }, { kind: "pipe", type: i4.AsyncPipe, name: "async" }, { kind: "pipe", type: i3.UrlPipe, name: "cxUrl" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: MerchandisingCarouselComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-merchandising-carousel', changeDetection: ChangeDetectionStrategy.OnPush, template: "<ng-container\n  *ngIf=\"merchandisingCarouselModel$ | async as merchandisingCarouselModel\"\n>\n  <div\n    class=\"data-cx-merchandising-carousel\"\n    [cxAttributes]=\"merchandisingCarouselModel.metadata\"\n    [cxAttributesNamePrefix]=\"'data-cx-merchandising-carousel'\"\n  ></div>\n  <cx-carousel\n    [items]=\"merchandisingCarouselModel.items$\"\n    [title]=\"merchandisingCarouselModel.title\"\n    [template]=\"carouselItem\"\n    itemWidth=\"285px\"\n  >\n  </cx-carousel>\n\n  <ng-template #carouselItem let-item=\"item\">\n    <div\n      class=\"data-cx-merchandising-product\"\n      [cxAttributes]=\"item.metadata\"\n      [cxAttributesNamePrefix]=\"'data-cx-merchandising-product'\"\n    ></div>\n    <a\n      tabindex=\"0\"\n      [routerLink]=\"{ cxRoute: 'product', params: item } | cxUrl\"\n      (click)=\"\n        onMerchandisingCarouselItemClick(merchandisingCarouselModel, item)\n      \"\n    >\n      <cx-media\n        *ngIf=\"item.images?.PRIMARY\"\n        [container]=\"item.images.PRIMARY\"\n        format=\"product\"\n      >\n      </cx-media>\n      <h4>{{ item.name }}</h4>\n      <div class=\"price\">\n        {{ item.price?.formattedValue }}\n      </div>\n      <div class=\"price\" *ngIf=\"item.stock?.stockLevel > 0; else outOfStock\">\n        {{ item.stock?.stockLevelStatus }} : {{ item.stock?.stockLevel }}\n      </div>\n      <ng-template #outOfStock>\n        <div class=\"price\">\n          {{ item.stock?.stockLevelStatus }}\n        </div>\n      </ng-template>\n    </a>\n  </ng-template>\n</ng-container>\n" }]
        }], ctorParameters: function () { return [{ type: i1.CmsComponentData }, { type: i2.MerchandisingCarouselComponentService }, { type: i3.RoutingService }, { type: i1.IntersectionService }, { type: i0.ElementRef }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVyY2hhbmRpc2luZy1jYXJvdXNlbC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9pbnRlZ3JhdGlvbi1saWJzL2Nkcy9zcmMvbWVyY2hhbmRpc2luZy9jbXMtY29tcG9uZW50cy9tZXJjaGFuZGlzaW5nLWNhcm91c2VsL21lcmNoYW5kaXNpbmctY2Fyb3VzZWwuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vaW50ZWdyYXRpb24tbGlicy9jZHMvc3JjL21lcmNoYW5kaXNpbmcvY21zLWNvbXBvbmVudHMvbWVyY2hhbmRpc2luZy1jYXJvdXNlbC9tZXJjaGFuZGlzaW5nLWNhcm91c2VsLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0dBSUc7QUFFSCxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsU0FBUyxFQUFjLE1BQU0sZUFBZSxDQUFDO0FBRy9FLE9BQU8sRUFBYyxFQUFFLEVBQUUsS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzdDLE9BQU8sRUFDTCx1QkFBdUIsRUFDdkIsTUFBTSxFQUNOLEdBQUcsRUFDSCxXQUFXLEVBQ1gsU0FBUyxFQUNULFdBQVcsRUFDWCxJQUFJLEVBQ0osR0FBRyxHQUNKLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7O0FBV3hCLE1BQU0sT0FBTyw4QkFBOEI7SUFHekMsWUFDWSxhQUFrRSxFQUNsRSxxQ0FBNEUsRUFDNUUsY0FBOEIsRUFDOUIsbUJBQXdDLEVBQ3hDLEVBQWM7UUFKZCxrQkFBYSxHQUFiLGFBQWEsQ0FBcUQ7UUFDbEUsMENBQXFDLEdBQXJDLHFDQUFxQyxDQUF1QztRQUM1RSxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQjtRQUN4QyxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBS2xCLG1CQUFjLEdBQ3BCLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxD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LypcbiAqIFNQRFgtRmlsZUNvcHlyaWdodFRleHQ6IDIwMjIgU0FQIFNwYXJ0YWN1cyB0ZWFtIDxzcGFydGFjdXMtdGVhbUBzYXAuY29tPlxuICpcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHsgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENvbXBvbmVudCwgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUm91dGluZ1NlcnZpY2UgfSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgQ21zQ29tcG9uZW50RGF0YSwgSW50ZXJzZWN0aW9uU2VydmljZSB9IGZyb20gJ0BzcGFydGFjdXMvc3RvcmVmcm9udCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBvZiwgdXNpbmcgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7XG4gIGRpc3RpbmN0VW50aWxLZXlDaGFuZ2VkLFxuICBmaWx0ZXIsXG4gIG1hcCxcbiAgc2hhcmVSZXBsYXksXG4gIHN3aXRjaE1hcCxcbiAgc3dpdGNoTWFwVG8sXG4gIHRha2UsXG4gIHRhcCxcbn0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQ21zTWVyY2hhbmRpc2luZ0Nhcm91c2VsQ29tcG9uZW50IH0gZnJvbSAnLi4vLi4vLi4vY2RzLW1vZGVscy9jbXMubW9kZWwnO1xuaW1wb3J0IHsgTWVyY2hhbmRpc2luZ1Byb2R1Y3QgfSBmcm9tICcuLi8uLi9tb2RlbC9pbmRleCc7XG5pbXBvcnQgeyBNZXJjaGFuZGlzaW5nQ2Fyb3VzZWxDb21wb25lbnRTZXJ2aWNlIH0gZnJvbSAnLi9tZXJjaGFuZGlzaW5nLWNhcm91c2VsLmNvbXBvbmVudC5zZXJ2aWNlJztcbmltcG9ydCB7IE1lcmNoYW5kaXNpbmdDYXJvdXNlbE1vZGVsIH0gZnJvbSAnLi9tb2RlbC9pbmRleCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2N4LW1lcmNoYW5kaXNpbmctY2Fyb3VzZWwnLFxuICB0ZW1wbGF0ZVVybDogJy4vbWVyY2hhbmRpc2luZy1jYXJvdXNlbC5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBNZXJjaGFuZGlzaW5nQ2Fyb3VzZWxDb21wb25lbnQge1xuICBwcm90ZWN0ZWQgbGFzdEV2ZW50TW9kZWxJZDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb3RlY3RlZCBjb21wb25lbnREYXRhOiBDbXNDb21wb25lbnREYXRhPENtc01lcmNoYW5kaXNpbmdDYXJvdXNlbENvbXBvbmVudD4sXG4gICAgcHJvdGVjdGVkIG1lcmNoYW5kaXNpbmdDYXJvdXNlbENvbXBvbmVudFNlcnZpY2U6IE1lcmNoYW5kaXNpbmdDYXJvdXNlbENvbXBvbmVudFNlcnZpY2UsXG4gICAgcHJvdGVjdGVkIHJvdXRpbmdTZXJ2aWNlOiBSb3V0aW5nU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgaW50ZXJzZWN0aW9uU2VydmljZTogSW50ZXJzZWN0aW9uU2VydmljZSxcbiAgICBwcm90ZWN0ZWQgZWw6IEVsZW1lbnRSZWZcbiAgKSB7XG4gICAgdGhpcy5sYXN0RXZlbnRNb2RlbElkID0gJyc7XG4gIH1cblxuICBwcml2YXRlIGZldGNoUHJvZHVjdHMkOiBPYnNlcnZhYmxlPE1lcmNoYW5kaXNpbmdDYXJvdXNlbE1vZGVsPiA9XG4gICAgdGhpcy5jb21wb25lbnREYXRhLmRhdGEkLnBpcGUoXG4gICAgICBmaWx0ZXIoKGRhdGEpID0+IEJvb2xlYW4oZGF0YSkpLFxuICAgICAgZGlzdGluY3RVbnRpbEtleUNoYW5nZWQoJ3N0cmF0ZWd5JyksXG4gICAgICBzd2l0Y2hNYXAoKGRhdGEpID0+XG4gICAgICAgIHRoaXMubWVyY2hhbmRpc2luZ0Nhcm91c2VsQ29tcG9uZW50U2VydmljZS5nZXRNZXJjaGFuZGlzaW5nQ2Fyb3VzZWxNb2RlbChcbiAgICAgICAgICBkYXRhXG4gICAgICAgIClcbiAgICAgICksXG4gICAgICB0YXAoKGRhdGEpID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiBkYXRhLmJhY2tncm91bmRDb2xvciA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoXG4gICAgICAgICAgICAnLS1jeC1jb2xvci1iYWNrZ3JvdW5kJyxcbiAgICAgICAgICAgIGRhdGEuYmFja2dyb3VuZENvbG9yXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGRhdGEudGV4dENvbG9yID09PSAnc3RyaW5nJykge1xuICAgICAgICAgIHRoaXMuZWwubmF0aXZlRWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eShcbiAgICAgICAgICAgICctLWN4LWNvbG9yLXRleHQnLFxuICAgICAgICAgICAgZGF0YS50ZXh0Q29sb3JcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9KSxcbiAgICAgIHNoYXJlUmVwbGF5KHsgYnVmZmVyU2l6ZTogMSwgcmVmQ291bnQ6IHRydWUgfSlcbiAgICApO1xuXG4gIHByaXZhdGUgaW50ZXJzZWN0aW9uJDogT2JzZXJ2YWJsZTx2b2lkPiA9IHRoaXMuZmV0Y2hQcm9kdWN0cyQucGlwZShcbiAgICB0YWtlKDEpLFxuICAgIHN3aXRjaE1hcFRvKFxuICAgICAgdGhpcy5yb3V0aW5nU2VydmljZS5nZXRQYWdlQ29udGV4dCgpLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcFRvKHRoaXMuY29tcG9uZW50RGF0YS5kYXRhJCksXG4gICAgICAgIG1hcCgoZGF0YSkgPT5cbiAgICAgICAgICB0aGlzLm1lcmNoYW5kaXNpbmdDYXJvdXNlbENvbXBvbmVudFNlcnZpY2UuZ2V0TWVyY2hhbmRpc2luZ0Nhb3Vyc2VsVmlld3BvcnRUaHJlc2hvbGQoXG4gICAgICAgICAgICBkYXRhXG4gICAgICAgICAgKVxuICAgICAgICApLFxuICAgICAgICBzd2l0Y2hNYXAoKHRocmVzaG9sZCkgPT5cbiAgICAgICAgICB0aGlzLmludGVyc2VjdGlvblNlcnZpY2VcbiAgICAgICAgICAgIC5pc0ludGVyc2VjdGVkKHRoaXMuZWwubmF0aXZlRWxlbWVudCwge1xuICAgICAgICAgICAgICB0aHJlc2hvbGQsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgIGZpbHRlcigoY2Fyb3VzZWxJc1Zpc2libGUpID0+IGNhcm91c2VsSXNWaXNpYmxlKSxcbiAgICAgICAgICAgICAgc3dpdGNoTWFwKChfKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubWVyY2hhbmRpc2luZ0Nhcm91c2VsQ29tcG9uZW50U2VydmljZVxuICAgICAgICAgICAgICAgICAgLnNlbmRDYXJvdXNlbFZpZXdFdmVudChcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sYXN0RXZlbnRNb2RlbElkLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmZldGNoUHJvZHVjdHMkXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICAgICAgdGFwKChtb2RlbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGFzdEV2ZW50TW9kZWxJZCA9IG1vZGVsLmlkO1xuICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoTWFwVG8ob2YoKSlcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgbWVyY2hhbmRpc2luZ0Nhcm91c2VsTW9kZWwkID0gdXNpbmcoXG4gICAgKCkgPT4gdGhpcy5pbnRlcnNlY3Rpb24kLnN1YnNjcmliZSgpLFxuICAgICgpID0+IHRoaXMuZmV0Y2hQcm9kdWN0cyRcbiAgKTtcblxuICBvbk1lcmNoYW5kaXNpbmdDYXJvdXNlbEl0ZW1DbGljayhcbiAgICBtZXJjaGFuZGlzaW5nQ2Fyb3VzZWxNb2RlbDogTWVyY2hhbmRpc2luZ0Nhcm91c2VsTW9kZWwsXG4gICAgY2xpY2tlZFByb2R1Y3Q6IE1lcmNoYW5kaXNpbmdQcm9kdWN0XG4gICk6IHZvaWQge1xuICAgIHRoaXMubWVyY2hhbmRpc2luZ0Nhcm91c2VsQ29tcG9uZW50U2VydmljZS5zZW5kQ2Fyb3VzZWxJdGVtQ2xpY2tlZEV2ZW50KFxuICAgICAgbWVyY2hhbmRpc2luZ0Nhcm91c2VsTW9kZWwsXG4gICAgICBjbGlja2VkUHJvZHVjdFxuICAgICk7XG4gIH1cbn1cbiIsIjxuZy1jb250YWluZXJcbiAgKm5nSWY9XCJtZXJjaGFuZGlzaW5nQ2Fyb3VzZWxNb2RlbCQgfCBhc3luYyBhcyBtZXJjaGFuZGlzaW5nQ2Fyb3VzZWxNb2RlbFwiXG4+XG4gIDxkaXZcbiAgICBjbGFzcz1cImRhdGEtY3gtbWVyY2hhbmRpc2luZy1jYXJvdXNlbFwiXG4gICAgW2N4QXR0cmlidXRlc109XCJtZXJjaGFuZGlzaW5nQ2Fyb3VzZWxNb2RlbC5tZXRhZGF0YVwiXG4gICAgW2N4QXR0cmlidXRlc05hbWVQcmVmaXhdPVwiJ2RhdGEtY3gtbWVyY2hhbmRpc2luZy1jYXJvdXNlbCdcIlxuICA+PC9kaXY+XG4gIDxjeC1jYXJvdXNlbFxuICAgIFtpdGVtc109XCJtZXJjaGFuZGlzaW5nQ2Fyb3VzZWxNb2RlbC5pdGVtcyRcIlxuICAgIFt0aXRsZV09XCJtZXJjaGFuZGlzaW5nQ2Fyb3VzZWxNb2RlbC50aXRsZVwiXG4gICAgW3RlbXBsYXRlXT1cImNhcm91c2VsSXRlbVwiXG4gICAgaXRlbVdpZHRoPVwiMjg1cHhcIlxuICA+XG4gIDwvY3gtY2Fyb3VzZWw+XG5cbiAgPG5nLXRlbXBsYXRlICNjYXJvdXNlbEl0ZW0gbGV0LWl0ZW09XCJpdGVtXCI+XG4gICAgPGRpdlxuICAgICAgY2xhc3M9XCJkYXRhLWN4LW1lcmNoYW5kaXNpbmctcHJvZHVjdFwiXG4gICAgICBbY3hBdHRyaWJ1dGVzXT1cIml0ZW0ubWV0YWRhdGFcIlxuICAgICAgW2N4QXR0cmlidXRlc05hbWVQcmVmaXhdPVwiJ2RhdGEtY3gtbWVyY2hhbmRpc2luZy1wcm9kdWN0J1wiXG4gICAgPjwvZGl2PlxuICAgIDxhXG4gICAgICB0YWJpbmRleD1cIjBcIlxuICAgICAgW3JvdXRlckxpbmtdPVwieyBjeFJvdXRlOiAncHJvZHVjdCcsIHBhcmFtczogaXRlbSB9IHwgY3hVcmxcIlxuICAgICAgKGNsaWNrKT1cIlxuICAgICAgICBvbk1lcmNoYW5kaXNpbmdDYXJvdXNlbEl0ZW1DbGljayhtZXJjaGFuZGlzaW5nQ2Fyb3VzZWxNb2RlbCwgaXRlbSlcbiAgICAgIFwiXG4gICAgPlxuICAgICAgPGN4LW1lZGlhXG4gICAgICAgICpuZ0lmPVwiaXRlbS5pbWFnZXM/LlBSSU1BUllcIlxuICAgICAgICBbY29udGFpbmVyXT1cIml0ZW0uaW1hZ2VzLlBSSU1BUllcIlxuICAgICAgICBmb3JtYXQ9XCJwcm9kdWN0XCJcbiAgICAgID5cbiAgICAgIDwvY3gtbWVkaWE+XG4gICAgICA8aDQ+e3sgaXRlbS5uYW1lIH19PC9oND5cbiAgICAgIDxkaXYgY2xhc3M9XCJwcmljZVwiPlxuICAgICAgICB7eyBpdGVtLnByaWNlPy5mb3JtYXR0ZWRWYWx1ZSB9fVxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzPVwicHJpY2VcIiAqbmdJZj1cIml0ZW0uc3RvY2s/LnN0b2NrTGV2ZWwgPiAwOyBlbHNlIG91dE9mU3RvY2tcIj5cbiAgICAgICAge3sgaXRlbS5zdG9jaz8uc3RvY2tMZXZlbFN0YXR1cyB9fSA6IHt7IGl0ZW0uc3RvY2s/LnN0b2NrTGV2ZWwgfX1cbiAgICAgIDwvZGl2PlxuICAgICAgPG5nLXRlbXBsYXRlICNvdXRPZlN0b2NrPlxuICAgICAgICA8ZGl2IGNsYXNzPVwicHJpY2VcIj5cbiAgICAgICAgICB7eyBpdGVtLnN0b2NrPy5zdG9ja0xldmVsU3RhdHVzIH19XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9uZy10ZW1wbGF0ZT5cbiAgICA8L2E+XG4gIDwvbmctdGVtcGxhdGU+XG48L25nLWNvbnRhaW5lcj5cbiJdfQ==