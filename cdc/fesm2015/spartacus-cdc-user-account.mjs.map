{"version":3,"file":"spartacus-cdc-user-account.mjs","sources":["../../../integration-libs/cdc/user-account/login-form/cdc-login-form-component.service.ts","../../../integration-libs/cdc/user-account/login-form/cdc-login-form.module.ts","../../../integration-libs/cdc/user-account/login-form/index.ts","../../../integration-libs/cdc/user-account/cdc-user-account.module.ts","../../../integration-libs/cdc/user-account/public_api.ts","../../../integration-libs/cdc/user-account/spartacus-cdc-user-account.ts"],"sourcesContent":["/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Injectable, OnDestroy } from '@angular/core';\nimport { CdcJsService } from '@spartacus/cdc/root';\nimport {\n  AuthService,\n  GlobalMessageService,\n  GlobalMessageType,\n  WindowRef,\n} from '@spartacus/core';\nimport { LoginFormComponentService } from '@spartacus/user/account/components';\nimport { Subscription } from 'rxjs';\n\n@Injectable()\nexport class CdcLoginFormComponentService\n  extends LoginFormComponentService\n  implements OnDestroy\n{\n  constructor(\n    protected auth: AuthService,\n    protected globalMessageService: GlobalMessageService,\n    protected winRef: WindowRef,\n    protected cdcJsService: CdcJsService\n  ) {\n    super(auth, globalMessageService, winRef);\n  }\n\n  protected subscription: Subscription = new Subscription();\n\n  login() {\n    if (!this.form.valid) {\n      this.form.markAllAsTouched();\n      return;\n    }\n\n    this.busy$.next(true);\n    this.subscription.add(\n      this.cdcJsService.didLoad().subscribe((cdcLoaded) => {\n        if (cdcLoaded) {\n          // Logging in using CDC Gigya SDK\n          this.cdcJsService\n            .loginUserWithoutScreenSet(\n              this.form.value.userId.toLowerCase(),\n              this.form.value.password\n            )\n            .subscribe({\n              next: () => this.busy$.next(false),\n              error: () => this.busy$.next(false),\n            });\n        } else {\n          // CDC Gigya SDK not loaded, show error to the user\n          this.globalMessageService.add(\n            {\n              key: 'errorHandlers.scriptFailedToLoad',\n            },\n            GlobalMessageType.MSG_TYPE_ERROR\n          );\n          this.busy$.next(false);\n        }\n      })\n    );\n  }\n\n  ngOnDestroy(): void {\n    this.subscription.unsubscribe();\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { RouterModule } from '@angular/router';\nimport { CdcJsService } from '@spartacus/cdc/root';\nimport {\n  AuthService,\n  CmsConfig,\n  GlobalMessageService,\n  I18nModule,\n  provideDefaultConfig,\n  UrlModule,\n  WindowRef,\n} from '@spartacus/core';\nimport { FormErrorsModule, SpinnerModule } from '@spartacus/storefront';\nimport {\n  LoginFormComponent,\n  LoginFormComponentService,\n} from '@spartacus/user/account/components';\nimport { CdcLoginFormComponentService } from './cdc-login-form-component.service';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    RouterModule,\n    UrlModule,\n    I18nModule,\n    FormErrorsModule,\n    SpinnerModule,\n  ],\n  providers: [\n    provideDefaultConfig(<CmsConfig>{\n      cmsComponents: {\n        ReturningCustomerLoginComponent: {\n          component: LoginFormComponent,\n          providers: [\n            {\n              provide: LoginFormComponentService,\n              useClass: CdcLoginFormComponentService,\n              deps: [\n                AuthService,\n                GlobalMessageService,\n                WindowRef,\n                CdcJsService,\n              ],\n            },\n          ],\n        },\n      },\n    }),\n  ],\n})\nexport class CDCLoginFormModule {}\n","/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport * from './cdc-login-form-component.service';\nexport * from './cdc-login-form.module';\n","/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { NgModule } from '@angular/core';\nimport { CDCLoginFormModule } from './login-form/cdc-login-form.module';\n\n@NgModule({\n  imports: [CDCLoginFormModule],\n})\nexport class CDCUserAccountModule {}\n","/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport * from './login-form/index';\nexport * from './cdc-user-account.module';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}