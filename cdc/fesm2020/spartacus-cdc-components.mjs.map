{"version":3,"file":"spartacus-cdc-components.mjs","sources":["../../../integration-libs/cdc/components/gigya-raas/gigya-raas.component.ts","../../../integration-libs/cdc/components/gigya-raas/gigya-raas.component.html","../../../integration-libs/cdc/components/gigya-raas/gigya-raas.module.ts","../../../integration-libs/cdc/components/cdc-components.module.ts","../../../integration-libs/cdc/components/gigya-raas/index.ts","../../../integration-libs/cdc/components/public_api.ts","../../../integration-libs/cdc/components/spartacus-cdc-components.ts"],"sourcesContent":["/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n  ChangeDetectionStrategy,\n  Component,\n  NgZone,\n  OnInit,\n  ViewEncapsulation,\n} from '@angular/core';\nimport { GigyaRaasComponentData } from '@spartacus/cdc/core';\nimport { CdcConfig, CdcJsService } from '@spartacus/cdc/root';\nimport { BaseSiteService, LanguageService, WindowRef } from '@spartacus/core';\nimport { CmsComponentData } from '@spartacus/storefront';\nimport { Observable } from 'rxjs';\nimport { distinctUntilChanged, take, tap } from 'rxjs/operators';\n\n@Component({\n  selector: 'cx-gigya-raas',\n  templateUrl: './gigya-raas.component.html',\n  styleUrls: ['./gigya-raas.component.scss'],\n  encapsulation: ViewEncapsulation.None,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class GigyaRaasComponent implements OnInit {\n  protected renderScreenSet = true;\n  language$: Observable<string>;\n  jsError$: Observable<boolean>;\n  jsLoaded$: Observable<boolean>;\n\n  public constructor(\n    public component: CmsComponentData<GigyaRaasComponentData>,\n    private baseSiteService: BaseSiteService,\n    private languageService: LanguageService,\n    private cdcConfig: CdcConfig,\n    private winRef: WindowRef,\n    private cdcJSService: CdcJsService,\n    private zone: NgZone\n  ) {}\n\n  ngOnInit(): void {\n    this.jsLoaded$ = this.cdcJSService.didLoad();\n    this.jsError$ = this.cdcJSService.didScriptFailToLoad();\n    this.language$ = this.languageService.getActive().pipe(\n      distinctUntilChanged(),\n      // On language change we want to rerender CDC screen with proper translations\n      tap(() => (this.renderScreenSet = true))\n    );\n  }\n\n  /**\n   * Display screen set in embed mode\n   *\n   * @param data - GigyaRaasComponentData\n   * @param lang - language\n   */\n  displayScreenSet(data: GigyaRaasComponentData, lang: string): void {\n    if (this.renderScreenSet) {\n      this.showScreenSet(data, lang);\n    }\n    this.renderScreenSet = false;\n  }\n\n  /**\n   * Show screen set\n   *\n   * @param data - GigyaRaasComponentData\n   * @param lang - language\n   */\n  showScreenSet(data: GigyaRaasComponentData, lang: string) {\n    (this.winRef.nativeWindow as { [key: string]: any })?.[\n      'gigya'\n    ]?.accounts?.showScreenSet({\n      screenSet: data.screenSet,\n      startScreen: data.startScreen,\n      lang,\n      ...(this.displayInEmbedMode(data)\n        ? { containerID: data.containerID }\n        : {}),\n      ...(this.isLoginScreenSet(data)\n        ? { sessionExpiration: this.getSessionExpirationValue() }\n        : {\n            onAfterSubmit: (...params: any[]) => {\n              this.zone.run(() =>\n                this.cdcJSService.onProfileUpdateEventHandler(...params)\n              );\n            },\n          }),\n    });\n  }\n\n  protected isLoginScreenSet(data: GigyaRaasComponentData): boolean {\n    const profileEditScreen: boolean =\n      data.profileEdit === 'true' ? true : false;\n\n    return !profileEditScreen;\n  }\n\n  protected getSessionExpirationValue(): number {\n    if (this.cdcConfig?.cdc !== undefined) {\n      const filteredConfigs: any = this.cdcConfig.cdc.filter(\n        (conf) => conf.baseSite === this.getCurrentBaseSite()\n      );\n      if (filteredConfigs && filteredConfigs.length > 0) {\n        return filteredConfigs[0].sessionExpiration;\n      }\n    }\n    // Return a default value\n    return 3600;\n  }\n\n  private getCurrentBaseSite(): string {\n    let baseSite: string = '';\n    this.baseSiteService\n      .getActive()\n      .pipe(take(1))\n      .subscribe((data) => (baseSite = data));\n    return baseSite;\n  }\n\n  /**\n   * Check if the component should be displayed in embed mode\n   *\n   * @param data - GigyaRaasComponentData\n   */\n  displayInEmbedMode(data: GigyaRaasComponentData): boolean {\n    const embedValue: boolean = data.embed === 'true' ? true : false;\n    if (embedValue && data.containerID && data.containerID.length > 0) {\n      return true;\n    }\n    return false;\n  }\n}\n","<div *ngIf=\"component.data$ | async as data\">\n  <div *ngIf=\"jsLoaded$ | async\">\n    <div *ngIf=\"language$ | async as lang\">\n      <div\n        *ngIf=\"displayInEmbedMode(data); else popupLink\"\n        [attr.id]=\"data.containerID\"\n      >\n        {{ displayScreenSet(data, lang) }}\n      </div>\n      <ng-template #popupLink>\n        <a\n          class=\"popup-link\"\n          [attr.data-cdc-id]=\"data.uid\"\n          [attr.data-profile-edit]=\"data.profileEdit\"\n          (click)=\"showScreenSet(data, lang)\"\n          >{{ data.linkText }}</a\n        >\n      </ng-template>\n    </div>\n  </div>\n  <div *ngIf=\"jsError$ | async\" class=\"js-error\">\n    {{ 'errorHandlers.scriptFailedToLoad' | cxTranslate }}\n    {{ 'errorHandlers.refreshThePage' | cxTranslate }}\n  </div>\n</div>\n","/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { CmsConfig, ConfigModule, I18nModule } from '@spartacus/core';\nimport { LayoutConfig } from '@spartacus/storefront';\nimport { GigyaRaasComponent } from './gigya-raas.component';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    I18nModule,\n    ConfigModule.withConfig(<CmsConfig | LayoutConfig>{\n      cmsComponents: {\n        GigyaRaasComponent: { component: GigyaRaasComponent },\n      },\n      layoutSlots: {\n        GigyaLoginPageTemplate: {\n          slots: ['BodyContent', 'BottomContent'],\n        },\n      },\n    }),\n  ],\n  declarations: [GigyaRaasComponent],\n  exports: [GigyaRaasComponent],\n})\nexport class GigyaRaasModule {}\n","/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { GigyaRaasModule } from './gigya-raas/gigya-raas.module';\n\n@NgModule({\n  declarations: [],\n  imports: [CommonModule, GigyaRaasModule],\n})\nexport class CdcComponentsModule {}\n","/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport * from './gigya-raas.module';\nexport * from './gigya-raas.component';\n","/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/*\n * Public API Surface for CDC\n */\nexport * from './cdc-components.module';\nexport * from './gigya-raas/index';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":[],"mappings":"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"}