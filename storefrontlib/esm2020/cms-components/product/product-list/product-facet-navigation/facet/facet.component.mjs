/*
 * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component, HostBinding, Input, ViewChild, ViewChildren, } from '@angular/core';
import { ICON_TYPE } from '../../../../../cms-components/misc/icon/icon.model';
import { FocusDirective } from '../../../../../layout/a11y/keyboard-focus/focus.directive';
import * as i0 from "@angular/core";
import * as i1 from "../services/facet.service";
import * as i2 from "../../../../../shared/components/assistive-technology-message/assistive-technology-message.directive";
import * as i3 from "@angular/common";
import * as i4 from "../../../../misc/icon/icon.component";
import * as i5 from "../../../../../layout/a11y/keyboard-focus/focus.directive";
import * as i6 from "@angular/router";
import * as i7 from "@spartacus/core";
export class FacetComponent {
    constructor(facetService, elementRef, cd) {
        this.facetService = facetService;
        this.elementRef = elementRef;
        this.cd = cd;
        /** configurable icon that is used to collapse the facet group  */
        this.expandIcon = ICON_TYPE.EXPAND;
        this.collapseIcon = ICON_TYPE.COLLAPSE;
    }
    set facet(value) {
        this._facet = value;
        this.isMultiSelect = !!value.multiSelect;
        this.state$ = this.facetService.getState(value);
    }
    get facet() {
        return this._facet;
    }
    /**
     * Handles clicking the heading of the facet group, which means toggling
     * the visibility of the group (collapse / expand) and optionally focusing
     * the group.
     */
    toggleGroup(event) {
        const host = this.elementRef.nativeElement;
        const isLocked = this.keyboardFocus?.isLocked;
        this.facetService.toggle(this.facet, this.isExpanded);
        if (!isLocked || this.isExpanded) {
            host.focus();
            // we stop propagating the event as otherwise the focus on the host will trigger
            // an unlock event from the LockFocus directive.
            event.stopPropagation();
        }
    }
    get isExpanded() {
        return this.values?.first?.nativeElement.offsetParent !== null;
    }
    openLink(event) {
        event.target.click();
        event.preventDefault();
    }
    /**
     * Increases the number of visible values for the facet. This is delegated
     * to `facetService.increaseVisibleValues`.
     */
    increaseVisibleValues() {
        this.facetService.increaseVisibleValues(this.facet);
    }
    /**
     * Decreases the number of visible values for the facet. This is delegated
     * to `facetService.decreaseVisibleValues`.
     */
    decreaseVisibleValues() {
        this.facetService.decreaseVisibleValues(this.facet);
    }
    getLinkParams(value) {
        return this.facetService.getLinkParams(value.query?.query?.value ?? '');
    }
}
FacetComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: FacetComponent, deps: [{ token: i1.FacetService }, { token: i0.ElementRef }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
FacetComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.2.3", type: FacetComponent, selector: "cx-facet", inputs: { expandIcon: "expandIcon", collapseIcon: "collapseIcon", facet: "facet" }, host: { properties: { "class.multi-select": "this.isMultiSelect" } }, viewQueries: [{ propertyName: "keyboardFocus", first: true, predicate: FocusDirective, descendants: true }, { propertyName: "values", predicate: ["facetValue"], descendants: true }], ngImport: i0, template: "<ng-container *ngIf=\"state$ | async as state\">\n  <button\n    class=\"heading\"\n    (click)=\"toggleGroup($event)\"\n    [attr.aria-expanded]=\"isExpanded\"\n    [attr.aria-label]=\"\n      'productFacetNavigation.filterBy.name' | cxTranslate: { name: facet.name }\n    \"\n  >\n    {{ facet.name }}\n    <cx-icon class=\"collapse-icon\" [type]=\"collapseIcon\"></cx-icon>\n    <cx-icon class=\"expand-icon\" [type]=\"expandIcon\"></cx-icon>\n  </button>\n\n  <div>\n    <a\n      *ngFor=\"let value of facet.values | slice: 0:state.topVisible\"\n      #facetValue\n      routerLink=\"./\"\n      [queryParams]=\"getLinkParams(value)\"\n      class=\"value\"\n      [class.selected]=\"value.selected\"\n      [cxFocus]=\"{ key: value.name }\"\n      (keydown.space)=\"openLink($any($event))\"\n      [attr.role]=\"facet.multiSelect ? 'checkbox' : null\"\n      [attr.aria-checked]=\"facet.multiSelect ? value.selected : null\"\n      attr.aria-label=\"{{\n        'productFacetNavigation.ariaLabelItemsAvailable'\n          | cxTranslate: { name: value.name, count: value.count }\n      }}\"\n    >\n      <span aria-hidden=\"true\"\n        >{{ value.name\n        }}<span aria-hidden=\"true\" class=\"count\">{{ value.count }}</span></span\n      >\n    </a>\n\n    <div class=\"more\">\n      <a\n        *ngFor=\"\n          let value of facet.values\n            | slice: state.topVisible ?? 0:state.maxVisible\n        \"\n        #facetValue\n        routerLink=\"./\"\n        [queryParams]=\"getLinkParams(value)\"\n        class=\"value\"\n        [class.selected]=\"value.selected\"\n        [cxFocus]=\"{ key: value.name }\"\n        (keydown.space)=\"openLink($any($event))\"\n      >\n        <span\n          >{{ value.name }}<span class=\"count\">{{ value.count }}</span></span\n        >\n      </a>\n\n      <button\n        *ngIf=\"\n          state.maxVisible &&\n          state.topVisible &&\n          state.maxVisible > state.topVisible\n        \"\n        (click)=\"decreaseVisibleValues()\"\n        [cxAtMessage]=\"\n          'productFacetNavigation.decreaseOptionsVisibility' | cxTranslate\n        \"\n        aria-expanded=\"true\"\n        attr.aria-label=\"{{\n          'productFacetNavigation.ariaLabelShowLess' | cxTranslate\n        }}\"\n        class=\"cx-action-link\"\n        [cxFocus]=\"{ key: 'moreorless' }\"\n      >\n        {{ 'productList.showLess' | cxTranslate }}\n      </button>\n\n      <button\n        *ngIf=\"\n          state.maxVisible &&\n          facet.values &&\n          state.maxVisible > 0 &&\n          state.maxVisible < facet.values.length\n        \"\n        (click)=\"increaseVisibleValues()\"\n        [cxAtMessage]=\"\n          'productFacetNavigation.increaseOptionsVisibility' | cxTranslate\n        \"\n        aria-expanded=\"false\"\n        attr.aria-label=\"{{\n          'productFacetNavigation.ariaLabelShowMore' | cxTranslate\n        }}\"\n        class=\"cx-action-link\"\n        [cxFocus]=\"{ key: 'moreorless' }\"\n      >\n        {{ 'productList.showMore' | cxTranslate }}\n      </button>\n    </div>\n  </div>\n</ng-container>\n", dependencies: [{ kind: "directive", type: i2.AtMessageDirective, selector: "[cxAtMessage]", inputs: ["cxAtMessage"] }, { kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.IconComponent, selector: "cx-icon,[cxIcon]", inputs: ["cxIcon", "type"] }, { kind: "directive", type: i5.FocusDirective, selector: "[cxFocus]", inputs: ["cxFocus"] }, { kind: "directive", type: i6.RouterLinkWithHref, selector: "a[routerLink],area[routerLink]", inputs: ["target", "queryParams", "fragment", "queryParamsHandling", "state", "relativeTo", "preserveFragment", "skipLocationChange", "replaceUrl", "routerLink"] }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }, { kind: "pipe", type: i3.SlicePipe, name: "slice" }, { kind: "pipe", type: i7.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: FacetComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-facet', changeDetection: ChangeDetectionStrategy.OnPush, template: "<ng-container *ngIf=\"state$ | async as state\">\n  <button\n    class=\"heading\"\n    (click)=\"toggleGroup($event)\"\n    [attr.aria-expanded]=\"isExpanded\"\n    [attr.aria-label]=\"\n      'productFacetNavigation.filterBy.name' | cxTranslate: { name: facet.name }\n    \"\n  >\n    {{ facet.name }}\n    <cx-icon class=\"collapse-icon\" [type]=\"collapseIcon\"></cx-icon>\n    <cx-icon class=\"expand-icon\" [type]=\"expandIcon\"></cx-icon>\n  </button>\n\n  <div>\n    <a\n      *ngFor=\"let value of facet.values | slice: 0:state.topVisible\"\n      #facetValue\n      routerLink=\"./\"\n      [queryParams]=\"getLinkParams(value)\"\n      class=\"value\"\n      [class.selected]=\"value.selected\"\n      [cxFocus]=\"{ key: value.name }\"\n      (keydown.space)=\"openLink($any($event))\"\n      [attr.role]=\"facet.multiSelect ? 'checkbox' : null\"\n      [attr.aria-checked]=\"facet.multiSelect ? value.selected : null\"\n      attr.aria-label=\"{{\n        'productFacetNavigation.ariaLabelItemsAvailable'\n          | cxTranslate: { name: value.name, count: value.count }\n      }}\"\n    >\n      <span aria-hidden=\"true\"\n        >{{ value.name\n        }}<span aria-hidden=\"true\" class=\"count\">{{ value.count }}</span></span\n      >\n    </a>\n\n    <div class=\"more\">\n      <a\n        *ngFor=\"\n          let value of facet.values\n            | slice: state.topVisible ?? 0:state.maxVisible\n        \"\n        #facetValue\n        routerLink=\"./\"\n        [queryParams]=\"getLinkParams(value)\"\n        class=\"value\"\n        [class.selected]=\"value.selected\"\n        [cxFocus]=\"{ key: value.name }\"\n        (keydown.space)=\"openLink($any($event))\"\n      >\n        <span\n          >{{ value.name }}<span class=\"count\">{{ value.count }}</span></span\n        >\n      </a>\n\n      <button\n        *ngIf=\"\n          state.maxVisible &&\n          state.topVisible &&\n          state.maxVisible > state.topVisible\n        \"\n        (click)=\"decreaseVisibleValues()\"\n        [cxAtMessage]=\"\n          'productFacetNavigation.decreaseOptionsVisibility' | cxTranslate\n        \"\n        aria-expanded=\"true\"\n        attr.aria-label=\"{{\n          'productFacetNavigation.ariaLabelShowLess' | cxTranslate\n        }}\"\n        class=\"cx-action-link\"\n        [cxFocus]=\"{ key: 'moreorless' }\"\n      >\n        {{ 'productList.showLess' | cxTranslate }}\n      </button>\n\n      <button\n        *ngIf=\"\n          state.maxVisible &&\n          facet.values &&\n          state.maxVisible > 0 &&\n          state.maxVisible < facet.values.length\n        \"\n        (click)=\"increaseVisibleValues()\"\n        [cxAtMessage]=\"\n          'productFacetNavigation.increaseOptionsVisibility' | cxTranslate\n        \"\n        aria-expanded=\"false\"\n        attr.aria-label=\"{{\n          'productFacetNavigation.ariaLabelShowMore' | cxTranslate\n        }}\"\n        class=\"cx-action-link\"\n        [cxFocus]=\"{ key: 'moreorless' }\"\n      >\n        {{ 'productList.showMore' | cxTranslate }}\n      </button>\n    </div>\n  </div>\n</ng-container>\n" }]
        }], ctorParameters: function () { return [{ type: i1.FacetService }, { type: i0.ElementRef }, { type: i0.ChangeDetectorRef }]; }, propDecorators: { expandIcon: [{
                type: Input
            }], collapseIcon: [{
                type: Input
            }], isMultiSelect: [{
                type: HostBinding,
                args: ['class.multi-select']
            }], values: [{
                type: ViewChildren,
                args: ['facetValue']
            }], keyboardFocus: [{
                type: ViewChild,
                args: [FocusDirective]
            }], facet: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFjZXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvc3RvcmVmcm9udGxpYi9jbXMtY29tcG9uZW50cy9wcm9kdWN0L3Byb2R1Y3QtbGlzdC9wcm9kdWN0LWZhY2V0LW5hdmlnYXRpb24vZmFjZXQvZmFjZXQuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvc3RvcmVmcm9udGxpYi9jbXMtY29tcG9uZW50cy9wcm9kdWN0L3Byb2R1Y3QtbGlzdC9wcm9kdWN0LWZhY2V0LW5hdmlnYXRpb24vZmFjZXQvZmFjZXQuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFDTCx1QkFBdUIsRUFFdkIsU0FBUyxFQUVULFdBQVcsRUFDWCxLQUFLLEVBRUwsU0FBUyxFQUNULFlBQVksR0FDYixNQUFNLGVBQWUsQ0FBQztBQUd2QixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sb0RBQW9ELENBQUM7QUFDL0UsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDJEQUEyRCxDQUFDOzs7Ozs7Ozs7QUFTM0YsTUFBTSxPQUFPLGNBQWM7SUEwQnpCLFlBQ1ksWUFBMEIsRUFDMUIsVUFBbUMsRUFDbkMsRUFBcUI7UUFGckIsaUJBQVksR0FBWixZQUFZLENBQWM7UUFDMUIsZUFBVSxHQUFWLFVBQVUsQ0FBeUI7UUFDbkMsT0FBRSxHQUFGLEVBQUUsQ0FBbUI7UUF4QmpDLGtFQUFrRTtRQUN6RCxlQUFVLEdBQWMsU0FBUyxDQUFDLE1BQU0sQ0FBQztRQUN6QyxpQkFBWSxHQUFjLFNBQVMsQ0FBQyxRQUFRLENBQUM7SUF1Qm5ELENBQUM7SUFmSixJQUNJLEtBQUssQ0FBQyxLQUFZO1FBQ3BCLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUM7UUFDekMsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNsRCxDQUFDO0lBRUQsSUFBSSxLQUFLO1FBQ1AsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQ3JCLENBQUM7SUFRRDs7OztPQUlHO0lBQ0gsV0FBVyxDQUFDLEtBQWM7UUFDeEIsTUFBTSxJQUFJLEdBQWdCLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDO1FBQ3hELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxhQUFhLEVBQUUsUUFBUSxDQUFDO1FBRTlDLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRXRELElBQUksQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNoQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDYixnRkFBZ0Y7WUFDaEYsZ0RBQWdEO1lBQ2hELEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQztTQUN6QjtJQUNILENBQUM7SUFFRCxJQUFJLFVBQVU7UUFDWixPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLGFBQWEsQ0FBQyxZQUFZLEtBQUssSUFBSSxDQUFDO0lBQ2pFLENBQUM7SUFFRCxRQUFRLENBQUMsS0FBb0I7UUFDMUIsS0FBSyxDQUFDLE1BQXNCLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDdEMsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3pCLENBQUM7SUFFRDs7O09BR0c7SUFDSCxxQkFBcUI7UUFDbkIsSUFBSSxDQUFDLFlBQVksQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdEQsQ0FBQztJQUVEOzs7T0FHRztJQUNILHFCQUFxQjtRQUNuQixJQUFJLENBQUMsWUFBWSxDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN0RCxDQUFDO0lBRUQsYUFBYSxDQUFDLEtBQWlCO1FBQzdCLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQzFFLENBQUM7OzJHQTlFVSxjQUFjOytGQUFkLGNBQWMseVBBYWQsY0FBYywwSEMxQzNCLDBqR0FtR0E7MkZEdEVhLGNBQWM7a0JBTDFCLFNBQVM7K0JBQ0UsVUFBVSxtQkFFSCx1QkFBdUIsQ0FBQyxNQUFNOzRKQVF0QyxVQUFVO3NCQUFsQixLQUFLO2dCQUNHLFlBQVk7c0JBQXBCLEtBQUs7Z0JBRTZCLGFBQWE7c0JBQS9DLFdBQVc7dUJBQUMsb0JBQW9CO2dCQUVMLE1BQU07c0JBQWpDLFlBQVk7dUJBQUMsWUFBWTtnQkFFQyxhQUFhO3NCQUF2QyxTQUFTO3VCQUFDLGNBQWM7Z0JBR3JCLEtBQUs7c0JBRFIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIyIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBIb3N0QmluZGluZyxcbiAgSW5wdXQsXG4gIFF1ZXJ5TGlzdCxcbiAgVmlld0NoaWxkLFxuICBWaWV3Q2hpbGRyZW4sXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRmFjZXQsIEZhY2V0VmFsdWUgfSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgSUNPTl9UWVBFIH0gZnJvbSAnLi4vLi4vLi4vLi4vLi4vY21zLWNvbXBvbmVudHMvbWlzYy9pY29uL2ljb24ubW9kZWwnO1xuaW1wb3J0IHsgRm9jdXNEaXJlY3RpdmUgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9sYXlvdXQvYTExeS9rZXlib2FyZC1mb2N1cy9mb2N1cy5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgRmFjZXRDb2xsYXBzZVN0YXRlIH0gZnJvbSAnLi4vZmFjZXQubW9kZWwnO1xuaW1wb3J0IHsgRmFjZXRTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvZmFjZXQuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2N4LWZhY2V0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL2ZhY2V0LmNvbXBvbmVudC5odG1sJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIEZhY2V0Q29tcG9uZW50IHtcbiAgcHJvdGVjdGVkIF9mYWNldDogRmFjZXQ7XG5cbiAgc3RhdGUkOiBPYnNlcnZhYmxlPEZhY2V0Q29sbGFwc2VTdGF0ZT47XG5cbiAgLyoqIGNvbmZpZ3VyYWJsZSBpY29uIHRoYXQgaXMgdXNlZCB0byBjb2xsYXBzZSB0aGUgZmFjZXQgZ3JvdXAgICovXG4gIEBJbnB1dCgpIGV4cGFuZEljb246IElDT05fVFlQRSA9IElDT05fVFlQRS5FWFBBTkQ7XG4gIEBJbnB1dCgpIGNvbGxhcHNlSWNvbjogSUNPTl9UWVBFID0gSUNPTl9UWVBFLkNPTExBUFNFO1xuXG4gIEBIb3N0QmluZGluZygnY2xhc3MubXVsdGktc2VsZWN0JykgaXNNdWx0aVNlbGVjdDogYm9vbGVhbjtcblxuICBAVmlld0NoaWxkcmVuKCdmYWNldFZhbHVlJykgdmFsdWVzOiBRdWVyeUxpc3Q8RWxlbWVudFJlZjxIVE1MRWxlbWVudD4+O1xuXG4gIEBWaWV3Q2hpbGQoRm9jdXNEaXJlY3RpdmUpIGtleWJvYXJkRm9jdXM6IEZvY3VzRGlyZWN0aXZlO1xuXG4gIEBJbnB1dCgpXG4gIHNldCBmYWNldCh2YWx1ZTogRmFjZXQpIHtcbiAgICB0aGlzLl9mYWNldCA9IHZhbHVlO1xuICAgIHRoaXMuaXNNdWx0aVNlbGVjdCA9ICEhdmFsdWUubXVsdGlTZWxlY3Q7XG4gICAgdGhpcy5zdGF0ZSQgPSB0aGlzLmZhY2V0U2VydmljZS5nZXRTdGF0ZSh2YWx1ZSk7XG4gIH1cblxuICBnZXQgZmFjZXQoKTogRmFjZXQge1xuICAgIHJldHVybiB0aGlzLl9mYWNldDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb3RlY3RlZCBmYWNldFNlcnZpY2U6IEZhY2V0U2VydmljZSxcbiAgICBwcm90ZWN0ZWQgZWxlbWVudFJlZjogRWxlbWVudFJlZjxIVE1MRWxlbWVudD4sXG4gICAgcHJvdGVjdGVkIGNkOiBDaGFuZ2VEZXRlY3RvclJlZlxuICApIHt9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgY2xpY2tpbmcgdGhlIGhlYWRpbmcgb2YgdGhlIGZhY2V0IGdyb3VwLCB3aGljaCBtZWFucyB0b2dnbGluZ1xuICAgKiB0aGUgdmlzaWJpbGl0eSBvZiB0aGUgZ3JvdXAgKGNvbGxhcHNlIC8gZXhwYW5kKSBhbmQgb3B0aW9uYWxseSBmb2N1c2luZ1xuICAgKiB0aGUgZ3JvdXAuXG4gICAqL1xuICB0b2dnbGVHcm91cChldmVudDogVUlFdmVudCkge1xuICAgIGNvbnN0IGhvc3Q6IEhUTUxFbGVtZW50ID0gdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQ7XG4gICAgY29uc3QgaXNMb2NrZWQgPSB0aGlzLmtleWJvYXJkRm9jdXM/LmlzTG9ja2VkO1xuXG4gICAgdGhpcy5mYWNldFNlcnZpY2UudG9nZ2xlKHRoaXMuZmFjZXQsIHRoaXMuaXNFeHBhbmRlZCk7XG5cbiAgICBpZiAoIWlzTG9ja2VkIHx8IHRoaXMuaXNFeHBhbmRlZCkge1xuICAgICAgaG9zdC5mb2N1cygpO1xuICAgICAgLy8gd2Ugc3RvcCBwcm9wYWdhdGluZyB0aGUgZXZlbnQgYXMgb3RoZXJ3aXNlIHRoZSBmb2N1cyBvbiB0aGUgaG9zdCB3aWxsIHRyaWdnZXJcbiAgICAgIC8vIGFuIHVubG9jayBldmVudCBmcm9tIHRoZSBMb2NrRm9jdXMgZGlyZWN0aXZlLlxuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGlzRXhwYW5kZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWVzPy5maXJzdD8ubmF0aXZlRWxlbWVudC5vZmZzZXRQYXJlbnQgIT09IG51bGw7XG4gIH1cblxuICBvcGVuTGluayhldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgIChldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQpLmNsaWNrKCk7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbmNyZWFzZXMgdGhlIG51bWJlciBvZiB2aXNpYmxlIHZhbHVlcyBmb3IgdGhlIGZhY2V0LiBUaGlzIGlzIGRlbGVnYXRlZFxuICAgKiB0byBgZmFjZXRTZXJ2aWNlLmluY3JlYXNlVmlzaWJsZVZhbHVlc2AuXG4gICAqL1xuICBpbmNyZWFzZVZpc2libGVWYWx1ZXMoKTogdm9pZCB7XG4gICAgdGhpcy5mYWNldFNlcnZpY2UuaW5jcmVhc2VWaXNpYmxlVmFsdWVzKHRoaXMuZmFjZXQpO1xuICB9XG5cbiAgLyoqXG4gICAqIERlY3JlYXNlcyB0aGUgbnVtYmVyIG9mIHZpc2libGUgdmFsdWVzIGZvciB0aGUgZmFjZXQuIFRoaXMgaXMgZGVsZWdhdGVkXG4gICAqIHRvIGBmYWNldFNlcnZpY2UuZGVjcmVhc2VWaXNpYmxlVmFsdWVzYC5cbiAgICovXG4gIGRlY3JlYXNlVmlzaWJsZVZhbHVlcygpOiB2b2lkIHtcbiAgICB0aGlzLmZhY2V0U2VydmljZS5kZWNyZWFzZVZpc2libGVWYWx1ZXModGhpcy5mYWNldCk7XG4gIH1cblxuICBnZXRMaW5rUGFyYW1zKHZhbHVlOiBGYWNldFZhbHVlKSB7XG4gICAgcmV0dXJuIHRoaXMuZmFjZXRTZXJ2aWNlLmdldExpbmtQYXJhbXModmFsdWUucXVlcnk/LnF1ZXJ5Py52YWx1ZSA/PyAnJyk7XG4gIH1cbn1cbiIsIjxuZy1jb250YWluZXIgKm5nSWY9XCJzdGF0ZSQgfCBhc3luYyBhcyBzdGF0ZVwiPlxuICA8YnV0dG9uXG4gICAgY2xhc3M9XCJoZWFkaW5nXCJcbiAgICAoY2xpY2spPVwidG9nZ2xlR3JvdXAoJGV2ZW50KVwiXG4gICAgW2F0dHIuYXJpYS1leHBhbmRlZF09XCJpc0V4cGFuZGVkXCJcbiAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIlxuICAgICAgJ3Byb2R1Y3RGYWNldE5hdmlnYXRpb24uZmlsdGVyQnkubmFtZScgfCBjeFRyYW5zbGF0ZTogeyBuYW1lOiBmYWNldC5uYW1lIH1cbiAgICBcIlxuICA+XG4gICAge3sgZmFjZXQubmFtZSB9fVxuICAgIDxjeC1pY29uIGNsYXNzPVwiY29sbGFwc2UtaWNvblwiIFt0eXBlXT1cImNvbGxhcHNlSWNvblwiPjwvY3gtaWNvbj5cbiAgICA8Y3gtaWNvbiBjbGFzcz1cImV4cGFuZC1pY29uXCIgW3R5cGVdPVwiZXhwYW5kSWNvblwiPjwvY3gtaWNvbj5cbiAgPC9idXR0b24+XG5cbiAgPGRpdj5cbiAgICA8YVxuICAgICAgKm5nRm9yPVwibGV0IHZhbHVlIG9mIGZhY2V0LnZhbHVlcyB8IHNsaWNlOiAwOnN0YXRlLnRvcFZpc2libGVcIlxuICAgICAgI2ZhY2V0VmFsdWVcbiAgICAgIHJvdXRlckxpbms9XCIuL1wiXG4gICAgICBbcXVlcnlQYXJhbXNdPVwiZ2V0TGlua1BhcmFtcyh2YWx1ZSlcIlxuICAgICAgY2xhc3M9XCJ2YWx1ZVwiXG4gICAgICBbY2xhc3Muc2VsZWN0ZWRdPVwidmFsdWUuc2VsZWN0ZWRcIlxuICAgICAgW2N4Rm9jdXNdPVwieyBrZXk6IHZhbHVlLm5hbWUgfVwiXG4gICAgICAoa2V5ZG93bi5zcGFjZSk9XCJvcGVuTGluaygkYW55KCRldmVudCkpXCJcbiAgICAgIFthdHRyLnJvbGVdPVwiZmFjZXQubXVsdGlTZWxlY3QgPyAnY2hlY2tib3gnIDogbnVsbFwiXG4gICAgICBbYXR0ci5hcmlhLWNoZWNrZWRdPVwiZmFjZXQubXVsdGlTZWxlY3QgPyB2YWx1ZS5zZWxlY3RlZCA6IG51bGxcIlxuICAgICAgYXR0ci5hcmlhLWxhYmVsPVwie3tcbiAgICAgICAgJ3Byb2R1Y3RGYWNldE5hdmlnYXRpb24uYXJpYUxhYmVsSXRlbXNBdmFpbGFibGUnXG4gICAgICAgICAgfCBjeFRyYW5zbGF0ZTogeyBuYW1lOiB2YWx1ZS5uYW1lLCBjb3VudDogdmFsdWUuY291bnQgfVxuICAgICAgfX1cIlxuICAgID5cbiAgICAgIDxzcGFuIGFyaWEtaGlkZGVuPVwidHJ1ZVwiXG4gICAgICAgID57eyB2YWx1ZS5uYW1lXG4gICAgICAgIH19PHNwYW4gYXJpYS1oaWRkZW49XCJ0cnVlXCIgY2xhc3M9XCJjb3VudFwiPnt7IHZhbHVlLmNvdW50IH19PC9zcGFuPjwvc3BhblxuICAgICAgPlxuICAgIDwvYT5cblxuICAgIDxkaXYgY2xhc3M9XCJtb3JlXCI+XG4gICAgICA8YVxuICAgICAgICAqbmdGb3I9XCJcbiAgICAgICAgICBsZXQgdmFsdWUgb2YgZmFjZXQudmFsdWVzXG4gICAgICAgICAgICB8IHNsaWNlOiBzdGF0ZS50b3BWaXNpYmxlID8/IDA6c3RhdGUubWF4VmlzaWJsZVxuICAgICAgICBcIlxuICAgICAgICAjZmFjZXRWYWx1ZVxuICAgICAgICByb3V0ZXJMaW5rPVwiLi9cIlxuICAgICAgICBbcXVlcnlQYXJhbXNdPVwiZ2V0TGlua1BhcmFtcyh2YWx1ZSlcIlxuICAgICAgICBjbGFzcz1cInZhbHVlXCJcbiAgICAgICAgW2NsYXNzLnNlbGVjdGVkXT1cInZhbHVlLnNlbGVjdGVkXCJcbiAgICAgICAgW2N4Rm9jdXNdPVwieyBrZXk6IHZhbHVlLm5hbWUgfVwiXG4gICAgICAgIChrZXlkb3duLnNwYWNlKT1cIm9wZW5MaW5rKCRhbnkoJGV2ZW50KSlcIlxuICAgICAgPlxuICAgICAgICA8c3BhblxuICAgICAgICAgID57eyB2YWx1ZS5uYW1lIH19PHNwYW4gY2xhc3M9XCJjb3VudFwiPnt7IHZhbHVlLmNvdW50IH19PC9zcGFuPjwvc3BhblxuICAgICAgICA+XG4gICAgICA8L2E+XG5cbiAgICAgIDxidXR0b25cbiAgICAgICAgKm5nSWY9XCJcbiAgICAgICAgICBzdGF0ZS5tYXhWaXNpYmxlICYmXG4gICAgICAgICAgc3RhdGUudG9wVmlzaWJsZSAmJlxuICAgICAgICAgIHN0YXRlLm1heFZpc2libGUgPiBzdGF0ZS50b3BWaXNpYmxlXG4gICAgICAgIFwiXG4gICAgICAgIChjbGljayk9XCJkZWNyZWFzZVZpc2libGVWYWx1ZXMoKVwiXG4gICAgICAgIFtjeEF0TWVzc2FnZV09XCJcbiAgICAgICAgICAncHJvZHVjdEZhY2V0TmF2aWdhdGlvbi5kZWNyZWFzZU9wdGlvbnNWaXNpYmlsaXR5JyB8IGN4VHJhbnNsYXRlXG4gICAgICAgIFwiXG4gICAgICAgIGFyaWEtZXhwYW5kZWQ9XCJ0cnVlXCJcbiAgICAgICAgYXR0ci5hcmlhLWxhYmVsPVwie3tcbiAgICAgICAgICAncHJvZHVjdEZhY2V0TmF2aWdhdGlvbi5hcmlhTGFiZWxTaG93TGVzcycgfCBjeFRyYW5zbGF0ZVxuICAgICAgICB9fVwiXG4gICAgICAgIGNsYXNzPVwiY3gtYWN0aW9uLWxpbmtcIlxuICAgICAgICBbY3hGb2N1c109XCJ7IGtleTogJ21vcmVvcmxlc3MnIH1cIlxuICAgICAgPlxuICAgICAgICB7eyAncHJvZHVjdExpc3Quc2hvd0xlc3MnIHwgY3hUcmFuc2xhdGUgfX1cbiAgICAgIDwvYnV0dG9uPlxuXG4gICAgICA8YnV0dG9uXG4gICAgICAgICpuZ0lmPVwiXG4gICAgICAgICAgc3RhdGUubWF4VmlzaWJsZSAmJlxuICAgICAgICAgIGZhY2V0LnZhbHVlcyAmJlxuICAgICAgICAgIHN0YXRlLm1heFZpc2libGUgPiAwICYmXG4gICAgICAgICAgc3RhdGUubWF4VmlzaWJsZSA8IGZhY2V0LnZhbHVlcy5sZW5ndGhcbiAgICAgICAgXCJcbiAgICAgICAgKGNsaWNrKT1cImluY3JlYXNlVmlzaWJsZVZhbHVlcygpXCJcbiAgICAgICAgW2N4QXRNZXNzYWdlXT1cIlxuICAgICAgICAgICdwcm9kdWN0RmFjZXROYXZpZ2F0aW9uLmluY3JlYXNlT3B0aW9uc1Zpc2liaWxpdHknIHwgY3hUcmFuc2xhdGVcbiAgICAgICAgXCJcbiAgICAgICAgYXJpYS1leHBhbmRlZD1cImZhbHNlXCJcbiAgICAgICAgYXR0ci5hcmlhLWxhYmVsPVwie3tcbiAgICAgICAgICAncHJvZHVjdEZhY2V0TmF2aWdhdGlvbi5hcmlhTGFiZWxTaG93TW9yZScgfCBjeFRyYW5zbGF0ZVxuICAgICAgICB9fVwiXG4gICAgICAgIGNsYXNzPVwiY3gtYWN0aW9uLWxpbmtcIlxuICAgICAgICBbY3hGb2N1c109XCJ7IGtleTogJ21vcmVvcmxlc3MnIH1cIlxuICAgICAgPlxuICAgICAgICB7eyAncHJvZHVjdExpc3Quc2hvd01vcmUnIHwgY3hUcmFuc2xhdGUgfX1cbiAgICAgIDwvYnV0dG9uPlxuICAgIDwvZGl2PlxuICA8L2Rpdj5cbjwvbmctY29udGFpbmVyPlxuIl19