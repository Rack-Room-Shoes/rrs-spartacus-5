import { Injectable } from '@angular/core';
import { createEffect, ofType } from '@ngrx/effects';
import { normalizeHttpError, StateUtils, } from '@spartacus/core';
import { from, of } from 'rxjs';
import { catchError, groupBy, map, mergeMap, switchMap } from 'rxjs/operators';
import { B2BUserActions, OrganizationActions, OrgUnitActions, } from '../actions/index';
import * as i0 from "@angular/core";
import * as i1 from "@ngrx/effects";
import * as i2 from "../../connectors/org-unit/org-unit.connector";
export class OrgUnitEffects {
    // @Effect()
    // loadAddress$: Observable<
    //   | OrgUnitActions.LoadAddressSuccess
    //   | OrgUnitActions.LoadAddressesSuccess
    //   | OrgUnitActions.LoadAddressesFail
    // > = this.actions$.pipe(
    //   ofType(OrgUnitActions.LOAD_ADDRESSES),
    //   map((action: OrgUnitActions.LoadAddresses) => action.payload),
    //   switchMap(({ userId, orgUnitId }) => {
    //     return this.orgUnitConnector.getAddresses(userId, orgUnitId).pipe(
    //       switchMap((addresses: EntitiesModel<B2BAddress>) => {
    //         const { values, page } = StateUtils.normalizeListPage(addresses, 'id');
    //         return [
    //           new OrgUnitActions.LoadAddressSuccess(values),
    //           new OrgUnitActions.LoadAddressesSuccess({ page, orgUnitId }),
    //         ];
    //       }),
    //       catchError(error =>
    //         of(
    //           new OrgUnitActions.LoadAddressesFail({
    //             orgUnitId,
    //             error: normalizeHttpError(error),
    //           })
    //         )
    //       )
    //     );
    //   })
    // );
    constructor(actions$, orgUnitConnector) {
        this.actions$ = actions$;
        this.orgUnitConnector = orgUnitConnector;
        this.loadOrgUnit$ = createEffect(() => this.actions$.pipe(ofType(OrgUnitActions.LOAD_ORG_UNIT), map((action) => action.payload), switchMap(({ userId, orgUnitId }) => {
            return this.orgUnitConnector.get(userId, orgUnitId).pipe(switchMap((orgUnit) => {
                const { values, page } = StateUtils.normalizeListPage({ values: orgUnit.addresses ?? [] }, 'id');
                return [
                    new OrgUnitActions.LoadOrgUnitSuccess([orgUnit]),
                    new OrgUnitActions.LoadAddressSuccess(values),
                    new OrgUnitActions.LoadAddressesSuccess({ page, orgUnitId }),
                ];
            }), catchError((error) => of(new OrgUnitActions.LoadOrgUnitFail({
                orgUnitId,
                error: normalizeHttpError(error),
            }))));
        })));
        this.loadAvailableOrgUnits$ = createEffect(() => this.actions$.pipe(ofType(OrgUnitActions.LOAD_UNIT_NODES), map((action) => action.payload), switchMap((payload) => this.orgUnitConnector.getList(payload.userId).pipe(map((orgUnitsList) => new OrgUnitActions.LoadOrgUnitNodesSuccess(orgUnitsList)), catchError((error) => of(new OrgUnitActions.LoadOrgUnitNodesFail({
            error: normalizeHttpError(error),
        })))))));
        this.createUnit$ = createEffect(() => this.actions$.pipe(ofType(OrgUnitActions.CREATE_ORG_UNIT), map((action) => action.payload), switchMap((payload) => this.orgUnitConnector.create(payload.userId, payload.unit).pipe(switchMap((data) => [
            new OrgUnitActions.CreateUnitSuccess(data),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new OrgUnitActions.CreateUnitFail({
                unitCode: payload.unit.uid ?? '',
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.updateUnit$ = createEffect(() => this.actions$.pipe(ofType(OrgUnitActions.UPDATE_ORG_UNIT), map((action) => action.payload), switchMap((payload) => this.orgUnitConnector
            .update(payload.userId, payload.unitCode, payload.unit)
            .pipe(switchMap((_data) => [
            // Workaround for empty response
            new OrgUnitActions.UpdateUnitSuccess(payload.unit),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new OrgUnitActions.UpdateUnitFail({
                unitCode: payload.unit.uid ?? '',
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.loadTree$ = createEffect(() => this.actions$.pipe(ofType(OrgUnitActions.LOAD_UNIT_TREE), map((action) => action.payload), switchMap(({ userId }) => {
            return this.orgUnitConnector.getTree(userId).pipe(map((orgUnit) => new OrgUnitActions.LoadTreeSuccess(orgUnit)), catchError((error) => of(new OrgUnitActions.LoadTreeFail({
                error: normalizeHttpError(error),
            }))));
        })));
        this.loadApprovalProcesses$ = createEffect(() => this.actions$.pipe(ofType(OrgUnitActions.LOAD_APPROVAL_PROCESSES), map((action) => action.payload), switchMap(({ userId }) => {
            return this.orgUnitConnector.getApprovalProcesses(userId).pipe(map((approvalProcesses) => new OrgUnitActions.LoadApprovalProcessesSuccess(approvalProcesses)), catchError((error) => of(new OrgUnitActions.LoadApprovalProcessesFail({
                error: normalizeHttpError(error),
            }))));
        })));
        this.loadUsers$ = createEffect(() => this.actions$.pipe(ofType(OrgUnitActions.LOAD_ASSIGNED_USERS), map((action) => action.payload), groupBy(({ orgUnitId, roleId, params }) => StateUtils.serializeParams([orgUnitId, roleId], params)), mergeMap((group) => group.pipe(switchMap(({ userId, orgUnitId, roleId, params }) => {
            return this.orgUnitConnector
                .getUsers(userId, orgUnitId, roleId, params)
                .pipe(switchMap((users) => {
                const { values, page } = StateUtils.normalizeListPage(users, 'customerId');
                return [
                    new B2BUserActions.LoadB2BUserSuccess(values),
                    new OrgUnitActions.LoadAssignedUsersSuccess({
                        orgUnitId,
                        roleId,
                        page,
                        params,
                    }),
                ];
            }), catchError((error) => of(new OrgUnitActions.LoadAssignedUsersFail({
                orgUnitId,
                roleId,
                params,
                error: normalizeHttpError(error),
            }))));
        })))));
        this.assignRoleToUser = createEffect(() => this.actions$.pipe(ofType(OrgUnitActions.ASSIGN_ROLE), map((action) => action.payload), switchMap(({ userId, orgCustomerId, roleId }) => this.orgUnitConnector.assignRole(userId, orgCustomerId, roleId).pipe(map(() => new OrgUnitActions.AssignRoleSuccess({
            uid: orgCustomerId,
            roleId,
            selected: true,
        })), catchError((error) => of(new OrgUnitActions.AssignRoleFail({
            orgCustomerId,
            error: normalizeHttpError(error),
        })))))));
        this.unassignRoleToUser$ = createEffect(() => this.actions$.pipe(ofType(OrgUnitActions.UNASSIGN_ROLE), map((action) => action.payload), switchMap(({ userId, orgCustomerId, roleId }) => this.orgUnitConnector.unassignRole(userId, orgCustomerId, roleId).pipe(map(() => new OrgUnitActions.UnassignRoleSuccess({
            uid: orgCustomerId,
            roleId,
            selected: false,
        })), catchError((error) => of(new OrgUnitActions.UnassignRoleFail({
            orgCustomerId,
            error: normalizeHttpError(error),
        })))))));
        this.assignApprover = createEffect(() => this.actions$.pipe(ofType(OrgUnitActions.ASSIGN_APPROVER), map((action) => action.payload), mergeMap(({ userId, orgUnitId, orgCustomerId, roleId }) => this.orgUnitConnector
            .assignApprover(userId, orgUnitId, orgCustomerId, roleId)
            .pipe(switchMap(() => [
            new OrgUnitActions.AssignApproverSuccess({
                uid: orgCustomerId,
                roleId,
                selected: true,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new OrgUnitActions.AssignApproverFail({
                orgCustomerId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.unassignApprover = createEffect(() => this.actions$.pipe(ofType(OrgUnitActions.UNASSIGN_APPROVER), map((action) => action.payload), mergeMap(({ userId, orgUnitId, orgCustomerId, roleId }) => this.orgUnitConnector
            .unassignApprover(userId, orgUnitId, orgCustomerId, roleId)
            .pipe(switchMap(() => [
            new OrgUnitActions.UnassignApproverSuccess({
                uid: orgCustomerId,
                roleId,
                selected: false,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new OrgUnitActions.UnassignApproverFail({
                orgCustomerId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.createAddress$ = createEffect(() => this.actions$.pipe(ofType(OrgUnitActions.CREATE_ADDRESS), map((action) => action.payload), switchMap((payload) => this.orgUnitConnector
            .createAddress(payload.userId, payload.orgUnitId, payload.address)
            .pipe(switchMap((data) => [
            new OrgUnitActions.CreateAddressSuccess(data),
            new OrgUnitActions.CreateAddressSuccess({ id: undefined }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new OrgUnitActions.CreateAddressFail({
                addressId: payload.address.id ?? '',
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.updateAddress$ = createEffect(() => this.actions$.pipe(ofType(OrgUnitActions.UPDATE_ADDRESS), map((action) => action.payload), switchMap(({ userId, orgUnitId, addressId, address }) => this.orgUnitConnector
            .updateAddress(userId, orgUnitId, addressId, address)
            .pipe(switchMap(() => [
            // commented out due to no response from backend on PATCH request
            // new OrgUnitActions.UpdateAddressSuccess(data),
            new OrgUnitActions.UpdateAddressSuccess(address),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new OrgUnitActions.UpdateAddressFail({
                addressId: address.id ?? '',
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.deleteAddress$ = createEffect(() => this.actions$.pipe(ofType(OrgUnitActions.DELETE_ADDRESS), map((action) => action.payload), switchMap((payload) => this.orgUnitConnector
            .deleteAddress(payload.userId, payload.orgUnitId, payload.addressId)
            .pipe(switchMap(() => [
            new OrgUnitActions.DeleteAddressSuccess({
                id: payload.addressId,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new OrgUnitActions.DeleteAddressFail({
                addressId: payload.addressId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
    }
}
OrgUnitEffects.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: OrgUnitEffects, deps: [{ token: i1.Actions }, { token: i2.OrgUnitConnector }], target: i0.ɵɵFactoryTarget.Injectable });
OrgUnitEffects.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: OrgUnitEffects });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: OrgUnitEffects, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.Actions }, { type: i2.OrgUnitConnector }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JnLXVuaXQuZWZmZWN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL29yZ2FuaXphdGlvbi9hZG1pbmlzdHJhdGlvbi9jb3JlL3N0b3JlL2VmZmVjdHMvb3JnLXVuaXQuZWZmZWN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQU9BLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFXLFlBQVksRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDOUQsT0FBTyxFQUtMLGtCQUFrQixFQUNsQixVQUFVLEdBQ1gsTUFBTSxpQkFBaUIsQ0FBQztBQUN6QixPQUFPLEVBQUUsSUFBSSxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1QyxPQUFPLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRy9FLE9BQU8sRUFDTCxjQUFjLEVBQ2QsbUJBQW1CLEVBQ25CLGNBQWMsR0FDZixNQUFNLGtCQUFrQixDQUFDOzs7O0FBRzFCLE1BQU0sT0FBTyxjQUFjO0lBc2J6QixZQUFZO0lBQ1osNEJBQTRCO0lBQzVCLHdDQUF3QztJQUN4QywwQ0FBMEM7SUFDMUMsdUNBQXVDO0lBQ3ZDLDBCQUEwQjtJQUMxQiwyQ0FBMkM7SUFDM0MsbUVBQW1FO0lBQ25FLDJDQUEyQztJQUMzQyx5RUFBeUU7SUFDekUsOERBQThEO0lBQzlELGtGQUFrRjtJQUNsRixtQkFBbUI7SUFDbkIsMkRBQTJEO0lBQzNELDBFQUEwRTtJQUMxRSxhQUFhO0lBQ2IsWUFBWTtJQUNaLDRCQUE0QjtJQUM1QixjQUFjO0lBQ2QsbURBQW1EO0lBQ25ELHlCQUF5QjtJQUN6QixnREFBZ0Q7SUFDaEQsZUFBZTtJQUNmLFlBQVk7SUFDWixVQUFVO0lBQ1YsU0FBUztJQUNULE9BQU87SUFDUCxLQUFL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MUIsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIyIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7IEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWN0aW9ucywgY3JlYXRlRWZmZWN0LCBvZlR5cGUgfSBmcm9tICdAbmdyeC9lZmZlY3RzJztcbmltcG9ydCB7XG4gIEIyQkFwcHJvdmFsUHJvY2VzcyxcbiAgQjJCVW5pdCxcbiAgQjJCVXNlcixcbiAgRW50aXRpZXNNb2RlbCxcbiAgbm9ybWFsaXplSHR0cEVycm9yLFxuICBTdGF0ZVV0aWxzLFxufSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgZnJvbSwgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNhdGNoRXJyb3IsIGdyb3VwQnksIG1hcCwgbWVyZ2VNYXAsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE9yZ1VuaXRDb25uZWN0b3IgfSBmcm9tICcuLi8uLi9jb25uZWN0b3JzL29yZy11bml0L29yZy11bml0LmNvbm5lY3Rvcic7XG5pbXBvcnQgeyBCMkJVbml0Tm9kZSB9IGZyb20gJy4uLy4uL21vZGVsL3VuaXQtbm9kZS5tb2RlbCc7XG5pbXBvcnQge1xuICBCMkJVc2VyQWN0aW9ucyxcbiAgT3JnYW5pemF0aW9uQWN0aW9ucyxcbiAgT3JnVW5pdEFjdGlvbnMsXG59IGZyb20gJy4uL2FjdGlvbnMvaW5kZXgnO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgT3JnVW5pdEVmZmVjdHMge1xuICBsb2FkT3JnVW5pdCQ6IE9ic2VydmFibGU8XG4gICAgfCBPcmdVbml0QWN0aW9ucy5Mb2FkT3JnVW5pdFN1Y2Nlc3NcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLkxvYWRBZGRyZXNzU3VjY2Vzc1xuICAgIHwgT3JnVW5pdEFjdGlvbnMuTG9hZEFkZHJlc3Nlc1N1Y2Nlc3NcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLkxvYWRPcmdVbml0RmFpbFxuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKE9yZ1VuaXRBY3Rpb25zLkxPQURfT1JHX1VOSVQpLFxuICAgICAgbWFwKChhY3Rpb246IE9yZ1VuaXRBY3Rpb25zLkxvYWRPcmdVbml0KSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBzd2l0Y2hNYXAoKHsgdXNlcklkLCBvcmdVbml0SWQgfSkgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5vcmdVbml0Q29ubmVjdG9yLmdldCh1c2VySWQsIG9yZ1VuaXRJZCkucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKG9yZ1VuaXQ6IEIyQlVuaXQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgdmFsdWVzLCBwYWdlIH0gPSBTdGF0ZVV0aWxzLm5vcm1hbGl6ZUxpc3RQYWdlKFxuICAgICAgICAgICAgICB7IHZhbHVlczogb3JnVW5pdC5hZGRyZXNzZXMgPz8gW10gfSxcbiAgICAgICAgICAgICAgJ2lkJ1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Mb2FkT3JnVW5pdFN1Y2Nlc3MoW29yZ1VuaXRdKSxcbiAgICAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLkxvYWRBZGRyZXNzU3VjY2Vzcyh2YWx1ZXMpLFxuICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuTG9hZEFkZHJlc3Nlc1N1Y2Nlc3MoeyBwYWdlLCBvcmdVbml0SWQgfSksXG4gICAgICAgICAgICBdO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgIG9mKFxuICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuTG9hZE9yZ1VuaXRGYWlsKHtcbiAgICAgICAgICAgICAgICBvcmdVbml0SWQsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgfSlcbiAgICApXG4gICk7XG5cbiAgbG9hZEF2YWlsYWJsZU9yZ1VuaXRzJDogT2JzZXJ2YWJsZTxcbiAgICBPcmdVbml0QWN0aW9ucy5Mb2FkT3JnVW5pdE5vZGVzU3VjY2VzcyB8IE9yZ1VuaXRBY3Rpb25zLkxvYWRPcmdVbml0Tm9kZXNGYWlsXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoT3JnVW5pdEFjdGlvbnMuTE9BRF9VTklUX05PREVTKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBPcmdVbml0QWN0aW9ucy5Mb2FkT3JnVW5pdE5vZGVzKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBzd2l0Y2hNYXAoKHBheWxvYWQpID0+XG4gICAgICAgIHRoaXMub3JnVW5pdENvbm5lY3Rvci5nZXRMaXN0KHBheWxvYWQudXNlcklkKS5waXBlKFxuICAgICAgICAgIG1hcChcbiAgICAgICAgICAgIChvcmdVbml0c0xpc3Q6IEIyQlVuaXROb2RlW10pID0+XG4gICAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Mb2FkT3JnVW5pdE5vZGVzU3VjY2VzcyhvcmdVbml0c0xpc3QpXG4gICAgICAgICAgKSxcbiAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLkxvYWRPcmdVbml0Tm9kZXNGYWlsKHtcbiAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgY3JlYXRlVW5pdCQ6IE9ic2VydmFibGU8XG4gICAgfCBPcmdVbml0QWN0aW9ucy5DcmVhdGVVbml0RmFpbFxuICAgIHwgT3JnVW5pdEFjdGlvbnMuQ3JlYXRlVW5pdFN1Y2Nlc3NcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoT3JnVW5pdEFjdGlvbnMuQ1JFQVRFX09SR19VTklUKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBPcmdVbml0QWN0aW9ucy5DcmVhdGVVbml0KSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBzd2l0Y2hNYXAoKHBheWxvYWQpID0+XG4gICAgICAgIHRoaXMub3JnVW5pdENvbm5lY3Rvci5jcmVhdGUocGF5bG9hZC51c2VySWQsIHBheWxvYWQudW5pdCkucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKGRhdGEpID0+IFtcbiAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5DcmVhdGVVbml0U3VjY2VzcyhkYXRhKSxcbiAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgIF0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuQ3JlYXRlVW5pdEZhaWwoe1xuICAgICAgICAgICAgICAgIHVuaXRDb2RlOiBwYXlsb2FkLnVuaXQudWlkID8/ICcnLFxuICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICBdKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICB1cGRhdGVVbml0JDogT2JzZXJ2YWJsZTxcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLlVwZGF0ZVVuaXRTdWNjZXNzXG4gICAgfCBPcmdVbml0QWN0aW9ucy5VcGRhdGVVbml0RmFpbFxuICAgIHwgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGFcbiAgPiA9IGNyZWF0ZUVmZmVjdCgoKSA9PlxuICAgIHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICAgIG9mVHlwZShPcmdVbml0QWN0aW9ucy5VUERBVEVfT1JHX1VOSVQpLFxuICAgICAgbWFwKChhY3Rpb246IE9yZ1VuaXRBY3Rpb25zLlVwZGF0ZVVuaXQpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICAgIHN3aXRjaE1hcCgocGF5bG9hZCkgPT5cbiAgICAgICAgdGhpcy5vcmdVbml0Q29ubmVjdG9yXG4gICAgICAgICAgLnVwZGF0ZShwYXlsb2FkLnVzZXJJZCwgcGF5bG9hZC51bml0Q29kZSwgcGF5bG9hZC51bml0KVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgc3dpdGNoTWFwKChfZGF0YSkgPT4gW1xuICAgICAgICAgICAgICAvLyBXb3JrYXJvdW5kIGZvciBlbXB0eSByZXNwb25zZVxuICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuVXBkYXRlVW5pdFN1Y2Nlc3MocGF5bG9hZC51bml0KSxcbiAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLlVwZGF0ZVVuaXRGYWlsKHtcbiAgICAgICAgICAgICAgICAgIHVuaXRDb2RlOiBwYXlsb2FkLnVuaXQudWlkID8/ICcnLFxuICAgICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICBsb2FkVHJlZSQ6IE9ic2VydmFibGU8XG4gICAgT3JnVW5pdEFjdGlvbnMuTG9hZFRyZWVTdWNjZXNzIHwgT3JnVW5pdEFjdGlvbnMuTG9hZFRyZWVGYWlsXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoT3JnVW5pdEFjdGlvbnMuTE9BRF9VTklUX1RSRUUpLFxuICAgICAgbWFwKChhY3Rpb246IE9yZ1VuaXRBY3Rpb25zLkxvYWRPcmdVbml0KSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBzd2l0Y2hNYXAoKHsgdXNlcklkIH0pID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3JnVW5pdENvbm5lY3Rvci5nZXRUcmVlKHVzZXJJZCkucGlwZShcbiAgICAgICAgICBtYXAoXG4gICAgICAgICAgICAob3JnVW5pdDogQjJCVW5pdE5vZGUpID0+XG4gICAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Mb2FkVHJlZVN1Y2Nlc3Mob3JnVW5pdClcbiAgICAgICAgICApLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgIG9mKFxuICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuTG9hZFRyZWVGYWlsKHtcbiAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9KVxuICAgIClcbiAgKTtcblxuICBsb2FkQXBwcm92YWxQcm9jZXNzZXMkOiBPYnNlcnZhYmxlPFxuICAgIHwgT3JnVW5pdEFjdGlvbnMuTG9hZEFwcHJvdmFsUHJvY2Vzc2VzU3VjY2Vzc1xuICAgIHwgT3JnVW5pdEFjdGlvbnMuTG9hZEFwcHJvdmFsUHJvY2Vzc2VzRmFpbFxuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKE9yZ1VuaXRBY3Rpb25zLkxPQURfQVBQUk9WQUxfUFJPQ0VTU0VTKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBPcmdVbml0QWN0aW9ucy5Mb2FkT3JnVW5pdCkgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgICAgc3dpdGNoTWFwKCh7IHVzZXJJZCB9KSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLm9yZ1VuaXRDb25uZWN0b3IuZ2V0QXBwcm92YWxQcm9jZXNzZXModXNlcklkKS5waXBlKFxuICAgICAgICAgIG1hcChcbiAgICAgICAgICAgIChhcHByb3ZhbFByb2Nlc3NlczogQjJCQXBwcm92YWxQcm9jZXNzW10pID0+XG4gICAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Mb2FkQXBwcm92YWxQcm9jZXNzZXNTdWNjZXNzKGFwcHJvdmFsUHJvY2Vzc2VzKVxuICAgICAgICAgICksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgb2YoXG4gICAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Mb2FkQXBwcm92YWxQcm9jZXNzZXNGYWlsKHtcbiAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9KVxuICAgIClcbiAgKTtcblxuICBsb2FkVXNlcnMkOiBPYnNlcnZhYmxlPFxuICAgIHwgT3JnVW5pdEFjdGlvbnMuTG9hZEFzc2lnbmVkVXNlcnNTdWNjZXNzXG4gICAgfCBPcmdVbml0QWN0aW9ucy5Mb2FkQXNzaWduZWRVc2Vyc0ZhaWxcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyU3VjY2Vzc1xuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKE9yZ1VuaXRBY3Rpb25zLkxPQURfQVNTSUdORURfVVNFUlMpLFxuICAgICAgbWFwKChhY3Rpb246IE9yZ1VuaXRBY3Rpb25zLkxvYWRBc3NpZ25lZFVzZXJzKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBncm91cEJ5KCh7IG9yZ1VuaXRJZCwgcm9sZUlkLCBwYXJhbXMgfSkgPT5cbiAgICAgICAgU3RhdGVVdGlscy5zZXJpYWxpemVQYXJhbXMoW29yZ1VuaXRJZCwgcm9sZUlkXSwgcGFyYW1zKVxuICAgICAgKSxcbiAgICAgIG1lcmdlTWFwKChncm91cCkgPT5cbiAgICAgICAgZ3JvdXAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKHsgdXNlcklkLCBvcmdVbml0SWQsIHJvbGVJZCwgcGFyYW1zIH0pID0+IHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9yZ1VuaXRDb25uZWN0b3JcbiAgICAgICAgICAgICAgLmdldFVzZXJzKHVzZXJJZCwgb3JnVW5pdElkLCByb2xlSWQsIHBhcmFtcylcbiAgICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgc3dpdGNoTWFwKCh1c2VyczogRW50aXRpZXNNb2RlbDxCMkJVc2VyPikgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc3QgeyB2YWx1ZXMsIHBhZ2UgfSA9IFN0YXRlVXRpbHMubm9ybWFsaXplTGlzdFBhZ2UoXG4gICAgICAgICAgICAgICAgICAgIHVzZXJzLFxuICAgICAgICAgICAgICAgICAgICAnY3VzdG9tZXJJZCdcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJTdWNjZXNzKHZhbHVlcyksXG4gICAgICAgICAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Mb2FkQXNzaWduZWRVc2Vyc1N1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgICAgICAgIG9yZ1VuaXRJZCxcbiAgICAgICAgICAgICAgICAgICAgICByb2xlSWQsXG4gICAgICAgICAgICAgICAgICAgICAgcGFnZSxcbiAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLkxvYWRBc3NpZ25lZFVzZXJzRmFpbCh7XG4gICAgICAgICAgICAgICAgICAgICAgb3JnVW5pdElkLFxuICAgICAgICAgICAgICAgICAgICAgIHJvbGVJZCxcbiAgICAgICAgICAgICAgICAgICAgICBwYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgIH0pXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgYXNzaWduUm9sZVRvVXNlcjogT2JzZXJ2YWJsZTxcbiAgICBPcmdVbml0QWN0aW9ucy5Bc3NpZ25Sb2xlU3VjY2VzcyB8IE9yZ1VuaXRBY3Rpb25zLkFzc2lnblJvbGVGYWlsXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoT3JnVW5pdEFjdGlvbnMuQVNTSUdOX1JPTEUpLFxuICAgICAgbWFwKChhY3Rpb246IE9yZ1VuaXRBY3Rpb25zLkFzc2lnblJvbGUpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICAgIHN3aXRjaE1hcCgoeyB1c2VySWQsIG9yZ0N1c3RvbWVySWQsIHJvbGVJZCB9KSA9PlxuICAgICAgICB0aGlzLm9yZ1VuaXRDb25uZWN0b3IuYXNzaWduUm9sZSh1c2VySWQsIG9yZ0N1c3RvbWVySWQsIHJvbGVJZCkucGlwZShcbiAgICAgICAgICBtYXAoXG4gICAgICAgICAgICAoKSA9PlxuICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuQXNzaWduUm9sZVN1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgIHVpZDogb3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICByb2xlSWQsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHRydWUsXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgKSxcbiAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLkFzc2lnblJvbGVGYWlsKHtcbiAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICB1bmFzc2lnblJvbGVUb1VzZXIkOiBPYnNlcnZhYmxlPFxuICAgIE9yZ1VuaXRBY3Rpb25zLlVuYXNzaWduUm9sZVN1Y2Nlc3MgfCBPcmdVbml0QWN0aW9ucy5VbmFzc2lnblJvbGVGYWlsXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoT3JnVW5pdEFjdGlvbnMuVU5BU1NJR05fUk9MRSksXG4gICAgICBtYXAoKGFjdGlvbjogT3JnVW5pdEFjdGlvbnMuVW5hc3NpZ25Sb2xlKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBzd2l0Y2hNYXAoKHsgdXNlcklkLCBvcmdDdXN0b21lcklkLCByb2xlSWQgfSkgPT5cbiAgICAgICAgdGhpcy5vcmdVbml0Q29ubmVjdG9yLnVuYXNzaWduUm9sZSh1c2VySWQsIG9yZ0N1c3RvbWVySWQsIHJvbGVJZCkucGlwZShcbiAgICAgICAgICBtYXAoXG4gICAgICAgICAgICAoKSA9PlxuICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuVW5hc3NpZ25Sb2xlU3VjY2Vzcyh7XG4gICAgICAgICAgICAgICAgdWlkOiBvcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgICAgIHJvbGVJZCxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgKSxcbiAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLlVuYXNzaWduUm9sZUZhaWwoe1xuICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIGFzc2lnbkFwcHJvdmVyOiBPYnNlcnZhYmxlPFxuICAgIHwgT3JnVW5pdEFjdGlvbnMuQXNzaWduQXBwcm92ZXJTdWNjZXNzXG4gICAgfCBPcmdVbml0QWN0aW9ucy5Bc3NpZ25BcHByb3ZlckZhaWxcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoT3JnVW5pdEFjdGlvbnMuQVNTSUdOX0FQUFJPVkVSKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBPcmdVbml0QWN0aW9ucy5Bc3NpZ25BcHByb3ZlcikgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgICAgbWVyZ2VNYXAoKHsgdXNlcklkLCBvcmdVbml0SWQsIG9yZ0N1c3RvbWVySWQsIHJvbGVJZCB9KSA9PlxuICAgICAgICB0aGlzLm9yZ1VuaXRDb25uZWN0b3JcbiAgICAgICAgICAuYXNzaWduQXBwcm92ZXIodXNlcklkLCBvcmdVbml0SWQsIG9yZ0N1c3RvbWVySWQsIHJvbGVJZClcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIHN3aXRjaE1hcCgoKSA9PiBbXG4gICAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Bc3NpZ25BcHByb3ZlclN1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgIHVpZDogb3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICByb2xlSWQsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IHRydWUsXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgICBmcm9tKFtcbiAgICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuQXNzaWduQXBwcm92ZXJGYWlsKHtcbiAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIHVuYXNzaWduQXBwcm92ZXI6IE9ic2VydmFibGU8XG4gICAgfCBPcmdVbml0QWN0aW9ucy5VbmFzc2lnbkFwcHJvdmVyU3VjY2Vzc1xuICAgIHwgT3JnVW5pdEFjdGlvbnMuVW5hc3NpZ25BcHByb3ZlckZhaWxcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoT3JnVW5pdEFjdGlvbnMuVU5BU1NJR05fQVBQUk9WRVIpLFxuICAgICAgbWFwKChhY3Rpb246IE9yZ1VuaXRBY3Rpb25zLlVuYXNzaWduQXBwcm92ZXIpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICAgIG1lcmdlTWFwKCh7IHVzZXJJZCwgb3JnVW5pdElkLCBvcmdDdXN0b21lcklkLCByb2xlSWQgfSkgPT5cbiAgICAgICAgdGhpcy5vcmdVbml0Q29ubmVjdG9yXG4gICAgICAgICAgLnVuYXNzaWduQXBwcm92ZXIodXNlcklkLCBvcmdVbml0SWQsIG9yZ0N1c3RvbWVySWQsIHJvbGVJZClcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIHN3aXRjaE1hcCgoKSA9PiBbXG4gICAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5VbmFzc2lnbkFwcHJvdmVyU3VjY2Vzcyh7XG4gICAgICAgICAgICAgICAgdWlkOiBvcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgICAgIHJvbGVJZCxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZDogZmFsc2UsXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgICBmcm9tKFtcbiAgICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuVW5hc3NpZ25BcHByb3ZlckZhaWwoe1xuICAgICAgICAgICAgICAgICAgb3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgY3JlYXRlQWRkcmVzcyQ6IE9ic2VydmFibGU8XG4gICAgfCBPcmdVbml0QWN0aW9ucy5DcmVhdGVBZGRyZXNzU3VjY2Vzc1xuICAgIHwgT3JnVW5pdEFjdGlvbnMuQ3JlYXRlQWRkcmVzc0ZhaWxcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoT3JnVW5pdEFjdGlvbnMuQ1JFQVRFX0FERFJFU1MpLFxuICAgICAgbWFwKChhY3Rpb246IE9yZ1VuaXRBY3Rpb25zLkNyZWF0ZUFkZHJlc3MpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICAgIHN3aXRjaE1hcCgocGF5bG9hZCkgPT5cbiAgICAgICAgdGhpcy5vcmdVbml0Q29ubmVjdG9yXG4gICAgICAgICAgLmNyZWF0ZUFkZHJlc3MocGF5bG9hZC51c2VySWQsIHBheWxvYWQub3JnVW5pdElkLCBwYXlsb2FkLmFkZHJlc3MpXG4gICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICBzd2l0Y2hNYXAoKGRhdGEpID0+IFtcbiAgICAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLkNyZWF0ZUFkZHJlc3NTdWNjZXNzKGRhdGEpLFxuICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuQ3JlYXRlQWRkcmVzc1N1Y2Nlc3MoeyBpZDogdW5kZWZpbmVkIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgICBmcm9tKFtcbiAgICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuQ3JlYXRlQWRkcmVzc0ZhaWwoe1xuICAgICAgICAgICAgICAgICAgYWRkcmVzc0lkOiBwYXlsb2FkLmFkZHJlc3MuaWQgPz8gJycsXG4gICAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIHVwZGF0ZUFkZHJlc3MkOiBPYnNlcnZhYmxlPFxuICAgIHwgT3JnVW5pdEFjdGlvbnMuVXBkYXRlQWRkcmVzc1N1Y2Nlc3NcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLlVwZGF0ZUFkZHJlc3NGYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKE9yZ1VuaXRBY3Rpb25zLlVQREFURV9BRERSRVNTKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBPcmdVbml0QWN0aW9ucy5VcGRhdGVBZGRyZXNzKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBzd2l0Y2hNYXAoKHsgdXNlcklkLCBvcmdVbml0SWQsIGFkZHJlc3NJZCwgYWRkcmVzcyB9KSA9PlxuICAgICAgICB0aGlzLm9yZ1VuaXRDb25uZWN0b3JcbiAgICAgICAgICAudXBkYXRlQWRkcmVzcyh1c2VySWQsIG9yZ1VuaXRJZCwgYWRkcmVzc0lkLCBhZGRyZXNzKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgc3dpdGNoTWFwKCgpID0+IFtcbiAgICAgICAgICAgICAgLy8gY29tbWVudGVkIG91dCBkdWUgdG8gbm8gcmVzcG9uc2UgZnJvbSBiYWNrZW5kIG9uIFBBVENIIHJlcXVlc3RcbiAgICAgICAgICAgICAgLy8gbmV3IE9yZ1VuaXRBY3Rpb25zLlVwZGF0ZUFkZHJlc3NTdWNjZXNzKGRhdGEpLFxuICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuVXBkYXRlQWRkcmVzc1N1Y2Nlc3MoYWRkcmVzcyksXG4gICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5VcGRhdGVBZGRyZXNzRmFpbCh7XG4gICAgICAgICAgICAgICAgICBhZGRyZXNzSWQ6IGFkZHJlc3MuaWQgPz8gJycsXG4gICAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIGRlbGV0ZUFkZHJlc3MkOiBPYnNlcnZhYmxlPFxuICAgIHwgT3JnVW5pdEFjdGlvbnMuRGVsZXRlQWRkcmVzc1N1Y2Nlc3NcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLkRlbGV0ZUFkZHJlc3NGYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKE9yZ1VuaXRBY3Rpb25zLkRFTEVURV9BRERSRVNTKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBPcmdVbml0QWN0aW9ucy5EZWxldGVBZGRyZXNzKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBzd2l0Y2hNYXAoKHBheWxvYWQpID0+XG4gICAgICAgIHRoaXMub3JnVW5pdENvbm5lY3RvclxuICAgICAgICAgIC5kZWxldGVBZGRyZXNzKHBheWxvYWQudXNlcklkLCBwYXlsb2FkLm9yZ1VuaXRJZCwgcGF5bG9hZC5hZGRyZXNzSWQpXG4gICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICBzd2l0Y2hNYXAoKCkgPT4gW1xuICAgICAgICAgICAgICBuZXcgT3JnVW5pdEFjdGlvbnMuRGVsZXRlQWRkcmVzc1N1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgIGlkOiBwYXlsb2FkLmFkZHJlc3NJZCxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5EZWxldGVBZGRyZXNzRmFpbCh7XG4gICAgICAgICAgICAgICAgICBhZGRyZXNzSWQ6IHBheWxvYWQuYWRkcmVzc0lkLFxuICAgICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICAvLyBARWZmZWN0KClcbiAgLy8gbG9hZEFkZHJlc3MkOiBPYnNlcnZhYmxlPFxuICAvLyAgIHwgT3JnVW5pdEFjdGlvbnMuTG9hZEFkZHJlc3NTdWNjZXNzXG4gIC8vICAgfCBPcmdVbml0QWN0aW9ucy5Mb2FkQWRkcmVzc2VzU3VjY2Vzc1xuICAvLyAgIHwgT3JnVW5pdEFjdGlvbnMuTG9hZEFkZHJlc3Nlc0ZhaWxcbiAgLy8gPiA9IHRoaXMuYWN0aW9ucyQucGlwZShcbiAgLy8gICBvZlR5cGUoT3JnVW5pdEFjdGlvbnMuTE9BRF9BRERSRVNTRVMpLFxuICAvLyAgIG1hcCgoYWN0aW9uOiBPcmdVbml0QWN0aW9ucy5Mb2FkQWRkcmVzc2VzKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gIC8vICAgc3dpdGNoTWFwKCh7IHVzZXJJZCwgb3JnVW5pdElkIH0pID0+IHtcbiAgLy8gICAgIHJldHVybiB0aGlzLm9yZ1VuaXRDb25uZWN0b3IuZ2V0QWRkcmVzc2VzKHVzZXJJZCwgb3JnVW5pdElkKS5waXBlKFxuICAvLyAgICAgICBzd2l0Y2hNYXAoKGFkZHJlc3NlczogRW50aXRpZXNNb2RlbDxCMkJBZGRyZXNzPikgPT4ge1xuICAvLyAgICAgICAgIGNvbnN0IHsgdmFsdWVzLCBwYWdlIH0gPSBTdGF0ZVV0aWxzLm5vcm1hbGl6ZUxpc3RQYWdlKGFkZHJlc3NlcywgJ2lkJyk7XG4gIC8vICAgICAgICAgcmV0dXJuIFtcbiAgLy8gICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Mb2FkQWRkcmVzc1N1Y2Nlc3ModmFsdWVzKSxcbiAgLy8gICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Mb2FkQWRkcmVzc2VzU3VjY2Vzcyh7IHBhZ2UsIG9yZ1VuaXRJZCB9KSxcbiAgLy8gICAgICAgICBdO1xuICAvLyAgICAgICB9KSxcbiAgLy8gICAgICAgY2F0Y2hFcnJvcihlcnJvciA9PlxuICAvLyAgICAgICAgIG9mKFxuICAvLyAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLkxvYWRBZGRyZXNzZXNGYWlsKHtcbiAgLy8gICAgICAgICAgICAgb3JnVW5pdElkLFxuICAvLyAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgLy8gICAgICAgICAgIH0pXG4gIC8vICAgICAgICAgKVxuICAvLyAgICAgICApXG4gIC8vICAgICApO1xuICAvLyAgIH0pXG4gIC8vICk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBhY3Rpb25zJDogQWN0aW9ucyxcbiAgICBwcml2YXRlIG9yZ1VuaXRDb25uZWN0b3I6IE9yZ1VuaXRDb25uZWN0b3JcbiAgKSB7fVxufVxuIl19