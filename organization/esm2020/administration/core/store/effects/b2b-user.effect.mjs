import { Injectable } from '@angular/core';
import { createEffect, ofType } from '@ngrx/effects';
import { AuthActions, B2BUserRole, normalizeHttpError, StateUtils, } from '@spartacus/core';
import { from, of } from 'rxjs';
import { catchError, groupBy, map, mergeMap, switchMap, take, tap, withLatestFrom, } from 'rxjs/operators';
import { B2BUserActions, OrganizationActions, OrgUnitActions, PermissionActions, UserGroupActions, } from '../actions/index';
import * as i0 from "@angular/core";
import * as i1 from "@ngrx/effects";
import * as i2 from "../../connectors/b2b-user/b2b-user.connector";
import * as i3 from "@spartacus/core";
import * as i4 from "@spartacus/user/account/root";
export class B2BUserEffects {
    constructor(actions$, b2bUserConnector, routingService, userAccountFacade, userIdService) {
        this.actions$ = actions$;
        this.b2bUserConnector = b2bUserConnector;
        this.routingService = routingService;
        this.userAccountFacade = userAccountFacade;
        this.userIdService = userIdService;
        this.loadB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.LOAD_B2B_USER), map((action) => action.payload), switchMap(({ userId, orgCustomerId }) => {
            return this.b2bUserConnector.get(userId, orgCustomerId).pipe(map((b2bUser) => {
                return new B2BUserActions.LoadB2BUserSuccess([b2bUser]);
            }), catchError((error) => of(new B2BUserActions.LoadB2BUserFail({
                orgCustomerId,
                error: normalizeHttpError(error),
            }))));
        })));
        this.createB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.CREATE_B2B_USER), map((action) => action.payload), switchMap(({ userId, orgCustomer }) => this.b2bUserConnector.create(userId, orgCustomer).pipe(switchMap((data) => {
            const isAssignedToApprovers = orgCustomer.isAssignedToApprovers;
            // TODO Workaround for not known customerId while user creation (redireciton)
            return this.routingService.getRouterState().pipe(take(1), tap((route) => this.redirectToDetails(route, data)), switchMap(() => {
                const successActions = [
                    new B2BUserActions.CreateB2BUserSuccess(data),
                    new B2BUserActions.CreateB2BUserSuccess({
                        customerId: undefined,
                    }),
                    new OrganizationActions.OrganizationClearData(),
                ];
                if (isAssignedToApprovers) {
                    successActions.splice(1, 0, new OrgUnitActions.AssignApprover({
                        userId,
                        orgUnitId: orgCustomer.orgUnit?.uid ?? '',
                        orgCustomerId: data.customerId ?? '',
                        roleId: B2BUserRole.APPROVER,
                    }));
                }
                return successActions;
            }));
        }), catchError((error) => from([
            new B2BUserActions.CreateB2BUserFail({
                orgCustomerId: orgCustomer.customerId ?? '',
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.updateB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.UPDATE_B2B_USER), map((action) => action.payload), switchMap(({ userId, orgCustomerId, orgCustomer }) => {
            const isAssignedToApprovers = orgCustomer.isAssignedToApprovers;
            return this.b2bUserConnector
                .update(userId, orgCustomerId, orgCustomer)
                .pipe(switchMap((_data) => {
                const successActions = [
                    // TODO: change for 'payload: data' when backend API start to return user data on PATCH
                    new B2BUserActions.UpdateB2BUserSuccess(orgCustomer),
                ];
                if (isAssignedToApprovers) {
                    successActions.push(new OrgUnitActions.AssignApprover({
                        userId,
                        orgUnitId: orgCustomer.orgUnit?.uid ?? '',
                        orgCustomerId,
                        roleId: B2BUserRole.APPROVER,
                    }));
                }
                return successActions;
            }), catchError((error) => from([
                new B2BUserActions.UpdateB2BUserFail({
                    orgCustomerId: orgCustomer.customerId ?? '',
                    error: normalizeHttpError(error),
                }),
                new OrganizationActions.OrganizationClearData(),
            ])));
        })));
        this.checkSelfEmailUpdate$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.UPDATE_B2B_USER_SUCCESS), map((action) => action.payload), withLatestFrom(this.userAccountFacade.get(), this.userIdService.getUserId()), switchMap(([payload, currentUser]) => {
            const currentUserEmailMatch = payload.customerId === currentUser?.customerId &&
                payload.email !== currentUser?.displayUid;
            if (currentUserEmailMatch) {
                this.routingService.go({ cxRoute: 'login' });
            }
            return currentUserEmailMatch
                ? [new AuthActions.Logout()]
                : [new OrganizationActions.OrganizationClearData()];
        })));
        this.loadB2BUsers$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.LOAD_B2B_USERS), map((action) => action.payload), switchMap((payload) => this.b2bUserConnector.getList(payload.userId, payload.params).pipe(switchMap((b2bUsers) => {
            const { values, page } = StateUtils.normalizeListPage(b2bUsers, 'customerId');
            return [
                new B2BUserActions.LoadB2BUserSuccess(values),
                new B2BUserActions.LoadB2BUsersSuccess({
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new B2BUserActions.LoadB2BUsersFail({
            params: payload.params,
            error: normalizeHttpError(error),
        })))))));
        this.loadB2BUserApprovers$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.LOAD_B2B_USER_APPROVERS), map((action) => action.payload), groupBy(({ orgCustomerId, params }) => StateUtils.serializeParams(orgCustomerId, params)), mergeMap((group) => group.pipe(switchMap((payload) => this.b2bUserConnector
            .getApprovers(payload.userId, payload.orgCustomerId, payload.params)
            .pipe(switchMap((approvers) => {
            const { values, page } = StateUtils.normalizeListPage(approvers, 'customerId');
            return [
                new B2BUserActions.LoadB2BUserSuccess(values),
                new B2BUserActions.LoadB2BUserApproversSuccess({
                    orgCustomerId: payload.orgCustomerId,
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new B2BUserActions.LoadB2BUserApproversFail({
            orgCustomerId: payload.orgCustomerId,
            params: payload.params,
            error: normalizeHttpError(error),
        })))))))));
        this.loadB2BUserPermissions$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.LOAD_B2B_USER_PERMISSIONS), map((action) => action.payload), groupBy(({ orgCustomerId, params }) => StateUtils.serializeParams(orgCustomerId, params)), mergeMap((group) => group.pipe(switchMap((payload) => this.b2bUserConnector
            .getPermissions(payload.userId, payload.orgCustomerId, payload.params)
            .pipe(switchMap((permissions) => {
            const { values, page } = StateUtils.normalizeListPage(permissions, 'code');
            return [
                new PermissionActions.LoadPermissionSuccess(values),
                new B2BUserActions.LoadB2BUserPermissionsSuccess({
                    orgCustomerId: payload.orgCustomerId,
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new B2BUserActions.LoadB2BUserPermissionsFail({
            orgCustomerId: payload.orgCustomerId,
            params: payload.params,
            error: normalizeHttpError(error),
        })))))))));
        this.loadB2BUserUserGroups$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.LOAD_B2B_USER_USER_GROUPS), map((action) => action.payload), groupBy(({ orgCustomerId, params }) => StateUtils.serializeParams(orgCustomerId, params)), mergeMap((group) => group.pipe(switchMap((payload) => this.b2bUserConnector
            .getUserGroups(payload.userId, payload.orgCustomerId, payload.params)
            .pipe(switchMap((userGroups) => {
            const { values, page } = StateUtils.normalizeListPage(userGroups, 'uid');
            return [
                new UserGroupActions.LoadUserGroupSuccess(values),
                new B2BUserActions.LoadB2BUserUserGroupsSuccess({
                    orgCustomerId: payload.orgCustomerId,
                    page,
                    params: payload.params,
                }),
            ];
        }), catchError((error) => of(new B2BUserActions.LoadB2BUserUserGroupsFail({
            orgCustomerId: payload.orgCustomerId,
            params: payload.params,
            error: normalizeHttpError(error),
        })))))))));
        this.assignApproverToB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.ASSIGN_B2B_USER_APPROVER), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .assignApprover(payload.userId, payload.orgCustomerId, payload.approverId)
            .pipe(switchMap((data) => [
            new B2BUserActions.AssignB2BUserApproverSuccess({
                // Occ returned email, but we use customerId in store
                approverId: payload.approverId,
                selected: data.selected,
            }),
            // Clearing data in this case causes unexpected behavior (#10468)
            // new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.AssignB2BUserApproverFail({
                orgCustomerId: payload.orgCustomerId,
                approverId: payload.approverId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.unassignApproverFromB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.UNASSIGN_B2B_USER_APPROVER), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .unassignApprover(payload.userId, payload.orgCustomerId, payload.approverId)
            .pipe(switchMap((data) => [
            new B2BUserActions.UnassignB2BUserApproverSuccess({
                // Occ returned email, but we use customerId in store
                approverId: payload.approverId,
                selected: data.selected,
            }),
            // Clearing data in this case causes unexpected behavior (#10468)
            // new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.UnassignB2BUserApproverFail({
                orgCustomerId: payload.orgCustomerId,
                approverId: payload.approverId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.assignPermissionToB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.ASSIGN_B2B_USER_PERMISSION), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .assignPermission(payload.userId, payload.orgCustomerId, payload.permissionId)
            .pipe(switchMap((data) => [
            new B2BUserActions.AssignB2BUserPermissionSuccess({
                permissionId: data.id,
                selected: data.selected,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.AssignB2BUserPermissionFail({
                orgCustomerId: payload.orgCustomerId,
                permissionId: payload.permissionId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.unassignPermissionFromB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.UNASSIGN_B2B_USER_PERMISSION), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .unassignPermission(payload.userId, payload.orgCustomerId, payload.permissionId)
            .pipe(switchMap((data) => [
            new B2BUserActions.UnassignB2BUserPermissionSuccess({
                permissionId: data.id,
                selected: data.selected,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.UnassignB2BUserPermissionFail({
                orgCustomerId: payload.orgCustomerId,
                permissionId: payload.permissionId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.assignUserGroupToB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.ASSIGN_B2B_USER_USER_GROUP), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .assignUserGroup(payload.userId, payload.orgCustomerId, payload.userGroupId)
            .pipe(switchMap((data) => [
            new B2BUserActions.AssignB2BUserUserGroupSuccess({
                uid: data.id,
                selected: data.selected,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.AssignB2BUserUserGroupFail({
                orgCustomerId: payload.orgCustomerId,
                userGroupId: payload.userGroupId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
        this.unassignUserGroupFromB2BUser$ = createEffect(() => this.actions$.pipe(ofType(B2BUserActions.UNASSIGN_B2B_USER_USER_GROUP), map((action) => action.payload), mergeMap((payload) => this.b2bUserConnector
            .unassignUserGroup(payload.userId, payload.orgCustomerId, payload.userGroupId)
            .pipe(switchMap(
        // TODO: Workaround because occ doesn't respond here
        // (data) =>
        //   new B2BUserActions.DeleteB2BUserUserGroupSuccess({
        //     uid: data.id,
        //     selected: data.selected,
        //   })
        () => [
            new B2BUserActions.UnassignB2BUserUserGroupSuccess({
                uid: payload.userGroupId,
                selected: false,
            }),
            new OrganizationActions.OrganizationClearData(),
        ]), catchError((error) => from([
            new B2BUserActions.UnassignB2BUserUserGroupFail({
                orgCustomerId: payload.orgCustomerId,
                userGroupId: payload.userGroupId,
                error: normalizeHttpError(error),
            }),
            new OrganizationActions.OrganizationClearData(),
        ]))))));
    }
    redirectToDetails(route, data) {
        if (route?.state?.context?.id !== '/organization/units') {
            this.routingService.go({
                cxRoute: 'orgUserDetails',
                params: data,
            });
        }
    }
}
B2BUserEffects.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: B2BUserEffects, deps: [{ token: i1.Actions }, { token: i2.B2BUserConnector }, { token: i3.RoutingService }, { token: i4.UserAccountFacade }, { token: i3.UserIdService }], target: i0.ɵɵFactoryTarget.Injectable });
B2BUserEffects.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: B2BUserEffects });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: B2BUserEffects, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.Actions }, { type: i2.B2BUserConnector }, { type: i3.RoutingService }, { type: i4.UserAccountFacade }, { type: i3.UserIdService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYjJiLXVzZXIuZWZmZWN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL29yZ2FuaXphdGlvbi9hZG1pbmlzdHJhdGlvbi9jb3JlL3N0b3JlL2VmZmVjdHMvYjJiLXVzZXIuZWZmZWN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQU9BLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFXLFlBQVksRUFBRSxNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDOUQsT0FBTyxFQUNMLFdBQVcsRUFFWCxXQUFXLEVBRVgsa0JBQWtCLEVBR2xCLFVBQVUsR0FHWCxNQUFNLGlCQUFpQixDQUFDO0FBRXpCLE9BQU8sRUFBRSxJQUFJLEVBQWMsRUFBRSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzVDLE9BQU8sRUFDTCxVQUFVLEVBQ1YsT0FBTyxFQUNQLEdBQUcsRUFDSCxRQUFRLEVBQ1IsU0FBUyxFQUNULElBQUksRUFDSixHQUFHLEVBQ0gsY0FBYyxHQUNmLE1BQU0sZ0JBQWdCLENBQUM7QUFJeEIsT0FBTyxFQUNMLGNBQWMsRUFDZCxtQkFBbUIsRUFDbkIsY0FBYyxFQUNkLGlCQUFpQixFQUNqQixnQkFBZ0IsR0FDakIsTUFBTSxrQkFBa0IsQ0FBQzs7Ozs7O0FBRzFCLE1BQU0sT0FBTyxjQUFjO0lBdWtCekIsWUFDVSxRQUFpQixFQUNqQixnQkFBa0MsRUFDbEMsY0FBOEIsRUFDOUIsaUJBQW9DLEVBQ3BDLGFBQTRCO1FBSjVCLGFBQVEsR0FBUixRQUFRLENBQVM7UUFDakIscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQUNsQyxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7UUFDOUIsc0JBQWlCLEdBQWpCLGlCQUFpQixDQUFtQjtRQUNwQyxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQTNrQnRDLGlCQUFZLEdBRVIsWUFBWSxDQUFDLEdBQUcsRUFBRSxDQUNwQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDaEIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsRUFDcEMsR0FBRyxDQUFDLENBQUMsTUFBa0MsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUMzRCxTQUFTLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQUUsRUFBRSxFQUFFO1lBQ3RDLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUMxRCxHQUFHLENBQUMsQ0FBQyxPQUFnQixFQUFFLEVBQUU7Z0JBQ3ZCLE9BQU8sSUFBSSxjQUFjLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQzFELENBQUMsQ0FBQyxFQUNGLFVBQVUsQ0FBQyxDQUFDLEtBQXdCLEVBQUUsRUFBRSxDQUN0QyxFQUFFLENBQ0EsSUFBSSxjQUFjLENBQUMsZUFBZSxDQUFDO2dCQUNqQyxhQUFhO2dCQUNiLEtBQUssRUFBRSxrQkFBa0IsQ0FBQyxLQUFLLENBQUM7YUFDakMsQ0FBQyxDQUNILENBQ0YsQ0FDRixDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQ0gsQ0FDRixDQUFDO1FBRUYsbUJBQWMsR0FLVixZQUFZLENBQUMsR0FBRyxFQUFFLENBQ3BCLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUNoQixNQUFNLENBQUMsY0FBYyxDQUFDLGVBQWUsQ0FBQyxFQUN0QyxHQUFHLENBQUMsQ0FBQyxNQUFvQyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQzdELFNBQVMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxFQUFFLEVBQUUsQ0FDcEMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUNwRCxTQUFTLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRTtZQUNqQixNQUFNLHFCQUFxQixHQUFHLFdBQVcsQ0FBQyxxQkFBcUIsQ0FBQztZQUNoRSw2RUFBNkU7WUFDN0UsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLGNBQWMsRUFBRSxDQUFDLElBQUksQ0FDOUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUNQLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxFQUNuRCxTQUFTLENBQUMsR0FBRyxFQUFFO2dCQUNiLE1BQU0sY0FBYyxHQUFHO29CQUNyQixJQUFJLGNBQWMsQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUM7b0JBQzdDLElBQUksY0FBYyxDQUFDLG9CQUFvQixDQUFDO3dCQUN0QyxVQUFVLEVBQUUsU0FBUztxQkFDdEIsQ0FBQztvQkFDRixJQUFJLG1CQUFtQixDQUFDLHFCQUFxQixFQUFFO2lCQUN2QyxDQUFDO2dCQUNYLElBQUkscUJBQXFCLEVBQUU7b0JBQ3pCLGNBQWMsQ0FBQyxNQUFNLENBQ25CLENBQUMsRUFDRCxDQUFDLEVBQ0QsSUFBSSxjQUFjLENBQUMsY0FBYyxDQUFDO3dCQUNoQyxNQUFNO3dCQUNOLFNBQVMsRUFBRSxXQUFXLENBQUMsT0FBTyxFQUFFLEdBQUcsSUFBSSxFQUFFO3dCQUN6QyxhQUFhLEVBQUUsSUFBSSxDQUFDLFVBQVUsSUFBSSxFQUFFO3dCQUNwQyxNQUFNLEVBQUUsV0FBVyxDQUFDLFFBQVE7cUJBQzdCLENBQUMsQ0FDSCxDQUFDO2lCQUNIO2dCQUNELE9BQU8sY0FBYyxDQUFDO1lBQ3hCLENBQUMsQ0FBQyxDQUNILENBQUM7UUFDSixDQUFDLENBQUMsRUFDRixVQUFVLENBQUMsQ0FBQyxLQUF3QixFQUFFLEVBQUUsQ0FDdEMsSUFBSSxDQUFDO1lBQ0gsSUFBSSxjQUFjLENBQUMsaUJBQWlCLENBQUM7Z0JBQ25DLGFBQWEsRUFBRSxXQUFXLENBQUMsVUFBVSxJQUFJLEVBQUU7Z0JBQzNDLEtBQUssRUFBRSxrQkFBa0IsQ0FBQyxLQUFLLENBQUM7YUFDakMsQ0FBQztZQUNGLElBQUksbUJBQW1CLENBQUMscUJBQXFCLEVBQUU7U0FDaEQsQ0FBQyxDQUNILENBQ0YsQ0FDRixDQUNGLENBQ0YsQ0FBQztRQUVGLG1CQUFjLEdBS1YsWUFBWSxDQUFDLEdBQUcsRUFBRSxDQUNwQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDaEIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxlQUFlLENBQUMsRUFDdEMsR0FBRyxDQUFDLENBQUMsTUFBb0MsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUM3RCxTQUFTLENBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQUUsV0FBVyxFQUFFLEVBQUUsRUFBRTtZQUNuRCxNQUFNLHFCQUFxQixHQUFHLFdBQVcsQ0FBQyxxQkFBcUIsQ0FBQztZQUNoRSxPQUFPLElBQUksQ0FBQyxnQkFBZ0I7aUJBQ3pCLE1BQU0sQ0FBQyxNQUFNLEVBQUUsYUFBYSxFQUFFLFdBQVcsQ0FBQztpQkFDMUMsSUFBSSxDQUNILFNBQVMsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFO2dCQUNsQixNQUFNLGNBQWMsR0FBRztvQkFDckIsdUZBQXVGO29CQUN2RixJQUFJLGNBQWMsQ0FBQyxvQkFBb0IsQ0FBQyxXQUFXLENBQUM7aUJBQzVDLENBQUM7Z0JBQ1gsSUFBSSxxQkFBcUIsRUFBRTtvQkFDekIsY0FBYyxDQUFDLElBQUksQ0FDakIsSUFBSSxjQUFjLENBQUMsY0FBYyxDQUFDO3dCQUNoQyxNQUFNO3dCQUNOLFNBQVMsRUFBRSxXQUFXLENBQUMsT0FBTyxFQUFFLEdBQUcsSUFBSSxFQUFFO3dCQUN6QyxhQUFhO3dCQUNiLE1BQU0sRUFBRSxXQUFXLENBQUMsUUFBUTtxQkFDN0IsQ0FBQyxDQUNILENBQUM7aUJBQ0g7Z0JBQ0QsT0FBTyxjQUFjLENBQUM7WUFDeEIsQ0FBQyxDQUFDLEVBQ0YsVUFBVSxDQUFDLENBQUMsS0FBd0IsRUFBRSxFQUFFLENBQ3RDLElBQUksQ0FBQztnQkFDSCxJQUFJLGNBQWMsQ0FBQyxpQkFBaUIsQ0FBQztvQkFDbkMsYUFBYSxFQUFFLFdBQVcsQ0FBQyxVQUFVLElBQUksRUFBRTtvQkFDM0MsS0FBSyxFQUFFLGtCQUFrQixDQUFDLEtBQUssQ0FBQztpQkFDakMsQ0FBQztnQkFDRixJQUFJLG1CQUFtQixDQUFDLHFCQUFxQixFQUFFO2FBQ2hELENBQUMsQ0FDSCxDQUNGLENBQUM7UUFDTixDQUFDLENBQUMsQ0FDSCxDQUNGLENBQUM7UUFFRiwwQkFBcUIsR0FJakIsWUFBWSxDQUFDLEdBQUcsRUFBRSxDQUNwQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDaEIsTUFBTSxDQUFDLGNBQWMsQ0FBQyx1QkFBdUIsQ0FBQyxFQUM5QyxHQUFHLENBQUMsQ0FBQyxNQUEyQyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQ3BFLGNBQWMsQ0FDWixJQUFJLENBQUMsaUJBQWlCLENBQUMsR0FBRyxFQUFFLEVBQzVCLElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxFQUFFLENBQy9CLEVBQ0QsU0FBUyxDQUNQLENBQUMsQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFzQyxFQUFFLEVBQUU7WUFDOUQsTUFBTSxxQkFBcUIsR0FDekIsT0FBTyxDQUFDLFVBQVUsS0FBSyxXQUFXLEVBQUUsVUFBVTtnQkFDOUMsT0FBTyxDQUFDLEtBQUssS0FBSyxXQUFXLEVBQUUsVUFBVSxDQUFDO1lBRTVDLElBQUkscUJBQXFCLEVBQUU7Z0JBQ3pCLElBQUksQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUM7YUFDOUM7WUFDRCxPQUFPLHFCQUFxQjtnQkFDMUIsQ0FBQyxDQUFDLENBQUMsSUFBSSxXQUFXLENBQUMsTUFBTSxFQUFFLENBQUM7Z0JBQzVCLENBQUMsQ0FBQyxDQUFDLElBQUksbUJBQW1CLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxDQUFDO1FBQ3hELENBQUMsQ0FDRixDQUNGLENBQ0YsQ0FBQztRQUVGLGtCQUFhLEdBSVQsWUFBWSxDQUFDLEdBQUcsRUFBRSxDQUNwQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDaEIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsRUFDckMsR0FBRyxDQUFDLENBQUMsTUFBbUMsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUM1RCxTQUFTLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUNwQixJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FDaEUsU0FBUyxDQUFDLENBQUMsUUFBZ0MsRUFBRSxFQUFFO1lBQzdDLE1BQU0sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsVUFBVSxDQUFDLGlCQUFpQixDQUNuRCxRQUFRLEVBQ1IsWUFBWSxDQUNiLENBQUM7WUFDRixPQUFPO2dCQUNMLElBQUksY0FBYyxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQztnQkFDN0MsSUFBSSxjQUFjLENBQUMsbUJBQW1CLENBQUM7b0JBQ3JDLElBQUk7b0JBQ0osTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNO2lCQUN2QixDQUFDO2FBQ0gsQ0FBQztRQUNKLENBQUMsQ0FBQyxFQUNGLFVBQVUsQ0FBQyxDQUFDLEtBQXdCLEVBQUUsRUFBRSxDQUN0QyxFQUFFLENBQ0EsSUFBSSxjQUFjLENBQUMsZ0JBQWdCLENBQUM7WUFDbEMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNO1lBQ3RCLEtBQUssRUFBRSxrQkFBa0IsQ0FBQyxLQUFLLENBQUM7U0FDakMsQ0FBQyxDQUNILENBQ0YsQ0FDRixDQUNGLENBQ0YsQ0FDRixDQUFDO1FBRUYsMEJBQXFCLEdBSWpCLFlBQVksQ0FBQyxHQUFHLEVBQUUsQ0FDcEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQ2hCLE1BQU0sQ0FBQyxjQUFjLENBQUMsdUJBQXVCLENBQUMsRUFDOUMsR0FBRyxDQUFDLENBQUMsTUFBMkMsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUNwRSxPQUFPLENBQUMsQ0FBQyxFQUFFLGFBQWEsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLENBQ3BDLFVBQVUsQ0FBQyxlQUFlLENBQUMsYUFBYSxFQUFFLE1BQU0sQ0FBQyxDQUNsRCxFQUNELFFBQVEsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQ2pCLEtBQUssQ0FBQyxJQUFJLENBQ1IsU0FBUyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FDcEIsSUFBSSxDQUFDLGdCQUFnQjthQUNsQixZQUFZLENBQ1gsT0FBTyxDQUFDLE1BQU0sRUFDZCxPQUFPLENBQUMsYUFBYSxFQUNyQixPQUFPLENBQUMsTUFBTSxDQUNmO2FBQ0EsSUFBSSxDQUNILFNBQVMsQ0FBQyxDQUFDLFNBQWlDLEVBQUUsRUFBRTtZQUM5QyxNQUFNLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLFVBQVUsQ0FBQyxpQkFBaUIsQ0FDbkQsU0FBUyxFQUNULFlBQVksQ0FDYixDQUFDO1lBQ0YsT0FBTztnQkFDTCxJQUFJLGNBQWMsQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLENBQUM7Z0JBQzdDLElBQUksY0FBYyxDQUFDLDJCQUEyQixDQUFDO29CQUM3QyxhQUFhLEVBQUUsT0FBTyxDQUFDLGFBQWE7b0JBQ3BDLElBQUk7b0JBQ0osTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNO2lCQUN2QixDQUFDO2FBQ0gsQ0FBQztRQUNKLENBQUMsQ0FBQyxFQUNGLFVBQVUsQ0FBQyxDQUFDLEtBQXdCLEVBQUUsRUFBRSxDQUN0QyxFQUFFLENBQ0EsSUFBSSxjQUFjLENBQUMsd0JBQXdCLENBQUM7WUFDMUMsYUFBYSxFQUFFLE9BQU8sQ0FBQyxhQUFhO1lBQ3BDLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTTtZQUN0QixLQUFLLEVBQUUsa0JBQWtCLENBQUMsS0FBSyxDQUFDO1NBQ2pDLENBQUMsQ0FDSCxDQUNGLENBQ0YsQ0FDSixDQUNGLENBQ0YsQ0FDRixDQUNGLENBQUM7UUFFRiw0QkFBdUIsR0FJbkIsWUFBWSxDQUFDLEdBQUcsRUFBRSxDQUNwQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDaEIsTUFBTSxDQUFDLGNBQWMsQ0FBQyx5QkFBeUIsQ0FBQyxFQUNoRCxHQUFHLENBQUMsQ0FBQyxNQUE2QyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQ3RFLE9BQU8sQ0FBQyxDQUFDLEVBQUUsYUFBYSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsQ0FDcEMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxhQUFhLEVBQUUsTUFBTSxDQUFDLENBQ2xELEVBQ0QsUUFBUSxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FDakIsS0FBSyxDQUFDLElBQUksQ0FDUixTQUFTLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUNwQixJQUFJLENBQUMsZ0JBQWdCO2FBQ2xCLGNBQWMsQ0FDYixPQUFPLENBQUMsTUFBTSxFQUNkLE9BQU8sQ0FBQyxhQUFhLEVBQ3JCLE9BQU8sQ0FBQyxNQUFNLENBQ2Y7YUFDQSxJQUFJLENBQ0gsU0FBUyxDQUFDLENBQUMsV0FBc0MsRUFBRSxFQUFFO1lBQ25ELE1BQU0sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsVUFBVSxDQUFDLGlCQUFpQixDQUNuRCxXQUFXLEVBQ1gsTUFBTSxDQUNQLENBQUM7WUFDRixPQUFPO2dCQUNMLElBQUksaUJBQWlCLENBQUMscUJBQXFCLENBQUMsTUFBTSxDQUFDO2dCQUNuRCxJQUFJLGNBQWMsQ0FBQyw2QkFBNkIsQ0FBQztvQkFDL0MsYUFBYSxFQUFFLE9BQU8sQ0FBQyxhQUFhO29CQUNwQyxJQUFJO29CQUNKLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTTtpQkFDdkIsQ0FBQzthQUNILENBQUM7UUFDSixDQUFDLENBQUMsRUFDRixVQUFVLENBQUMsQ0FBQyxLQUF3QixFQUFFLEVBQUUsQ0FDdEMsRUFBRSxDQUNBLElBQUksY0FBYyxDQUFDLDBCQUEwQixDQUFDO1lBQzVDLGFBQWEsRUFBRSxPQUFPLENBQUMsYUFBYTtZQUNwQyxNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU07WUFDdEIsS0FBSyxFQUFFLGtCQUFrQixDQUFDLEtBQUssQ0FBQztTQUNqQyxDQUFDLENBQ0gsQ0FDRixDQUNGLENBQ0osQ0FDRixDQUNGLENBQ0YsQ0FDRixDQUFDO1FBRUYsMkJBQXNCLEdBSWxCLFlBQVksQ0FBQyxHQUFHLEVBQUUsQ0FDcEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQ2hCLE1BQU0sQ0FBQyxjQUFjLENBQUMseUJBQXlCLENBQUMsRUFDaEQsR0FBRyxDQUFDLENBQUMsTUFBNEMsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUNyRSxPQUFPLENBQUMsQ0FBQyxFQUFFLGFBQWEsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLENBQ3BDLFVBQVUsQ0FBQyxlQUFlLENBQUMsYUFBYSxFQUFFLE1BQU0sQ0FBQyxDQUNsRCxFQUNELFFBQVEsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQ2pCLEtBQUssQ0FBQyxJQUFJLENBQ1IsU0FBUyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FDcEIsSUFBSSxDQUFDLGdCQUFnQjthQUNsQixhQUFhLENBQ1osT0FBTyxDQUFDLE1BQU0sRUFDZCxPQUFPLENBQUMsYUFBYSxFQUNyQixPQUFPLENBQUMsTUFBTSxDQUNmO2FBQ0EsSUFBSSxDQUNILFNBQVMsQ0FBQyxDQUFDLFVBQW9DLEVBQUUsRUFBRTtZQUNqRCxNQUFNLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLFVBQVUsQ0FBQyxpQkFBaUIsQ0FDbkQsVUFBVSxFQUNWLEtBQUssQ0FDTixDQUFDO1lBQ0YsT0FBTztnQkFDTCxJQUFJLGdCQUFnQixDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQztnQkFDakQsSUFBSSxjQUFjLENBQUMsNEJBQTRCLENBQUM7b0JBQzlDLGFBQWEsRUFBRSxPQUFPLENBQUMsYUFBYTtvQkFDcEMsSUFBSTtvQkFDSixNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU07aUJBQ3ZCLENBQUM7YUFDSCxDQUFDO1FBQ0osQ0FBQyxDQUFDLEVBQ0YsVUFBVSxDQUFDLENBQUMsS0FBd0IsRUFBRSxFQUFFLENBQ3RDLEVBQUUsQ0FDQSxJQUFJLGNBQWMsQ0FBQyx5QkFBeUIsQ0FBQztZQUMzQyxhQUFhLEVBQUUsT0FBTyxDQUFDLGFBQWE7WUFDcEMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxNQUFNO1lBQ3RCLEtBQUssRUFBRSxrQkFBa0IsQ0FBQyxLQUFLLENBQUM7U0FDakMsQ0FBQyxDQUNILENBQ0YsQ0FDRixDQUNKLENBQ0YsQ0FDRixDQUNGLENBQ0YsQ0FBQztRQUVGLDZCQUF3QixHQUlwQixZQUFZLENBQUMsR0FBRyxFQUFFLENBQ3BCLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUNoQixNQUFNLENBQUMsY0FBYyxDQUFDLHdCQUF3QixDQUFDLEVBQy9DLEdBQUcsQ0FBQyxDQUFDLE1BQTRDLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFDckUsUUFBUSxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FDbkIsSUFBSSxDQUFDLGdCQUFnQjthQUNsQixjQUFjLENBQ2IsT0FBTyxDQUFDLE1BQU0sRUFDZCxPQUFPLENBQUMsYUFBYSxFQUNyQixPQUFPLENBQUMsVUFBVSxDQUNuQjthQUNBLElBQUksQ0FDSCxTQUFTLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDO1lBQ2xCLElBQUksY0FBYyxDQUFDLDRCQUE0QixDQUFDO2dCQUM5QyxxREFBcUQ7Z0JBQ3JELFVBQVUsRUFBRSxPQUFPLENBQUMsVUFBVTtnQkFDOUIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO2FBQ3hCLENBQUM7WUFDRixpRUFBaUU7WUFDakUsbURBQW1EO1NBQ3BELENBQUMsRUFDRixVQUFVLENBQUMsQ0FBQyxLQUF3QixFQUFFLEVBQUUsQ0FDdEMsSUFBSSxDQUFDO1lBQ0gsSUFBSSxjQUFjLENBQUMseUJBQXlCLENBQUM7Z0JBQzNDLGFBQWEsRUFBRSxPQUFPLENBQUMsYUFBYTtnQkFDcEMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVO2dCQUM5QixLQUFLLEVBQUUsa0JBQWtCLENBQUMsS0FBSyxDQUFDO2FBQ2pDLENBQUM7WUFDRixJQUFJLG1CQUFtQixDQUFDLHFCQUFxQixFQUFFO1NBQ2hELENBQUMsQ0FDSCxDQUNGLENBQ0osQ0FDRixDQUNGLENBQUM7UUFFRixpQ0FBNEIsR0FJeEIsWUFBWSxDQUFDLEdBQUcsRUFBRSxDQUNwQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDaEIsTUFBTSxDQUFDLGNBQWMsQ0FBQywwQkFBMEIsQ0FBQyxFQUNqRCxHQUFHLENBQUMsQ0FBQyxNQUE4QyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQ3ZFLFFBQVEsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQ25CLElBQUksQ0FBQyxnQkFBZ0I7YUFDbEIsZ0JBQWdCLENBQ2YsT0FBTyxDQUFDLE1BQU0sRUFDZCxPQUFPLENBQUMsYUFBYSxFQUNyQixPQUFPLENBQUMsVUFBVSxDQUNuQjthQUNBLElBQUksQ0FDSCxTQUFTLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDO1lBQ2xCLElBQUksY0FBYyxDQUFDLDhCQUE4QixDQUFDO2dCQUNoRCxxREFBcUQ7Z0JBQ3JELFVBQVUsRUFBRSxPQUFPLENBQUMsVUFBVTtnQkFDOUIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO2FBQ3hCLENBQUM7WUFDRixpRUFBaUU7WUFDakUsbURBQW1EO1NBQ3BELENBQUMsRUFDRixVQUFVLENBQUMsQ0FBQyxLQUF3QixFQUFFLEVBQUUsQ0FDdEMsSUFBSSxDQUFDO1lBQ0gsSUFBSSxjQUFjLENBQUMsMkJBQTJCLENBQUM7Z0JBQzdDLGFBQWEsRUFBRSxPQUFPLENBQUMsYUFBYTtnQkFDcEMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVO2dCQUM5QixLQUFLLEVBQUUsa0JBQWtCLENBQUMsS0FBSyxDQUFDO2FBQ2pDLENBQUM7WUFDRixJQUFJLG1CQUFtQixDQUFDLHFCQUFxQixFQUFFO1NBQ2hELENBQUMsQ0FDSCxDQUNGLENBQ0osQ0FDRixDQUNGLENBQUM7UUFFRiwrQkFBMEIsR0FJdEIsWUFBWSxDQUFDLEdBQUcsRUFBRSxDQUNwQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDaEIsTUFBTSxDQUFDLGNBQWMsQ0FBQywwQkFBMEIsQ0FBQyxFQUNqRCxHQUFHLENBQUMsQ0FBQyxNQUE4QyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQ3ZFLFFBQVEsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQ25CLElBQUksQ0FBQyxnQkFBZ0I7YUFDbEIsZ0JBQWdCLENBQ2YsT0FBTyxDQUFDLE1BQU0sRUFDZCxPQUFPLENBQUMsYUFBYSxFQUNyQixPQUFPLENBQUMsWUFBWSxDQUNyQjthQUNBLElBQUksQ0FDSCxTQUFTLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDO1lBQ2xCLElBQUksY0FBYyxDQUFDLDhCQUE4QixDQUFDO2dCQUNoRCxZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUU7Z0JBQ3JCLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUTthQUN4QixDQUFDO1lBQ0YsSUFBSSxtQkFBbUIsQ0FBQyxxQkFBcUIsRUFBRTtTQUNoRCxDQUFDLEVBQ0YsVUFBVSxDQUFDLENBQUMsS0FBd0IsRUFBRSxFQUFFLENBQ3RDLElBQUksQ0FBQztZQUNILElBQUksY0FBYyxDQUFDLDJCQUEyQixDQUFDO2dCQUM3QyxhQUFhLEVBQUUsT0FBTyxDQUFDLGFBQWE7Z0JBQ3BDLFlBQVksRUFBRSxPQUFPLENBQUMsWUFBWTtnQkFDbEMsS0FBSyxFQUFFLGtCQUFrQixDQUFDLEtBQUssQ0FBQzthQUNqQyxDQUFDO1lBQ0YsSUFBSSxtQkFBbUIsQ0FBQyxxQkFBcUIsRUFBRTtTQUNoRCxDQUFDLENBQ0gsQ0FDRixDQUNKLENBQ0YsQ0FDRixDQUFDO1FBRUYsbUNBQThCLEdBSTFCLFlBQVksQ0FBQyxHQUFHLEVBQUUsQ0FDcEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQ2hCLE1BQU0sQ0FBQyxjQUFjLENBQUMsNEJBQTRCLENBQUMsRUFDbkQsR0FBRyxDQUFDLENBQUMsTUFBZ0QsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUN6RSxRQUFRLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUNuQixJQUFJLENBQUMsZ0JBQWdCO2FBQ2xCLGtCQUFrQixDQUNqQixPQUFPLENBQUMsTUFBTSxFQUNkLE9BQU8sQ0FBQyxhQUFhLEVBQ3JCLE9BQU8sQ0FBQyxZQUFZLENBQ3JCO2FBQ0EsSUFBSSxDQUNILFNBQVMsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUM7WUFDbEIsSUFBSSxjQUFjLENBQUMsZ0NBQWdDLENBQUM7Z0JBQ2xELFlBQVksRUFBRSxJQUFJLENBQUMsRUFBRTtnQkFDckIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO2FBQ3hCLENBQUM7WUFDRixJQUFJLG1CQUFtQixDQUFDLHFCQUFxQixFQUFFO1NBQ2hELENBQUMsRUFDRixVQUFVLENBQUMsQ0FBQyxLQUF3QixFQUFFLEVBQUUsQ0FDdEMsSUFBSSxDQUFDO1lBQ0gsSUFBSSxjQUFjLENBQUMsNkJBQTZCLENBQUM7Z0JBQy9DLGFBQWEsRUFBRSxPQUFPLENBQUMsYUFBYTtnQkFDcEMsWUFBWSxFQUFFLE9BQU8sQ0FBQyxZQUFZO2dCQUNsQyxLQUFLLEVBQUUsa0JBQWtCLENBQUMsS0FBSyxDQUFDO2FBQ2pDLENBQUM7WUFDRixJQUFJLG1CQUFtQixDQUFDLHFCQUFxQixFQUFFO1NBQ2hELENBQUMsQ0FDSCxDQUNGLENBQ0osQ0FDRixDQUNGLENBQUM7UUFFRiw4QkFBeUIsR0FJckIsWUFBWSxDQUFDLEdBQUcsRUFBRSxDQUNwQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDaEIsTUFBTSxDQUFDLGNBQWMsQ0FBQywwQkFBMEIsQ0FBQyxFQUNqRCxHQUFHLENBQUMsQ0FBQyxNQUE2QyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQ3RFLFFBQVEsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQ25CLElBQUksQ0FBQyxnQkFBZ0I7YUFDbEIsZUFBZSxDQUNkLE9BQU8sQ0FBQyxNQUFNLEVBQ2QsT0FBTyxDQUFDLGFBQWEsRUFDckIsT0FBTyxDQUFDLFdBQVcsQ0FDcEI7YUFDQSxJQUFJLENBQ0gsU0FBUyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQztZQUNsQixJQUFJLGNBQWMsQ0FBQyw2QkFBNkIsQ0FBQztnQkFDL0MsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFO2dCQUNaLFFBQVEsRUFBRSxJQUFJLENBQUMsUUFBUTthQUN4QixDQUFDO1lBQ0YsSUFBSSxtQkFBbUIsQ0FBQyxxQkFBcUIsRUFBRTtTQUNoRCxDQUFDLEVBQ0YsVUFBVSxDQUFDLENBQUMsS0FBd0IsRUFBRSxFQUFFLENBQ3RDLElBQUksQ0FBQztZQUNILElBQUksY0FBYyxDQUFDLDBCQUEwQixDQUFDO2dCQUM1QyxhQUFhLEVBQUUsT0FBTyxDQUFDLGFBQWE7Z0JBQ3BDLFdBQVcsRUFBRSxPQUFPLENBQUMsV0FBVztnQkFDaEMsS0FBSyxFQUFFLGtCQUFrQixDQUFDLEtBQUssQ0FBQzthQUNqQyxDQUFDO1lBQ0YsSUFBSSxtQkFBbUIsQ0FBQyxxQkFBcUIsRUFBRTtTQUNoRCxDQUFDLENBQ0gsQ0FDRixDQUNKLENBQ0YsQ0FDRixDQUFDO1FBRUYsa0NBQTZCLEdBSXpCLFlBQVksQ0FBQyxHQUFHLEVBQUUsQ0FDcEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQ2hCLE1BQU0sQ0FBQyxjQUFjLENBQUMsNEJBQTRCLENBQUMsRUFDbkQsR0FBRyxDQUFDLENBQUMsTUFBK0MsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUN4RSxRQUFRLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUNuQixJQUFJLENBQUMsZ0JBQWdCO2FBQ2xCLGlCQUFpQixDQUNoQixPQUFPLENBQUMsTUFBTSxFQUNkLE9BQU8sQ0FBQyxhQUFhLEVBQ3JCLE9BQU8sQ0FBQyxXQUFXLENBQ3BCO2FBQ0EsSUFBSSxDQUNILFNBQVM7UUFDUCxvREFBb0Q7UUFDcEQsWUFBWTtRQUNaLHVEQUF1RDtRQUN2RCxvQkFBb0I7UUFDcEIsK0JBQStCO1FBQy9CLE9BQU87UUFDUCxHQUFHLEVBQUUsQ0FBQztZQUNKLElBQUksY0FBYyxDQUFDLCtCQUErQixDQUFDO2dCQUNqRCxHQUFHLEVBQUUsT0FBTyxDQUFDLFdBQVc7Z0JBQ3hCLFFBQVEsRUFBRSxLQUFLO2FBQ2hCLENBQUM7WUFDRixJQUFJLG1CQUFtQixDQUFDLHFCQUFxQixFQUFFO1NBQ2hELENBQ0YsRUFDRCxVQUFVLENBQUMsQ0FBQyxLQUF3QixFQUFFLEVBQUUsQ0FDdEMsSUFBSSxDQUFDO1lBQ0gsSUFBSSxjQUFjLENBQUMsNEJBQTRCLENBQUM7Z0JBQzlDLGFBQWEsRUFBRSxPQUFPLENBQUMsYUFBYTtnQkFDcEMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxXQUFXO2dCQUNoQyxLQUFLLEVBQUUsa0JBQWtCLENBQUMsS0FBSyxDQUFDO2FBQ2pDLENBQUM7WUFDRixJQUFJLG1CQUFtQixDQUFDLHFCQUFxQixFQUFFO1NBQ2hELENBQUMsQ0FDSCxDQUNGLENBQ0osQ0FDRixDQUNGLENBQUM7SUFRQyxDQUFDO0lBRU0saUJBQWlCLENBQUMsS0FBa0IsRUFBRSxJQUFhO1FBQzNELElBQUssS0FBYSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsRUFBRSxLQUFLLHFCQUFxQixFQUFFO1lBQ2hFLElBQUksQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDO2dCQUNyQixPQUFPLEVBQUUsZ0JBQWdCO2dCQUN6QixNQUFNLEVBQUUsSUFBSTthQUNiLENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQzs7MkdBdGxCVSxjQUFjOytHQUFkLGNBQWM7MkZBQWQsY0FBYztrQkFEMUIsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIyIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7IEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWN0aW9ucywgY3JlYXRlRWZmZWN0LCBvZlR5cGUgfSBmcm9tICdAbmdyeC9lZmZlY3RzJztcbmltcG9ydCB7XG4gIEF1dGhBY3Rpb25zLFxuICBCMkJVc2VyLFxuICBCMkJVc2VyUm9sZSxcbiAgRW50aXRpZXNNb2RlbCxcbiAgbm9ybWFsaXplSHR0cEVycm9yLFxuICBSb3V0ZXJTdGF0ZSxcbiAgUm91dGluZ1NlcnZpY2UsXG4gIFN0YXRlVXRpbHMsXG4gIFVzZXIsXG4gIFVzZXJJZFNlcnZpY2UsXG59IGZyb20gJ0BzcGFydGFjdXMvY29yZSc7XG5pbXBvcnQgeyBVc2VyQWNjb3VudEZhY2FkZSB9IGZyb20gJ0BzcGFydGFjdXMvdXNlci9hY2NvdW50L3Jvb3QnO1xuaW1wb3J0IHsgZnJvbSwgT2JzZXJ2YWJsZSwgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7XG4gIGNhdGNoRXJyb3IsXG4gIGdyb3VwQnksXG4gIG1hcCxcbiAgbWVyZ2VNYXAsXG4gIHN3aXRjaE1hcCxcbiAgdGFrZSxcbiAgdGFwLFxuICB3aXRoTGF0ZXN0RnJvbSxcbn0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQjJCVXNlckNvbm5lY3RvciB9IGZyb20gJy4uLy4uL2Nvbm5lY3RvcnMvYjJiLXVzZXIvYjJiLXVzZXIuY29ubmVjdG9yJztcbmltcG9ydCB7IFBlcm1pc3Npb24gfSBmcm9tICcuLi8uLi9tb2RlbC9wZXJtaXNzaW9uLm1vZGVsJztcbmltcG9ydCB7IFVzZXJHcm91cCB9IGZyb20gJy4uLy4uL21vZGVsL3VzZXItZ3JvdXAubW9kZWwnO1xuaW1wb3J0IHtcbiAgQjJCVXNlckFjdGlvbnMsXG4gIE9yZ2FuaXphdGlvbkFjdGlvbnMsXG4gIE9yZ1VuaXRBY3Rpb25zLFxuICBQZXJtaXNzaW9uQWN0aW9ucyxcbiAgVXNlckdyb3VwQWN0aW9ucyxcbn0gZnJvbSAnLi4vYWN0aW9ucy9pbmRleCc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBCMkJVc2VyRWZmZWN0cyB7XG4gIGxvYWRCMkJVc2VyJDogT2JzZXJ2YWJsZTxcbiAgICBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlclN1Y2Nlc3MgfCBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlckZhaWxcbiAgPiA9IGNyZWF0ZUVmZmVjdCgoKSA9PlxuICAgIHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICAgIG9mVHlwZShCMkJVc2VyQWN0aW9ucy5MT0FEX0IyQl9VU0VSKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlcikgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgICAgc3dpdGNoTWFwKCh7IHVzZXJJZCwgb3JnQ3VzdG9tZXJJZCB9KSA9PiB7XG4gICAgICAgIHJldHVybiB0aGlzLmIyYlVzZXJDb25uZWN0b3IuZ2V0KHVzZXJJZCwgb3JnQ3VzdG9tZXJJZCkucGlwZShcbiAgICAgICAgICBtYXAoKGIyYlVzZXI6IEIyQlVzZXIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJTdWNjZXNzKFtiMmJVc2VyXSk7XG4gICAgICAgICAgfSksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgb2YoXG4gICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlckZhaWwoe1xuICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgfSlcbiAgICApXG4gICk7XG5cbiAgY3JlYXRlQjJCVXNlciQ6IE9ic2VydmFibGU8XG4gICAgfCBCMkJVc2VyQWN0aW9ucy5DcmVhdGVCMkJVc2VyU3VjY2Vzc1xuICAgIHwgQjJCVXNlckFjdGlvbnMuQ3JlYXRlQjJCVXNlckZhaWxcbiAgICB8IE9yZ1VuaXRBY3Rpb25zLkFzc2lnbkFwcHJvdmVyXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKEIyQlVzZXJBY3Rpb25zLkNSRUFURV9CMkJfVVNFUiksXG4gICAgICBtYXAoKGFjdGlvbjogQjJCVXNlckFjdGlvbnMuQ3JlYXRlQjJCVXNlcikgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgICAgc3dpdGNoTWFwKCh7IHVzZXJJZCwgb3JnQ3VzdG9tZXIgfSkgPT5cbiAgICAgICAgdGhpcy5iMmJVc2VyQ29ubmVjdG9yLmNyZWF0ZSh1c2VySWQsIG9yZ0N1c3RvbWVyKS5waXBlKFxuICAgICAgICAgIHN3aXRjaE1hcCgoZGF0YSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgaXNBc3NpZ25lZFRvQXBwcm92ZXJzID0gb3JnQ3VzdG9tZXIuaXNBc3NpZ25lZFRvQXBwcm92ZXJzO1xuICAgICAgICAgICAgLy8gVE9ETyBXb3JrYXJvdW5kIGZvciBub3Qga25vd24gY3VzdG9tZXJJZCB3aGlsZSB1c2VyIGNyZWF0aW9uIChyZWRpcmVjaXRvbilcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJvdXRpbmdTZXJ2aWNlLmdldFJvdXRlclN0YXRlKCkucGlwZShcbiAgICAgICAgICAgICAgdGFrZSgxKSxcbiAgICAgICAgICAgICAgdGFwKChyb3V0ZSkgPT4gdGhpcy5yZWRpcmVjdFRvRGV0YWlscyhyb3V0ZSwgZGF0YSkpLFxuICAgICAgICAgICAgICBzd2l0Y2hNYXAoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN1Y2Nlc3NBY3Rpb25zID0gW1xuICAgICAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLkNyZWF0ZUIyQlVzZXJTdWNjZXNzKGRhdGEpLFxuICAgICAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLkNyZWF0ZUIyQlVzZXJTdWNjZXNzKHtcbiAgICAgICAgICAgICAgICAgICAgY3VzdG9tZXJJZDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgICAgICBdIGFzIGFueVtdO1xuICAgICAgICAgICAgICAgIGlmIChpc0Fzc2lnbmVkVG9BcHByb3ZlcnMpIHtcbiAgICAgICAgICAgICAgICAgIHN1Y2Nlc3NBY3Rpb25zLnNwbGljZShcbiAgICAgICAgICAgICAgICAgICAgMSxcbiAgICAgICAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICAgICAgICAgbmV3IE9yZ1VuaXRBY3Rpb25zLkFzc2lnbkFwcHJvdmVyKHtcbiAgICAgICAgICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgICAgICAgICAgb3JnVW5pdElkOiBvcmdDdXN0b21lci5vcmdVbml0Py51aWQgPz8gJycsXG4gICAgICAgICAgICAgICAgICAgICAgb3JnQ3VzdG9tZXJJZDogZGF0YS5jdXN0b21lcklkID8/ICcnLFxuICAgICAgICAgICAgICAgICAgICAgIHJvbGVJZDogQjJCVXNlclJvbGUuQVBQUk9WRVIsXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2Vzc0FjdGlvbnM7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuQ3JlYXRlQjJCVXNlckZhaWwoe1xuICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IG9yZ0N1c3RvbWVyLmN1c3RvbWVySWQgPz8gJycsXG4gICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIHVwZGF0ZUIyQlVzZXIkOiBPYnNlcnZhYmxlPFxuICAgIHwgQjJCVXNlckFjdGlvbnMuVXBkYXRlQjJCVXNlclN1Y2Nlc3NcbiAgICB8IEIyQlVzZXJBY3Rpb25zLlVwZGF0ZUIyQlVzZXJGYWlsXG4gICAgfCBPcmdVbml0QWN0aW9ucy5Bc3NpZ25BcHByb3ZlclxuICAgIHwgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGFcbiAgPiA9IGNyZWF0ZUVmZmVjdCgoKSA9PlxuICAgIHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICAgIG9mVHlwZShCMkJVc2VyQWN0aW9ucy5VUERBVEVfQjJCX1VTRVIpLFxuICAgICAgbWFwKChhY3Rpb246IEIyQlVzZXJBY3Rpb25zLlVwZGF0ZUIyQlVzZXIpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICAgIHN3aXRjaE1hcCgoeyB1c2VySWQsIG9yZ0N1c3RvbWVySWQsIG9yZ0N1c3RvbWVyIH0pID0+IHtcbiAgICAgICAgY29uc3QgaXNBc3NpZ25lZFRvQXBwcm92ZXJzID0gb3JnQ3VzdG9tZXIuaXNBc3NpZ25lZFRvQXBwcm92ZXJzO1xuICAgICAgICByZXR1cm4gdGhpcy5iMmJVc2VyQ29ubmVjdG9yXG4gICAgICAgICAgLnVwZGF0ZSh1c2VySWQsIG9yZ0N1c3RvbWVySWQsIG9yZ0N1c3RvbWVyKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgc3dpdGNoTWFwKChfZGF0YSkgPT4ge1xuICAgICAgICAgICAgICBjb25zdCBzdWNjZXNzQWN0aW9ucyA9IFtcbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBjaGFuZ2UgZm9yICdwYXlsb2FkOiBkYXRhJyB3aGVuIGJhY2tlbmQgQVBJIHN0YXJ0IHRvIHJldHVybiB1c2VyIGRhdGEgb24gUEFUQ0hcbiAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuVXBkYXRlQjJCVXNlclN1Y2Nlc3Mob3JnQ3VzdG9tZXIpLFxuICAgICAgICAgICAgICBdIGFzIGFueVtdO1xuICAgICAgICAgICAgICBpZiAoaXNBc3NpZ25lZFRvQXBwcm92ZXJzKSB7XG4gICAgICAgICAgICAgICAgc3VjY2Vzc0FjdGlvbnMucHVzaChcbiAgICAgICAgICAgICAgICAgIG5ldyBPcmdVbml0QWN0aW9ucy5Bc3NpZ25BcHByb3Zlcih7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgb3JnVW5pdElkOiBvcmdDdXN0b21lci5vcmdVbml0Py51aWQgPz8gJycsXG4gICAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgICAgIHJvbGVJZDogQjJCVXNlclJvbGUuQVBQUk9WRVIsXG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3NBY3Rpb25zO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5VcGRhdGVCMkJVc2VyRmFpbCh7XG4gICAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBvcmdDdXN0b21lci5jdXN0b21lcklkID8/ICcnLFxuICAgICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgIH0pXG4gICAgKVxuICApO1xuXG4gIGNoZWNrU2VsZkVtYWlsVXBkYXRlJDogT2JzZXJ2YWJsZTxcbiAgICB8IEF1dGhBY3Rpb25zLkxvZ291dFxuICAgIHwgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoQjJCVXNlckFjdGlvbnMuVVBEQVRFX0IyQl9VU0VSX1NVQ0NFU1MpLFxuICAgICAgbWFwKChhY3Rpb246IEIyQlVzZXJBY3Rpb25zLlVwZGF0ZUIyQlVzZXJTdWNjZXNzKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICB3aXRoTGF0ZXN0RnJvbShcbiAgICAgICAgdGhpcy51c2VyQWNjb3VudEZhY2FkZS5nZXQoKSxcbiAgICAgICAgdGhpcy51c2VySWRTZXJ2aWNlLmdldFVzZXJJZCgpXG4gICAgICApLFxuICAgICAgc3dpdGNoTWFwKFxuICAgICAgICAoW3BheWxvYWQsIGN1cnJlbnRVc2VyXTogW0IyQlVzZXIsIFVzZXIgfCB1bmRlZmluZWQsIHN0cmluZ10pID0+IHtcbiAgICAgICAgICBjb25zdCBjdXJyZW50VXNlckVtYWlsTWF0Y2ggPVxuICAgICAgICAgICAgcGF5bG9hZC5jdXN0b21lcklkID09PSBjdXJyZW50VXNlcj8uY3VzdG9tZXJJZCAmJlxuICAgICAgICAgICAgcGF5bG9hZC5lbWFpbCAhPT0gY3VycmVudFVzZXI/LmRpc3BsYXlVaWQ7XG5cbiAgICAgICAgICBpZiAoY3VycmVudFVzZXJFbWFpbE1hdGNoKSB7XG4gICAgICAgICAgICB0aGlzLnJvdXRpbmdTZXJ2aWNlLmdvKHsgY3hSb3V0ZTogJ2xvZ2luJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGN1cnJlbnRVc2VyRW1haWxNYXRjaFxuICAgICAgICAgICAgPyBbbmV3IEF1dGhBY3Rpb25zLkxvZ291dCgpXVxuICAgICAgICAgICAgOiBbbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCldO1xuICAgICAgICB9XG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIGxvYWRCMkJVc2VycyQ6IE9ic2VydmFibGU8XG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlcnNTdWNjZXNzXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlclN1Y2Nlc3NcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2Vyc0ZhaWxcbiAgPiA9IGNyZWF0ZUVmZmVjdCgoKSA9PlxuICAgIHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICAgIG9mVHlwZShCMkJVc2VyQWN0aW9ucy5MT0FEX0IyQl9VU0VSUyksXG4gICAgICBtYXAoKGFjdGlvbjogQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJzKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBzd2l0Y2hNYXAoKHBheWxvYWQpID0+XG4gICAgICAgIHRoaXMuYjJiVXNlckNvbm5lY3Rvci5nZXRMaXN0KHBheWxvYWQudXNlcklkLCBwYXlsb2FkLnBhcmFtcykucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKGIyYlVzZXJzOiBFbnRpdGllc01vZGVsPEIyQlVzZXI+KSA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IHZhbHVlcywgcGFnZSB9ID0gU3RhdGVVdGlscy5ub3JtYWxpemVMaXN0UGFnZShcbiAgICAgICAgICAgICAgYjJiVXNlcnMsXG4gICAgICAgICAgICAgICdjdXN0b21lcklkJ1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiBbXG4gICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlclN1Y2Nlc3ModmFsdWVzKSxcbiAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2Vyc1N1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgIHBhZ2UsXG4gICAgICAgICAgICAgICAgcGFyYW1zOiBwYXlsb2FkLnBhcmFtcyxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBdO1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgIG9mKFxuICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJzRmFpbCh7XG4gICAgICAgICAgICAgICAgcGFyYW1zOiBwYXlsb2FkLnBhcmFtcyxcbiAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgbG9hZEIyQlVzZXJBcHByb3ZlcnMkOiBPYnNlcnZhYmxlPFxuICAgIHwgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJBcHByb3ZlcnNTdWNjZXNzXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlckFwcHJvdmVyc0ZhaWxcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyU3VjY2Vzc1xuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKEIyQlVzZXJBY3Rpb25zLkxPQURfQjJCX1VTRVJfQVBQUk9WRVJTKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlckFwcHJvdmVycykgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgICAgZ3JvdXBCeSgoeyBvcmdDdXN0b21lcklkLCBwYXJhbXMgfSkgPT5cbiAgICAgICAgU3RhdGVVdGlscy5zZXJpYWxpemVQYXJhbXMob3JnQ3VzdG9tZXJJZCwgcGFyYW1zKVxuICAgICAgKSxcbiAgICAgIG1lcmdlTWFwKChncm91cCkgPT5cbiAgICAgICAgZ3JvdXAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKHBheWxvYWQpID0+XG4gICAgICAgICAgICB0aGlzLmIyYlVzZXJDb25uZWN0b3JcbiAgICAgICAgICAgICAgLmdldEFwcHJvdmVycyhcbiAgICAgICAgICAgICAgICBwYXlsb2FkLnVzZXJJZCxcbiAgICAgICAgICAgICAgICBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgcGF5bG9hZC5wYXJhbXNcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBzd2l0Y2hNYXAoKGFwcHJvdmVyczogRW50aXRpZXNNb2RlbDxCMkJVc2VyPikgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc3QgeyB2YWx1ZXMsIHBhZ2UgfSA9IFN0YXRlVXRpbHMubm9ybWFsaXplTGlzdFBhZ2UoXG4gICAgICAgICAgICAgICAgICAgIGFwcHJvdmVycyxcbiAgICAgICAgICAgICAgICAgICAgJ2N1c3RvbWVySWQnXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyU3VjY2Vzcyh2YWx1ZXMpLFxuICAgICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJBcHByb3ZlcnNTdWNjZXNzKHtcbiAgICAgICAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgICAgICAgcGFnZSxcbiAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBheWxvYWQucGFyYW1zLFxuICAgICAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgICAgICAgb2YoXG4gICAgICAgICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlckFwcHJvdmVyc0ZhaWwoe1xuICAgICAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBheWxvYWQucGFyYW1zLFxuICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICBsb2FkQjJCVXNlclBlcm1pc3Npb25zJDogT2JzZXJ2YWJsZTxcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyUGVybWlzc2lvbnNTdWNjZXNzXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlclBlcm1pc3Npb25zRmFpbFxuICAgIHwgUGVybWlzc2lvbkFjdGlvbnMuTG9hZFBlcm1pc3Npb25TdWNjZXNzXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoQjJCVXNlckFjdGlvbnMuTE9BRF9CMkJfVVNFUl9QRVJNSVNTSU9OUyksXG4gICAgICBtYXAoKGFjdGlvbjogQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJQZXJtaXNzaW9ucykgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgICAgZ3JvdXBCeSgoeyBvcmdDdXN0b21lcklkLCBwYXJhbXMgfSkgPT5cbiAgICAgICAgU3RhdGVVdGlscy5zZXJpYWxpemVQYXJhbXMob3JnQ3VzdG9tZXJJZCwgcGFyYW1zKVxuICAgICAgKSxcbiAgICAgIG1lcmdlTWFwKChncm91cCkgPT5cbiAgICAgICAgZ3JvdXAucGlwZShcbiAgICAgICAgICBzd2l0Y2hNYXAoKHBheWxvYWQpID0+XG4gICAgICAgICAgICB0aGlzLmIyYlVzZXJDb25uZWN0b3JcbiAgICAgICAgICAgICAgLmdldFBlcm1pc3Npb25zKFxuICAgICAgICAgICAgICAgIHBheWxvYWQudXNlcklkLFxuICAgICAgICAgICAgICAgIHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICBwYXlsb2FkLnBhcmFtc1xuICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIHN3aXRjaE1hcCgocGVybWlzc2lvbnM6IEVudGl0aWVzTW9kZWw8UGVybWlzc2lvbj4pID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHsgdmFsdWVzLCBwYWdlIH0gPSBTdGF0ZVV0aWxzLm5vcm1hbGl6ZUxpc3RQYWdlKFxuICAgICAgICAgICAgICAgICAgICBwZXJtaXNzaW9ucyxcbiAgICAgICAgICAgICAgICAgICAgJ2NvZGUnXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICAgICAgbmV3IFBlcm1pc3Npb25BY3Rpb25zLkxvYWRQZXJtaXNzaW9uU3VjY2Vzcyh2YWx1ZXMpLFxuICAgICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJQZXJtaXNzaW9uc1N1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgICAgICAgIG9yZ0N1c3RvbWVySWQ6IHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICAgICAgICBwYWdlLFxuICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyUGVybWlzc2lvbnNGYWlsKHtcbiAgICAgICAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXlsb2FkLnBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgbG9hZEIyQlVzZXJVc2VyR3JvdXBzJDogT2JzZXJ2YWJsZTxcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyVXNlckdyb3Vwc1N1Y2Nlc3NcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkxvYWRCMkJVc2VyVXNlckdyb3Vwc0ZhaWxcbiAgICB8IFVzZXJHcm91cEFjdGlvbnMuTG9hZFVzZXJHcm91cFN1Y2Nlc3NcbiAgPiA9IGNyZWF0ZUVmZmVjdCgoKSA9PlxuICAgIHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICAgIG9mVHlwZShCMkJVc2VyQWN0aW9ucy5MT0FEX0IyQl9VU0VSX1VTRVJfR1JPVVBTKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5Mb2FkQjJCVXNlclVzZXJHcm91cHMpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICAgIGdyb3VwQnkoKHsgb3JnQ3VzdG9tZXJJZCwgcGFyYW1zIH0pID0+XG4gICAgICAgIFN0YXRlVXRpbHMuc2VyaWFsaXplUGFyYW1zKG9yZ0N1c3RvbWVySWQsIHBhcmFtcylcbiAgICAgICksXG4gICAgICBtZXJnZU1hcCgoZ3JvdXApID0+XG4gICAgICAgIGdyb3VwLnBpcGUoXG4gICAgICAgICAgc3dpdGNoTWFwKChwYXlsb2FkKSA9PlxuICAgICAgICAgICAgdGhpcy5iMmJVc2VyQ29ubmVjdG9yXG4gICAgICAgICAgICAgIC5nZXRVc2VyR3JvdXBzKFxuICAgICAgICAgICAgICAgIHBheWxvYWQudXNlcklkLFxuICAgICAgICAgICAgICAgIHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgICAgICBwYXlsb2FkLnBhcmFtc1xuICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIHN3aXRjaE1hcCgodXNlckdyb3VwczogRW50aXRpZXNNb2RlbDxVc2VyR3JvdXA+KSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCB7IHZhbHVlcywgcGFnZSB9ID0gU3RhdGVVdGlscy5ub3JtYWxpemVMaXN0UGFnZShcbiAgICAgICAgICAgICAgICAgICAgdXNlckdyb3VwcyxcbiAgICAgICAgICAgICAgICAgICAgJ3VpZCdcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgICAgICBuZXcgVXNlckdyb3VwQWN0aW9ucy5Mb2FkVXNlckdyb3VwU3VjY2Vzcyh2YWx1ZXMpLFxuICAgICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJVc2VyR3JvdXBzU3VjY2Vzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgb3JnQ3VzdG9tZXJJZDogcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgICAgICAgICAgIHBhZ2UsXG4gICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXlsb2FkLnBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgICAgICAgIG9mKFxuICAgICAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuTG9hZEIyQlVzZXJVc2VyR3JvdXBzRmFpbCh7XG4gICAgICAgICAgICAgICAgICAgICAgb3JnQ3VzdG9tZXJJZDogcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogcGF5bG9hZC5wYXJhbXMsXG4gICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIGFzc2lnbkFwcHJvdmVyVG9CMkJVc2VyJDogT2JzZXJ2YWJsZTxcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkFzc2lnbkIyQlVzZXJBcHByb3ZlclN1Y2Nlc3NcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkFzc2lnbkIyQlVzZXJBcHByb3ZlckZhaWxcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoQjJCVXNlckFjdGlvbnMuQVNTSUdOX0IyQl9VU0VSX0FQUFJPVkVSKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyQXBwcm92ZXIpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICAgIG1lcmdlTWFwKChwYXlsb2FkKSA9PlxuICAgICAgICB0aGlzLmIyYlVzZXJDb25uZWN0b3JcbiAgICAgICAgICAuYXNzaWduQXBwcm92ZXIoXG4gICAgICAgICAgICBwYXlsb2FkLnVzZXJJZCxcbiAgICAgICAgICAgIHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgIHBheWxvYWQuYXBwcm92ZXJJZFxuICAgICAgICAgIClcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIHN3aXRjaE1hcCgoZGF0YSkgPT4gW1xuICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuQXNzaWduQjJCVXNlckFwcHJvdmVyU3VjY2Vzcyh7XG4gICAgICAgICAgICAgICAgLy8gT2NjIHJldHVybmVkIGVtYWlsLCBidXQgd2UgdXNlIGN1c3RvbWVySWQgaW4gc3RvcmVcbiAgICAgICAgICAgICAgICBhcHByb3ZlcklkOiBwYXlsb2FkLmFwcHJvdmVySWQsXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWQ6IGRhdGEuc2VsZWN0ZWQsXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAvLyBDbGVhcmluZyBkYXRhIGluIHRoaXMgY2FzZSBjYXVzZXMgdW5leHBlY3RlZCBiZWhhdmlvciAoIzEwNDY4KVxuICAgICAgICAgICAgICAvLyBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PlxuICAgICAgICAgICAgICBmcm9tKFtcbiAgICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuQXNzaWduQjJCVXNlckFwcHJvdmVyRmFpbCh7XG4gICAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgICBhcHByb3ZlcklkOiBwYXlsb2FkLmFwcHJvdmVySWQsXG4gICAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIHVuYXNzaWduQXBwcm92ZXJGcm9tQjJCVXNlciQ6IE9ic2VydmFibGU8XG4gICAgfCBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJBcHByb3ZlclN1Y2Nlc3NcbiAgICB8IEIyQlVzZXJBY3Rpb25zLlVuYXNzaWduQjJCVXNlckFwcHJvdmVyRmFpbFxuICAgIHwgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGFcbiAgPiA9IGNyZWF0ZUVmZmVjdCgoKSA9PlxuICAgIHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICAgIG9mVHlwZShCMkJVc2VyQWN0aW9ucy5VTkFTU0lHTl9CMkJfVVNFUl9BUFBST1ZFUiksXG4gICAgICBtYXAoKGFjdGlvbjogQjJCVXNlckFjdGlvbnMuVW5hc3NpZ25CMkJVc2VyQXBwcm92ZXIpID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICAgIG1lcmdlTWFwKChwYXlsb2FkKSA9PlxuICAgICAgICB0aGlzLmIyYlVzZXJDb25uZWN0b3JcbiAgICAgICAgICAudW5hc3NpZ25BcHByb3ZlcihcbiAgICAgICAgICAgIHBheWxvYWQudXNlcklkLFxuICAgICAgICAgICAgcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgcGF5bG9hZC5hcHByb3ZlcklkXG4gICAgICAgICAgKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgc3dpdGNoTWFwKChkYXRhKSA9PiBbXG4gICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJBcHByb3ZlclN1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgIC8vIE9jYyByZXR1cm5lZCBlbWFpbCwgYnV0IHdlIHVzZSBjdXN0b21lcklkIGluIHN0b3JlXG4gICAgICAgICAgICAgICAgYXBwcm92ZXJJZDogcGF5bG9hZC5hcHByb3ZlcklkLFxuICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBkYXRhLnNlbGVjdGVkLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgLy8gQ2xlYXJpbmcgZGF0YSBpbiB0aGlzIGNhc2UgY2F1c2VzIHVuZXhwZWN0ZWQgYmVoYXZpb3IgKCMxMDQ2OClcbiAgICAgICAgICAgICAgLy8gbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICBdKSxcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLlVuYXNzaWduQjJCVXNlckFwcHJvdmVyRmFpbCh7XG4gICAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgICBhcHByb3ZlcklkOiBwYXlsb2FkLmFwcHJvdmVySWQsXG4gICAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIGFzc2lnblBlcm1pc3Npb25Ub0IyQlVzZXIkOiBPYnNlcnZhYmxlPFxuICAgIHwgQjJCVXNlckFjdGlvbnMuQXNzaWduQjJCVXNlclBlcm1pc3Npb25TdWNjZXNzXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyUGVybWlzc2lvbkZhaWxcbiAgICB8IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoQjJCVXNlckFjdGlvbnMuQVNTSUdOX0IyQl9VU0VSX1BFUk1JU1NJT04pLFxuICAgICAgbWFwKChhY3Rpb246IEIyQlVzZXJBY3Rpb25zLkFzc2lnbkIyQlVzZXJQZXJtaXNzaW9uKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBtZXJnZU1hcCgocGF5bG9hZCkgPT5cbiAgICAgICAgdGhpcy5iMmJVc2VyQ29ubmVjdG9yXG4gICAgICAgICAgLmFzc2lnblBlcm1pc3Npb24oXG4gICAgICAgICAgICBwYXlsb2FkLnVzZXJJZCxcbiAgICAgICAgICAgIHBheWxvYWQub3JnQ3VzdG9tZXJJZCxcbiAgICAgICAgICAgIHBheWxvYWQucGVybWlzc2lvbklkXG4gICAgICAgICAgKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgc3dpdGNoTWFwKChkYXRhKSA9PiBbXG4gICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyUGVybWlzc2lvblN1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgIHBlcm1pc3Npb25JZDogZGF0YS5pZCxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZDogZGF0YS5zZWxlY3RlZCxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyUGVybWlzc2lvbkZhaWwoe1xuICAgICAgICAgICAgICAgICAgb3JnQ3VzdG9tZXJJZDogcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgICAgICAgcGVybWlzc2lvbklkOiBwYXlsb2FkLnBlcm1pc3Npb25JZCxcbiAgICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgdW5hc3NpZ25QZXJtaXNzaW9uRnJvbUIyQlVzZXIkOiBPYnNlcnZhYmxlPFxuICAgIHwgQjJCVXNlckFjdGlvbnMuVW5hc3NpZ25CMkJVc2VyUGVybWlzc2lvblN1Y2Nlc3NcbiAgICB8IEIyQlVzZXJBY3Rpb25zLlVuYXNzaWduQjJCVXNlclBlcm1pc3Npb25GYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKEIyQlVzZXJBY3Rpb25zLlVOQVNTSUdOX0IyQl9VU0VSX1BFUk1JU1NJT04pLFxuICAgICAgbWFwKChhY3Rpb246IEIyQlVzZXJBY3Rpb25zLlVuYXNzaWduQjJCVXNlclBlcm1pc3Npb24pID0+IGFjdGlvbi5wYXlsb2FkKSxcbiAgICAgIG1lcmdlTWFwKChwYXlsb2FkKSA9PlxuICAgICAgICB0aGlzLmIyYlVzZXJDb25uZWN0b3JcbiAgICAgICAgICAudW5hc3NpZ25QZXJtaXNzaW9uKFxuICAgICAgICAgICAgcGF5bG9hZC51c2VySWQsXG4gICAgICAgICAgICBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICBwYXlsb2FkLnBlcm1pc3Npb25JZFxuICAgICAgICAgIClcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIHN3aXRjaE1hcCgoZGF0YSkgPT4gW1xuICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuVW5hc3NpZ25CMkJVc2VyUGVybWlzc2lvblN1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgIHBlcm1pc3Npb25JZDogZGF0YS5pZCxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZDogZGF0YS5zZWxlY3RlZCxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJQZXJtaXNzaW9uRmFpbCh7XG4gICAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgICBwZXJtaXNzaW9uSWQ6IHBheWxvYWQucGVybWlzc2lvbklkLFxuICAgICAgICAgICAgICAgICAgZXJyb3I6IG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvciksXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgbmV3IE9yZ2FuaXphdGlvbkFjdGlvbnMuT3JnYW5pemF0aW9uQ2xlYXJEYXRhKCksXG4gICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICBhc3NpZ25Vc2VyR3JvdXBUb0IyQlVzZXIkOiBPYnNlcnZhYmxlPFxuICAgIHwgQjJCVXNlckFjdGlvbnMuQXNzaWduQjJCVXNlclVzZXJHcm91cFN1Y2Nlc3NcbiAgICB8IEIyQlVzZXJBY3Rpb25zLkFzc2lnbkIyQlVzZXJVc2VyR3JvdXBGYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKEIyQlVzZXJBY3Rpb25zLkFTU0lHTl9CMkJfVVNFUl9VU0VSX0dST1VQKSxcbiAgICAgIG1hcCgoYWN0aW9uOiBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyVXNlckdyb3VwKSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBtZXJnZU1hcCgocGF5bG9hZCkgPT5cbiAgICAgICAgdGhpcy5iMmJVc2VyQ29ubmVjdG9yXG4gICAgICAgICAgLmFzc2lnblVzZXJHcm91cChcbiAgICAgICAgICAgIHBheWxvYWQudXNlcklkLFxuICAgICAgICAgICAgcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgcGF5bG9hZC51c2VyR3JvdXBJZFxuICAgICAgICAgIClcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIHN3aXRjaE1hcCgoZGF0YSkgPT4gW1xuICAgICAgICAgICAgICBuZXcgQjJCVXNlckFjdGlvbnMuQXNzaWduQjJCVXNlclVzZXJHcm91cFN1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgIHVpZDogZGF0YS5pZCxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZDogZGF0YS5zZWxlY3RlZCxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgXSksXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+XG4gICAgICAgICAgICAgIGZyb20oW1xuICAgICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5Bc3NpZ25CMkJVc2VyVXNlckdyb3VwRmFpbCh7XG4gICAgICAgICAgICAgICAgICBvcmdDdXN0b21lcklkOiBwYXlsb2FkLm9yZ0N1c3RvbWVySWQsXG4gICAgICAgICAgICAgICAgICB1c2VyR3JvdXBJZDogcGF5bG9hZC51c2VyR3JvdXBJZCxcbiAgICAgICAgICAgICAgICAgIGVycm9yOiBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpLFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIG5ldyBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YSgpLFxuICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgdW5hc3NpZ25Vc2VyR3JvdXBGcm9tQjJCVXNlciQ6IE9ic2VydmFibGU8XG4gICAgfCBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJVc2VyR3JvdXBTdWNjZXNzXG4gICAgfCBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJVc2VyR3JvdXBGYWlsXG4gICAgfCBPcmdhbml6YXRpb25BY3Rpb25zLk9yZ2FuaXphdGlvbkNsZWFyRGF0YVxuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKEIyQlVzZXJBY3Rpb25zLlVOQVNTSUdOX0IyQl9VU0VSX1VTRVJfR1JPVVApLFxuICAgICAgbWFwKChhY3Rpb246IEIyQlVzZXJBY3Rpb25zLlVuYXNzaWduQjJCVXNlclVzZXJHcm91cCkgPT4gYWN0aW9uLnBheWxvYWQpLFxuICAgICAgbWVyZ2VNYXAoKHBheWxvYWQpID0+XG4gICAgICAgIHRoaXMuYjJiVXNlckNvbm5lY3RvclxuICAgICAgICAgIC51bmFzc2lnblVzZXJHcm91cChcbiAgICAgICAgICAgIHBheWxvYWQudXNlcklkLFxuICAgICAgICAgICAgcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgcGF5bG9hZC51c2VyR3JvdXBJZFxuICAgICAgICAgIClcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIHN3aXRjaE1hcChcbiAgICAgICAgICAgICAgLy8gVE9ETzogV29ya2Fyb3VuZCBiZWNhdXNlIG9jYyBkb2Vzbid0IHJlc3BvbmQgaGVyZVxuICAgICAgICAgICAgICAvLyAoZGF0YSkgPT5cbiAgICAgICAgICAgICAgLy8gICBuZXcgQjJCVXNlckFjdGlvbnMuRGVsZXRlQjJCVXNlclVzZXJHcm91cFN1Y2Nlc3Moe1xuICAgICAgICAgICAgICAvLyAgICAgdWlkOiBkYXRhLmlkLFxuICAgICAgICAgICAgICAvLyAgICAgc2VsZWN0ZWQ6IGRhdGEuc2VsZWN0ZWQsXG4gICAgICAgICAgICAgIC8vICAgfSlcbiAgICAgICAgICAgICAgKCkgPT4gW1xuICAgICAgICAgICAgICAgIG5ldyBCMkJVc2VyQWN0aW9ucy5VbmFzc2lnbkIyQlVzZXJVc2VyR3JvdXBTdWNjZXNzKHtcbiAgICAgICAgICAgICAgICAgIHVpZDogcGF5bG9hZC51c2VyR3JvdXBJZCxcbiAgICAgICAgICAgICAgICAgIHNlbGVjdGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yOiBIdHRwRXJyb3JSZXNwb25zZSkgPT5cbiAgICAgICAgICAgICAgZnJvbShbXG4gICAgICAgICAgICAgICAgbmV3IEIyQlVzZXJBY3Rpb25zLlVuYXNzaWduQjJCVXNlclVzZXJHcm91cEZhaWwoe1xuICAgICAgICAgICAgICAgICAgb3JnQ3VzdG9tZXJJZDogcGF5bG9hZC5vcmdDdXN0b21lcklkLFxuICAgICAgICAgICAgICAgICAgdXNlckdyb3VwSWQ6IHBheWxvYWQudXNlckdyb3VwSWQsXG4gICAgICAgICAgICAgICAgICBlcnJvcjogbm9ybWFsaXplSHR0cEVycm9yKGVycm9yKSxcbiAgICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgICAgICBuZXcgT3JnYW5pemF0aW9uQWN0aW9ucy5Pcmdhbml6YXRpb25DbGVhckRhdGEoKSxcbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICApXG4gICAgKVxuICApO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgYWN0aW9ucyQ6IEFjdGlvbnMsXG4gICAgcHJpdmF0ZSBiMmJVc2VyQ29ubmVjdG9yOiBCMkJVc2VyQ29ubmVjdG9yLFxuICAgIHByaXZhdGUgcm91dGluZ1NlcnZpY2U6IFJvdXRpbmdTZXJ2aWNlLFxuICAgIHByaXZhdGUgdXNlckFjY291bnRGYWNhZGU6IFVzZXJBY2NvdW50RmFjYWRlLFxuICAgIHByaXZhdGUgdXNlcklkU2VydmljZTogVXNlcklkU2VydmljZVxuICApIHt9XG5cbiAgcHJvdGVjdGVkIHJlZGlyZWN0VG9EZXRhaWxzKHJvdXRlOiBSb3V0ZXJTdGF0ZSwgZGF0YTogQjJCVXNlcikge1xuICAgIGlmICgocm91dGUgYXMgYW55KT8uc3RhdGU/LmNvbnRleHQ/LmlkICE9PSAnL29yZ2FuaXphdGlvbi91bml0cycpIHtcbiAgICAgIHRoaXMucm91dGluZ1NlcnZpY2UuZ28oe1xuICAgICAgICBjeFJvdXRlOiAnb3JnVXNlckRldGFpbHMnLFxuICAgICAgICBwYXJhbXM6IGRhdGEsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==