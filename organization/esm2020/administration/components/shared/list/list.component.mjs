/*
 * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component, HostBinding, Input, } from '@angular/core';
import { ICON_TYPE, TrapFocus, } from '@spartacus/storefront';
import { tap } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "./list.service";
import * as i2 from "../item.service";
import * as i3 from "@angular/common";
import * as i4 from "@angular/router";
import * as i5 from "@spartacus/storefront";
import * as i6 from "@ng-select/ng-select";
import * as i7 from "@angular/forms";
import * as i8 from "@spartacus/core";
export class ListComponent {
    constructor(service, organizationItemService) {
        this.service = service;
        this.organizationItemService = organizationItemService;
        this.trapFocus = TrapFocus;
        this.hasGhostData = false;
        this.viewType = this.service.viewType;
        this.domainType = this.service.domainType;
        this.iconTypes = ICON_TYPE;
        /**
         * The current key represents the current selected item from the dataset.
         * This key is used to load the item details as well as highlight the item in
         * a list of items.
         */
        this.currentKey$ = this.organizationItemService.key$;
        this.structure$ = this.service.getStructure();
        this.listData$ = this.service
            .getData()
            .pipe(tap((data) => {
            this.sortCode = data?.pagination?.sort;
            this.hasGhostData = this.service.hasGhostData(data);
        }));
        this.key = this.service.key();
    }
    /**
     * Returns the total number of items.
     */
    getListCount(dataTable) {
        return dataTable.pagination?.totalResults;
    }
    /**
     * Browses to the given page number
     */
    browse(pagination, pageNumber) {
        if (pagination) {
            this.service.view(pagination, pageNumber);
        }
    }
    /**
     * Navigates to the detailed view of the selected list item.
     */
    launchItem(event) {
        this.organizationItemService.launchDetails(event);
    }
    /**
     * Sorts the list.
     */
    sort(pagination) {
        if (pagination) {
            this.service.sort({
                ...pagination,
                ...{ sort: this.sortCode },
            });
        }
    }
}
ListComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: ListComponent, deps: [{ token: i1.ListService }, { token: i2.ItemService }], target: i0.ɵɵFactoryTarget.Component });
ListComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.2.3", type: ListComponent, selector: "cx-org-list", inputs: { key: "key" }, host: { properties: { "class.ghost": "this.hasGhostData", "class": "this.viewType" } }, ngImport: i0, template: "<cx-split-view [hideMode]=\"false\">\n  <ng-container *ngIf=\"structure$ | async as structure\">\n    <cx-view class=\"list\" *ngIf=\"listData$ | async as data\">\n      <div class=\"header\">\n        <div class=\"title\">\n          <h3>\n            {{\n              viewType + '.header' | cxTranslate: { count: getListCount(data) }\n            }}\n            <button\n              [cxPopover]=\"listHint\"\n              [cxPopoverOptions]=\"{\n                placement: 'auto',\n                class: 'hint-popover',\n                appendToBody: true,\n                displayCloseButton: true\n              }\"\n            >\n              <cx-icon [type]=\"iconTypes.INFO\"> </cx-icon>\n            </button>\n          </h3>\n        </div>\n\n        <div class=\"actions\">\n          <label>\n            <span *ngIf=\"data.pagination?.sort\">{{\n              structure.type + '.sortBy' | cxTranslate\n            }}</span>\n            <ng-select\n              name=\"sort\"\n              class=\"sort\"\n              *ngIf=\"data.pagination?.sort\"\n              [searchable]=\"false\"\n              [clearable]=\"false\"\n              (change)=\"sort($any(data.pagination))\"\n              [tabIndex]=\"0\"\n              [(ngModel)]=\"sortCode\"\n              [attr.aria-label]=\"\n                (sortCode\n                  ? structure.type + '.sort.' + sortCode\n                  : structure.type + '.sortBy'\n                ) | cxTranslate\n              \"\n            >\n              <ng-option *ngFor=\"let sort of data.sorts\" [value]=\"sort.code\">\n                {{ structure.type + '.sort.' + sort.code | cxTranslate }}\n              </ng-option>\n            </ng-select>\n          </label>\n\n          <ng-content select=\"[actions]\"></ng-content>\n\n          <a\n            class=\"button primary create\"\n            [routerLink]=\"{ cxRoute: structure.type + 'Create' } | cxUrl\"\n            routerLinkActive=\"disabled\"\n          >\n            {{ 'organization.add' | cxTranslate }}\n          </a>\n        </div>\n      </div>\n\n      <cx-table\n        *ngIf=\"data.values && data.values.length > 0; else emptyList\"\n        [structure]=\"structure\"\n        [data]=\"data.values\"\n        [i18nRoot]=\"domainType\"\n        [currentItem]=\"{ property: key, value: currentKey$ | async }\"\n        (launch)=\"launchItem($event)\"\n        [cxFocus]=\"{ trap: trapFocus.both }\"\n      >\n      </cx-table>\n\n      <div class=\"footer\">\n        <cx-pagination\n          [pagination]=\"data.pagination\"\n          (viewPageEvent)=\"browse($any(data.pagination), $event)\"\n        ></cx-pagination>\n      </div>\n    </cx-view>\n\n    <!-- nested split views are rendered inside child routes -->\n    <router-outlet></router-outlet>\n  </ng-container>\n</cx-split-view>\n\n<ng-template #emptyList>\n  <p class=\"instruction is-empty\">\n    {{ 'organization.messages.emptyList' | cxTranslate }}\n  </p>\n</ng-template>\n\n<ng-template #listHint>\n  <p>\n    {{ viewType + '.hint' | cxTranslate }}\n  </p>\n</ng-template>\n", dependencies: [{ kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i4.RouterOutlet, selector: "router-outlet", outputs: ["activate", "deactivate", "attach", "detach"], exportAs: ["outlet"] }, { kind: "directive", type: i4.RouterLinkWithHref, selector: "a[routerLink],area[routerLink]", inputs: ["target", "queryParams", "fragment", "queryParamsHandling", "state", "relativeTo", "preserveFragment", "skipLocationChange", "replaceUrl", "routerLink"] }, { kind: "directive", type: i4.RouterLinkActive, selector: "[routerLinkActive]", inputs: ["routerLinkActiveOptions", "ariaCurrentWhenActive", "routerLinkActive"], outputs: ["isActiveChange"], exportAs: ["routerLinkActive"] }, { kind: "component", type: i5.SplitViewComponent, selector: "cx-split-view", inputs: ["hideMode"] }, { kind: "component", type: i5.ViewComponent, selector: "cx-view", inputs: ["position", "hidden"], outputs: ["hiddenChange"] }, { kind: "component", type: i5.TableComponent, selector: "cx-table", inputs: ["structure", "data", "i18nRoot", "currentItem"], outputs: ["launch"] }, { kind: "component", type: i5.IconComponent, selector: "cx-icon,[cxIcon]", inputs: ["cxIcon", "type"] }, { kind: "component", type: i5.PaginationComponent, selector: "cx-pagination", inputs: ["pageRoute", "queryParam", "defaultPage", "pagination"], outputs: ["viewPageEvent"] }, { kind: "component", type: i6.NgSelectComponent, selector: "ng-select", inputs: ["bindLabel", "bindValue", "markFirst", "placeholder", "notFoundText", "typeToSearchText", "addTagText", "loadingText", "clearAllText", "appearance", "dropdownPosition", "appendTo", "loading", "closeOnSelect", "hideSelected", "selectOnTab", "openOnEnter", "maxSelectedItems", "groupBy", "groupValue", "bufferAmount", "virtualScroll", "selectableGroup", "selectableGroupAsModel", "searchFn", "trackByFn", "clearOnBackspace", "labelForId", "inputAttrs", "tabIndex", "readonly", "searchWhileComposing", "minTermLength", "editableSearchTerm", "keyDownFn", "typeahead", "multiple", "addTag", "searchable", "clearable", "isOpen", "items", "compareWith", "clearSearchOnAdd"], outputs: ["blur", "focus", "change", "open", "close", "search", "clear", "add", "remove", "scroll", "scrollToEnd"] }, { kind: "component", type: i6.NgOptionComponent, selector: "ng-option", inputs: ["value", "disabled"] }, { kind: "directive", type: i7.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i7.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "directive", type: i5.FocusDirective, selector: "[cxFocus]", inputs: ["cxFocus"] }, { kind: "directive", type: i5.PopoverDirective, selector: "[cxPopover]", inputs: ["cxPopover", "cxPopoverOptions"], outputs: ["openPopover", "closePopover"] }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }, { kind: "pipe", type: i8.UrlPipe, name: "cxUrl" }, { kind: "pipe", type: i8.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: ListComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-org-list', changeDetection: ChangeDetectionStrategy.OnPush, template: "<cx-split-view [hideMode]=\"false\">\n  <ng-container *ngIf=\"structure$ | async as structure\">\n    <cx-view class=\"list\" *ngIf=\"listData$ | async as data\">\n      <div class=\"header\">\n        <div class=\"title\">\n          <h3>\n            {{\n              viewType + '.header' | cxTranslate: { count: getListCount(data) }\n            }}\n            <button\n              [cxPopover]=\"listHint\"\n              [cxPopoverOptions]=\"{\n                placement: 'auto',\n                class: 'hint-popover',\n                appendToBody: true,\n                displayCloseButton: true\n              }\"\n            >\n              <cx-icon [type]=\"iconTypes.INFO\"> </cx-icon>\n            </button>\n          </h3>\n        </div>\n\n        <div class=\"actions\">\n          <label>\n            <span *ngIf=\"data.pagination?.sort\">{{\n              structure.type + '.sortBy' | cxTranslate\n            }}</span>\n            <ng-select\n              name=\"sort\"\n              class=\"sort\"\n              *ngIf=\"data.pagination?.sort\"\n              [searchable]=\"false\"\n              [clearable]=\"false\"\n              (change)=\"sort($any(data.pagination))\"\n              [tabIndex]=\"0\"\n              [(ngModel)]=\"sortCode\"\n              [attr.aria-label]=\"\n                (sortCode\n                  ? structure.type + '.sort.' + sortCode\n                  : structure.type + '.sortBy'\n                ) | cxTranslate\n              \"\n            >\n              <ng-option *ngFor=\"let sort of data.sorts\" [value]=\"sort.code\">\n                {{ structure.type + '.sort.' + sort.code | cxTranslate }}\n              </ng-option>\n            </ng-select>\n          </label>\n\n          <ng-content select=\"[actions]\"></ng-content>\n\n          <a\n            class=\"button primary create\"\n            [routerLink]=\"{ cxRoute: structure.type + 'Create' } | cxUrl\"\n            routerLinkActive=\"disabled\"\n          >\n            {{ 'organization.add' | cxTranslate }}\n          </a>\n        </div>\n      </div>\n\n      <cx-table\n        *ngIf=\"data.values && data.values.length > 0; else emptyList\"\n        [structure]=\"structure\"\n        [data]=\"data.values\"\n        [i18nRoot]=\"domainType\"\n        [currentItem]=\"{ property: key, value: currentKey$ | async }\"\n        (launch)=\"launchItem($event)\"\n        [cxFocus]=\"{ trap: trapFocus.both }\"\n      >\n      </cx-table>\n\n      <div class=\"footer\">\n        <cx-pagination\n          [pagination]=\"data.pagination\"\n          (viewPageEvent)=\"browse($any(data.pagination), $event)\"\n        ></cx-pagination>\n      </div>\n    </cx-view>\n\n    <!-- nested split views are rendered inside child routes -->\n    <router-outlet></router-outlet>\n  </ng-container>\n</cx-split-view>\n\n<ng-template #emptyList>\n  <p class=\"instruction is-empty\">\n    {{ 'organization.messages.emptyList' | cxTranslate }}\n  </p>\n</ng-template>\n\n<ng-template #listHint>\n  <p>\n    {{ viewType + '.hint' | cxTranslate }}\n  </p>\n</ng-template>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ListService }, { type: i2.ItemService }]; }, propDecorators: { hasGhostData: [{
                type: HostBinding,
                args: ['class.ghost']
            }], viewType: [{
                type: HostBinding,
                args: ['class']
            }], key: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGlzdC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvb3JnYW5pemF0aW9uL2FkbWluaXN0cmF0aW9uL2NvbXBvbmVudHMvc2hhcmVkL2xpc3QvbGlzdC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvb3JnYW5pemF0aW9uL2FkbWluaXN0cmF0aW9uL2NvbXBvbmVudHMvc2hhcmVkL2xpc3QvbGlzdC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBRUgsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixTQUFTLEVBQ1QsV0FBVyxFQUNYLEtBQUssR0FDTixNQUFNLGVBQWUsQ0FBQztBQUV2QixPQUFPLEVBQ0wsU0FBUyxFQUdULFNBQVMsR0FDVixNQUFNLHVCQUF1QixDQUFDO0FBRS9CLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7Ozs7OztBQVVyQyxNQUFNLE9BQU8sYUFBYTtJQUt4QixZQUNZLE9BQTBCLEVBQzFCLHVCQUF1QztRQUR2QyxZQUFPLEdBQVAsT0FBTyxDQUFtQjtRQUMxQiw0QkFBdUIsR0FBdkIsdUJBQXVCLENBQWdCO1FBTjFDLGNBQVMsR0FBRyxTQUFTLENBQUM7UUFFSCxpQkFBWSxHQUFHLEtBQUssQ0FBQztRQVFqRCxhQUFRLEdBQTBCLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO1FBRXhELGVBQVUsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQztRQUlyQyxjQUFTLEdBQUcsU0FBUyxDQUFDO1FBRXRCOzs7O1dBSUc7UUFDTSxnQkFBVyxHQUFHLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUM7UUFFaEQsZUFBVSxHQUErQixJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBRXJFLGNBQVMsR0FBNkMsSUFBSSxDQUFDLE9BQU87YUFDeEUsT0FBTyxFQUFFO2FBQ1QsSUFBSSxDQUNILEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO1lBQ1gsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLEVBQUUsVUFBVSxFQUFFLElBQUksQ0FBQztZQUN2QyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RELENBQUMsQ0FBQyxDQUNILENBQUM7UUFFSyxRQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQTdCL0IsQ0FBQztJQStCSjs7T0FFRztJQUNILFlBQVksQ0FBQyxTQUFtQztRQUM5QyxPQUFPLFNBQVMsQ0FBQyxVQUFVLEVBQUUsWUFBWSxDQUFDO0lBQzVDLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxVQUF5QixFQUFFLFVBQWtCO1FBQ2xELElBQUksVUFBVSxFQUFFO1lBQ2QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1NBQzNDO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsVUFBVSxDQUFDLEtBQVE7UUFDakIsSUFBSSxDQUFDLHVCQUF1QixDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxJQUFJLENBQUMsVUFBeUI7UUFDNUIsSUFBSSxVQUFVLEVBQUU7WUFDZCxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQztnQkFDaEIsR0FBRyxVQUFVO2dCQUNiLEdBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBc0I7YUFDaEQsQ0FBQyxDQUFDO1NBQ0o7SUFDSCxDQUFDOzswR0F4RVUsYUFBYTs4RkFBYixhQUFhLG1LQzlCMUIsZ2lHQWlHQTsyRkRuRWEsYUFBYTtrQkFMekIsU0FBUzsrQkFDRSxhQUFhLG1CQUVOLHVCQUF1QixDQUFDLE1BQU07NEhBS25CLFlBQVk7c0JBQXZDLFdBQVc7dUJBQUMsYUFBYTtnQkFRMUIsUUFBUTtzQkFEUCxXQUFXO3VCQUFDLE9BQU87Z0JBMkJYLEdBQUc7c0JBQVgsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIyIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEhvc3RCaW5kaW5nLFxuICBJbnB1dCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBFbnRpdGllc01vZGVsLCBQYWdpbmF0aW9uTW9kZWwgfSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHtcbiAgSUNPTl9UWVBFLFxuICBUYWJsZSxcbiAgVGFibGVTdHJ1Y3R1cmUsXG4gIFRyYXBGb2N1cyxcbn0gZnJvbSAnQHNwYXJ0YWN1cy9zdG9yZWZyb250JztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEl0ZW1TZXJ2aWNlIH0gZnJvbSAnLi4vaXRlbS5zZXJ2aWNlJztcbmltcG9ydCB7IE9yZ2FuaXphdGlvblRhYmxlVHlwZSB9IGZyb20gJy4uL29yZ2FuaXphdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBMaXN0U2VydmljZSB9IGZyb20gJy4vbGlzdC5zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnY3gtb3JnLWxpc3QnLFxuICB0ZW1wbGF0ZVVybDogJy4vbGlzdC5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBMaXN0Q29tcG9uZW50PFQgPSBhbnksIFAgPSBQYWdpbmF0aW9uTW9kZWw+IHtcbiAgcmVhZG9ubHkgdHJhcEZvY3VzID0gVHJhcEZvY3VzO1xuXG4gIEBIb3N0QmluZGluZygnY2xhc3MuZ2hvc3QnKSBoYXNHaG9zdERhdGEgPSBmYWxzZTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgc2VydmljZTogTGlzdFNlcnZpY2U8VCwgUD4sXG4gICAgcHJvdGVjdGVkIG9yZ2FuaXphdGlvbkl0ZW1TZXJ2aWNlOiBJdGVtU2VydmljZTxUPlxuICApIHt9XG5cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcycpXG4gIHZpZXdUeXBlOiBPcmdhbml6YXRpb25UYWJsZVR5cGUgPSB0aGlzLnNlcnZpY2Uudmlld1R5cGU7XG5cbiAgZG9tYWluVHlwZSA9IHRoaXMuc2VydmljZS5kb21haW5UeXBlO1xuXG4gIHNvcnRDb2RlOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG5cbiAgaWNvblR5cGVzID0gSUNPTl9UWVBFO1xuXG4gIC8qKlxuICAgKiBUaGUgY3VycmVudCBrZXkgcmVwcmVzZW50cyB0aGUgY3VycmVudCBzZWxlY3RlZCBpdGVtIGZyb20gdGhlIGRhdGFzZXQuXG4gICAqIFRoaXMga2V5IGlzIHVzZWQgdG8gbG9hZCB0aGUgaXRlbSBkZXRhaWxzIGFzIHdlbGwgYXMgaGlnaGxpZ2h0IHRoZSBpdGVtIGluXG4gICAqIGEgbGlzdCBvZiBpdGVtcy5cbiAgICovXG4gIHJlYWRvbmx5IGN1cnJlbnRLZXkkID0gdGhpcy5vcmdhbml6YXRpb25JdGVtU2VydmljZS5rZXkkO1xuXG4gIHJlYWRvbmx5IHN0cnVjdHVyZSQ6IE9ic2VydmFibGU8VGFibGVTdHJ1Y3R1cmU+ID0gdGhpcy5zZXJ2aWNlLmdldFN0cnVjdHVyZSgpO1xuXG4gIHJlYWRvbmx5IGxpc3REYXRhJDogT2JzZXJ2YWJsZTxFbnRpdGllc01vZGVsPFQ+IHwgdW5kZWZpbmVkPiA9IHRoaXMuc2VydmljZVxuICAgIC5nZXREYXRhKClcbiAgICAucGlwZShcbiAgICAgIHRhcCgoZGF0YSkgPT4ge1xuICAgICAgICB0aGlzLnNvcnRDb2RlID0gZGF0YT8ucGFnaW5hdGlvbj8uc29ydDtcbiAgICAgICAgdGhpcy5oYXNHaG9zdERhdGEgPSB0aGlzLnNlcnZpY2UuaGFzR2hvc3REYXRhKGRhdGEpO1xuICAgICAgfSlcbiAgICApO1xuXG4gIEBJbnB1dCgpIGtleSA9IHRoaXMuc2VydmljZS5rZXkoKTtcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgdG90YWwgbnVtYmVyIG9mIGl0ZW1zLlxuICAgKi9cbiAgZ2V0TGlzdENvdW50KGRhdGFUYWJsZTogVGFibGUgfCBFbnRpdGllc01vZGVsPFQ+KTogbnVtYmVyIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gZGF0YVRhYmxlLnBhZ2luYXRpb24/LnRvdGFsUmVzdWx0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBCcm93c2VzIHRvIHRoZSBnaXZlbiBwYWdlIG51bWJlclxuICAgKi9cbiAgYnJvd3NlKHBhZ2luYXRpb246IFAgfCB1bmRlZmluZWQsIHBhZ2VOdW1iZXI6IG51bWJlcikge1xuICAgIGlmIChwYWdpbmF0aW9uKSB7XG4gICAgICB0aGlzLnNlcnZpY2UudmlldyhwYWdpbmF0aW9uLCBwYWdlTnVtYmVyKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTmF2aWdhdGVzIHRvIHRoZSBkZXRhaWxlZCB2aWV3IG9mIHRoZSBzZWxlY3RlZCBsaXN0IGl0ZW0uXG4gICAqL1xuICBsYXVuY2hJdGVtKGV2ZW50OiBUKTogdm9pZCB7XG4gICAgdGhpcy5vcmdhbml6YXRpb25JdGVtU2VydmljZS5sYXVuY2hEZXRhaWxzKGV2ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTb3J0cyB0aGUgbGlzdC5cbiAgICovXG4gIHNvcnQocGFnaW5hdGlvbjogUCB8IHVuZGVmaW5lZCk6IHZvaWQge1xuICAgIGlmIChwYWdpbmF0aW9uKSB7XG4gICAgICB0aGlzLnNlcnZpY2Uuc29ydCh7XG4gICAgICAgIC4uLnBhZ2luYXRpb24sXG4gICAgICAgIC4uLih7IHNvcnQ6IHRoaXMuc29ydENvZGUgfSBhcyBQYWdpbmF0aW9uTW9kZWwpLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG59XG4iLCI8Y3gtc3BsaXQtdmlldyBbaGlkZU1vZGVdPVwiZmFsc2VcIj5cbiAgPG5nLWNvbnRhaW5lciAqbmdJZj1cInN0cnVjdHVyZSQgfCBhc3luYyBhcyBzdHJ1Y3R1cmVcIj5cbiAgICA8Y3gtdmlldyBjbGFzcz1cImxpc3RcIiAqbmdJZj1cImxpc3REYXRhJCB8IGFzeW5jIGFzIGRhdGFcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJoZWFkZXJcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInRpdGxlXCI+XG4gICAgICAgICAgPGgzPlxuICAgICAgICAgICAge3tcbiAgICAgICAgICAgICAgdmlld1R5cGUgKyAnLmhlYWRlcicgfCBjeFRyYW5zbGF0ZTogeyBjb3VudDogZ2V0TGlzdENvdW50KGRhdGEpIH1cbiAgICAgICAgICAgIH19XG4gICAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICAgIFtjeFBvcG92ZXJdPVwibGlzdEhpbnRcIlxuICAgICAgICAgICAgICBbY3hQb3BvdmVyT3B0aW9uc109XCJ7XG4gICAgICAgICAgICAgICAgcGxhY2VtZW50OiAnYXV0bycsXG4gICAgICAgICAgICAgICAgY2xhc3M6ICdoaW50LXBvcG92ZXInLFxuICAgICAgICAgICAgICAgIGFwcGVuZFRvQm9keTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBkaXNwbGF5Q2xvc2VCdXR0b246IHRydWVcbiAgICAgICAgICAgICAgfVwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxjeC1pY29uIFt0eXBlXT1cImljb25UeXBlcy5JTkZPXCI+IDwvY3gtaWNvbj5cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIDwvaDM+XG4gICAgICAgIDwvZGl2PlxuXG4gICAgICAgIDxkaXYgY2xhc3M9XCJhY3Rpb25zXCI+XG4gICAgICAgICAgPGxhYmVsPlxuICAgICAgICAgICAgPHNwYW4gKm5nSWY9XCJkYXRhLnBhZ2luYXRpb24/LnNvcnRcIj57e1xuICAgICAgICAgICAgICBzdHJ1Y3R1cmUudHlwZSArICcuc29ydEJ5JyB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICB9fTwvc3Bhbj5cbiAgICAgICAgICAgIDxuZy1zZWxlY3RcbiAgICAgICAgICAgICAgbmFtZT1cInNvcnRcIlxuICAgICAgICAgICAgICBjbGFzcz1cInNvcnRcIlxuICAgICAgICAgICAgICAqbmdJZj1cImRhdGEucGFnaW5hdGlvbj8uc29ydFwiXG4gICAgICAgICAgICAgIFtzZWFyY2hhYmxlXT1cImZhbHNlXCJcbiAgICAgICAgICAgICAgW2NsZWFyYWJsZV09XCJmYWxzZVwiXG4gICAgICAgICAgICAgIChjaGFuZ2UpPVwic29ydCgkYW55KGRhdGEucGFnaW5hdGlvbikpXCJcbiAgICAgICAgICAgICAgW3RhYkluZGV4XT1cIjBcIlxuICAgICAgICAgICAgICBbKG5nTW9kZWwpXT1cInNvcnRDb2RlXCJcbiAgICAgICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJcbiAgICAgICAgICAgICAgICAoc29ydENvZGVcbiAgICAgICAgICAgICAgICAgID8gc3RydWN0dXJlLnR5cGUgKyAnLnNvcnQuJyArIHNvcnRDb2RlXG4gICAgICAgICAgICAgICAgICA6IHN0cnVjdHVyZS50eXBlICsgJy5zb3J0QnknXG4gICAgICAgICAgICAgICAgKSB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICAgIFwiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxuZy1vcHRpb24gKm5nRm9yPVwibGV0IHNvcnQgb2YgZGF0YS5zb3J0c1wiIFt2YWx1ZV09XCJzb3J0LmNvZGVcIj5cbiAgICAgICAgICAgICAgICB7eyBzdHJ1Y3R1cmUudHlwZSArICcuc29ydC4nICsgc29ydC5jb2RlIHwgY3hUcmFuc2xhdGUgfX1cbiAgICAgICAgICAgICAgPC9uZy1vcHRpb24+XG4gICAgICAgICAgICA8L25nLXNlbGVjdD5cbiAgICAgICAgICA8L2xhYmVsPlxuXG4gICAgICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwiW2FjdGlvbnNdXCI+PC9uZy1jb250ZW50PlxuXG4gICAgICAgICAgPGFcbiAgICAgICAgICAgIGNsYXNzPVwiYnV0dG9uIHByaW1hcnkgY3JlYXRlXCJcbiAgICAgICAgICAgIFtyb3V0ZXJMaW5rXT1cInsgY3hSb3V0ZTogc3RydWN0dXJlLnR5cGUgKyAnQ3JlYXRlJyB9IHwgY3hVcmxcIlxuICAgICAgICAgICAgcm91dGVyTGlua0FjdGl2ZT1cImRpc2FibGVkXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICB7eyAnb3JnYW5pemF0aW9uLmFkZCcgfCBjeFRyYW5zbGF0ZSB9fVxuICAgICAgICAgIDwvYT5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPGN4LXRhYmxlXG4gICAgICAgICpuZ0lmPVwiZGF0YS52YWx1ZXMgJiYgZGF0YS52YWx1ZXMubGVuZ3RoID4gMDsgZWxzZSBlbXB0eUxpc3RcIlxuICAgICAgICBbc3RydWN0dXJlXT1cInN0cnVjdHVyZVwiXG4gICAgICAgIFtkYXRhXT1cImRhdGEudmFsdWVzXCJcbiAgICAgICAgW2kxOG5Sb290XT1cImRvbWFpblR5cGVcIlxuICAgICAgICBbY3VycmVudEl0ZW1dPVwieyBwcm9wZXJ0eToga2V5LCB2YWx1ZTogY3VycmVudEtleSQgfCBhc3luYyB9XCJcbiAgICAgICAgKGxhdW5jaCk9XCJsYXVuY2hJdGVtKCRldmVudClcIlxuICAgICAgICBbY3hGb2N1c109XCJ7IHRyYXA6IHRyYXBGb2N1cy5ib3RoIH1cIlxuICAgICAgPlxuICAgICAgPC9jeC10YWJsZT5cblxuICAgICAgPGRpdiBjbGFzcz1cImZvb3RlclwiPlxuICAgICAgICA8Y3gtcGFnaW5hdGlvblxuICAgICAgICAgIFtwYWdpbmF0aW9uXT1cImRhdGEucGFnaW5hdGlvblwiXG4gICAgICAgICAgKHZpZXdQYWdlRXZlbnQpPVwiYnJvd3NlKCRhbnkoZGF0YS5wYWdpbmF0aW9uKSwgJGV2ZW50KVwiXG4gICAgICAgID48L2N4LXBhZ2luYXRpb24+XG4gICAgICA8L2Rpdj5cbiAgICA8L2N4LXZpZXc+XG5cbiAgICA8IS0tIG5lc3RlZCBzcGxpdCB2aWV3cyBhcmUgcmVuZGVyZWQgaW5zaWRlIGNoaWxkIHJvdXRlcyAtLT5cbiAgICA8cm91dGVyLW91dGxldD48L3JvdXRlci1vdXRsZXQ+XG4gIDwvbmctY29udGFpbmVyPlxuPC9jeC1zcGxpdC12aWV3PlxuXG48bmctdGVtcGxhdGUgI2VtcHR5TGlzdD5cbiAgPHAgY2xhc3M9XCJpbnN0cnVjdGlvbiBpcy1lbXB0eVwiPlxuICAgIHt7ICdvcmdhbml6YXRpb24ubWVzc2FnZXMuZW1wdHlMaXN0JyB8IGN4VHJhbnNsYXRlIH19XG4gIDwvcD5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSAjbGlzdEhpbnQ+XG4gIDxwPlxuICAgIHt7IHZpZXdUeXBlICsgJy5oaW50JyB8IGN4VHJhbnNsYXRlIH19XG4gIDwvcD5cbjwvbmctdGVtcGxhdGU+XG4iXX0=