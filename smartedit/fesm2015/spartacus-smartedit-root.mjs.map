{"version":3,"file":"spartacus-smartedit-root.mjs","sources":["../../../feature-libs/smartedit/root/config/smart-edit-config.ts","../../../feature-libs/smartedit/root/feature-name.ts","../../../feature-libs/smartedit/root/services/smart-edit-launcher.service.ts","../../../feature-libs/smartedit/root/config/default-smart-edit-config.ts","../../../feature-libs/smartedit/root/http-interceptors/cms-ticket.interceptor.ts","../../../feature-libs/smartedit/root/http-interceptors/index.ts","../../../feature-libs/smartedit/root/smart-edit-root.module.ts","../../../feature-libs/smartedit/root/public_api.ts","../../../feature-libs/smartedit/root/spartacus-smartedit-root.ts"],"sourcesContent":["/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Injectable } from '@angular/core';\nimport { Config } from '@spartacus/core';\n\n@Injectable({\n  providedIn: 'root',\n  useExisting: Config,\n})\nexport abstract class SmartEditConfig {\n  smartEdit?: {\n    storefrontPreviewRoute?: string;\n    allowOrigin?: string;\n  };\n}\n\ndeclare module '@spartacus/core' {\n  interface Config extends SmartEditConfig {}\n}\n","/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const SMART_EDIT_FEATURE = 'smartEdit';\n","/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { Location } from '@angular/common';\nimport { Injectable } from '@angular/core';\nimport { FeatureModulesService } from '@spartacus/core';\nimport { SmartEditConfig } from '../config/smart-edit-config';\n\n/**\n * The SmartEditLauncherService is used to check whether Spartacus is launched inside Smart Edit;\n * it also gets cmsTicketId sent from Smart Edit.\n */\n@Injectable({\n  providedIn: 'root',\n})\nexport class SmartEditLauncherService {\n  private _cmsTicketId: string | undefined;\n\n  get cmsTicketId(): string | undefined {\n    return this._cmsTicketId;\n  }\n\n  constructor(\n    protected config: SmartEditConfig,\n    protected location: Location,\n    protected featureModules: FeatureModulesService\n  ) {}\n\n  /**\n   * Lazy loads modules when Spartacus launced inside Smart Edit\n   */\n  load(): void {\n    if (\n      this.isLaunchedInSmartEdit() &&\n      this.featureModules.isConfigured('smartEdit')\n    ) {\n      this.featureModules.resolveFeature('smartEdit').subscribe();\n    }\n  }\n\n  /**\n   * Indicates whether Spartacus is launched in SmartEdit\n   */\n  isLaunchedInSmartEdit(): boolean {\n    const path = this.location.path().split('?')[0];\n    const params = this.location.path().split('?')[1];\n    const cmsToken = params\n      ?.split('&')\n      .find((param) => param.startsWith('cmsTicketId='));\n    this._cmsTicketId = cmsToken?.split('=')[1];\n\n    return (\n      path.split('/').pop() === this.config.smartEdit?.storefrontPreviewRoute &&\n      !!this._cmsTicketId\n    );\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { SmartEditConfig } from './smart-edit-config';\n\nexport const defaultSmartEditConfig: SmartEditConfig = {\n  smartEdit: {\n    storefrontPreviewRoute: 'cx-preview',\n    allowOrigin: 'localhost:9002',\n  },\n};\n","/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {\n  HttpEvent,\n  HttpHandler,\n  HttpInterceptor,\n  HttpRequest,\n} from '@angular/common/http';\nimport { Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { SmartEditLauncherService } from '../services/smart-edit-launcher.service';\n\n@Injectable({ providedIn: 'root' })\nexport class CmsTicketInterceptor implements HttpInterceptor {\n  constructor(private service: SmartEditLauncherService) {}\n\n  intercept(\n    request: HttpRequest<any>,\n    next: HttpHandler\n  ): Observable<HttpEvent<any>> {\n    if (this.service.cmsTicketId && request.url.includes('/cms/')) {\n      request = request.clone({\n        setParams: {\n          cmsTicketId: this.service.cmsTicketId,\n        },\n      });\n    }\n\n    return next.handle(request);\n  }\n}\n","/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { HTTP_INTERCEPTORS } from '@angular/common/http';\nimport { Provider } from '@angular/core';\nimport { CmsTicketInterceptor } from './cms-ticket.interceptor';\n\nexport const interceptors: Provider[] = [\n  {\n    provide: HTTP_INTERCEPTORS,\n    useExisting: CmsTicketInterceptor,\n    multi: true,\n  },\n];\n","/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { APP_INITIALIZER, NgModule } from '@angular/core';\nimport { provideDefaultConfig } from '@spartacus/core';\nimport { defaultSmartEditConfig } from './config/default-smart-edit-config';\nimport { interceptors } from './http-interceptors/index';\nimport { SmartEditLauncherService } from './services/smart-edit-launcher.service';\n\nexport function smartEditFactory(\n  smartEditLauncherService: SmartEditLauncherService\n) {\n  const isReady = () => {\n    smartEditLauncherService.load();\n  };\n  return isReady;\n}\n\n@NgModule({\n  providers: [\n    ...interceptors,\n    provideDefaultConfig(defaultSmartEditConfig),\n    {\n      provide: APP_INITIALIZER,\n      useFactory: smartEditFactory,\n      deps: [SmartEditLauncherService],\n      multi: true,\n    },\n  ],\n})\nexport class SmartEditRootModule {}\n","/*\n * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>\n *\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport * from './config/smart-edit-config';\nexport * from './feature-name';\nexport * from './services/smart-edit-launcher.service';\nexport * from './smart-edit-root.module';\nexport * from './http-interceptors/cms-ticket.interceptor';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["i1.SmartEditConfig","i1.SmartEditLauncherService"],"mappings":"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"}