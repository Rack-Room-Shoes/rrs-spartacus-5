/*
 * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component, Input, isDevMode, } from '@angular/core';
import { UntypedFormControl } from '@angular/forms';
import { Configurator } from '../../../../core/model/configurator.model';
import { ConfiguratorAttributeMultiSelectionBaseComponent } from '../base/configurator-attribute-multi-selection-base.component';
import * as i0 from "@angular/core";
import * as i1 from "../../../service/configurator-storefront-utils.service";
import * as i2 from "../../quantity/configurator-attribute-quantity.service";
import * as i3 from "@spartacus/storefront";
import * as i4 from "@angular/forms";
import * as i5 from "@angular/common";
import * as i6 from "../../quantity/configurator-attribute-quantity.component";
import * as i7 from "../../../price/configurator-price.component";
import * as i8 from "@spartacus/core";
export class ConfiguratorAttributeCheckBoxListComponent extends ConfiguratorAttributeMultiSelectionBaseComponent {
    constructor(configUtilsService, quantityService) {
        super(quantityService);
        this.configUtilsService = configUtilsService;
        this.quantityService = quantityService;
        this.attributeCheckBoxForms = new Array();
    }
    ngOnInit() {
        const disabled = !this.allowZeroValueQuantity;
        for (const value of this.attribute.values ?? []) {
            let attributeCheckBoxForm;
            if (value.selected) {
                attributeCheckBoxForm = new UntypedFormControl({
                    value: true,
                    disabled: disabled,
                });
            }
            else {
                attributeCheckBoxForm = new UntypedFormControl(false);
            }
            this.attributeCheckBoxForms.push(attributeCheckBoxForm);
        }
    }
    get allowZeroValueQuantity() {
        return this.quantityService.allowZeroValueQuantity(this.attribute);
    }
    onSelect() {
        const selectedValues = this.configUtilsService.assembleValuesForMultiSelectAttributes(this.attributeCheckBoxForms, this.attribute);
        const event = {
            changedAttribute: {
                ...this.attribute,
                values: selectedValues,
            },
            ownerKey: this.ownerKey,
            updateType: Configurator.UpdateType.ATTRIBUTE,
        };
        this.selectionChange.emit(event);
    }
    onChangeValueQuantity(eventObject, valueCode, formIndex) {
        if (eventObject === 0) {
            this.attributeCheckBoxForms[formIndex].setValue(false);
            this.onSelect();
            return;
        }
        const value = this.configUtilsService
            .assembleValuesForMultiSelectAttributes(this.attributeCheckBoxForms, this.attribute)
            .find((item) => item.valueCode === valueCode);
        if (!value) {
            if (isDevMode()) {
                console.warn('no value for event:', eventObject);
            }
            return;
        }
        value.quantity = eventObject;
        const event = {
            changedAttribute: {
                ...this.attribute,
                values: [value],
            },
            ownerKey: this.ownerKey,
            updateType: Configurator.UpdateType.VALUE_QUANTITY,
        };
        this.selectionChange.emit(event);
    }
    onChangeQuantity(eventObject) {
        if (!eventObject) {
            this.attributeCheckBoxForms.forEach((_, index) => this.attributeCheckBoxForms[index].setValue(false));
            this.onSelect();
        }
        else {
            this.onHandleAttributeQuantity(eventObject);
        }
    }
}
ConfiguratorAttributeCheckBoxListComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: ConfiguratorAttributeCheckBoxListComponent, deps: [{ token: i1.ConfiguratorStorefrontUtilsService }, { token: i2.ConfiguratorAttributeQuantityService }], target: i0.ɵɵFactoryTarget.Component });
ConfiguratorAttributeCheckBoxListComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.2.3", type: ConfiguratorAttributeCheckBoxListComponent, selector: "cx-configurator-attribute-checkbox-list", inputs: { group: "group" }, usesInheritance: true, ngImport: i0, template: "<fieldset>\n  <legend style=\"display: none\">{{ attribute.label }}</legend>\n  <div id=\"{{ createAttributeIdForConfigurator(attribute) }}\">\n    <div\n      *ngIf=\"withQuantityOnAttributeLevel\"\n      class=\"cx-attribute-level-quantity-price\"\n    >\n      <cx-configurator-attribute-quantity\n        (changeQuantity)=\"onChangeQuantity($event)\"\n        [quantityOptions]=\"\n          extractQuantityParameters(attribute.quantity, !attribute.required)\n        \"\n      ></cx-configurator-attribute-quantity>\n      <cx-configurator-price\n        [formula]=\"extractPriceFormulaParameters()\"\n      ></cx-configurator-price>\n    </div>\n    <ng-container *ngFor=\"let value of attribute.values; let i = index\">\n      <div class=\"form-check\">\n        <div class=\"cx-value-label-pair\">\n          <input\n            id=\"{{\n              createAttributeValueIdForConfigurator(attribute, value.valueCode)\n            }}\"\n            type=\"checkbox\"\n            class=\"form-check-input\"\n            [cxFocus]=\"{ key: attribute.name + '-' + value.name }\"\n            [value]=\"value.valueCode\"\n            (change)=\"onSelect()\"\n            [formControl]=\"attributeCheckBoxForms[i]\"\n            name=\"{{ createAttributeIdForConfigurator(attribute) }}\"\n            [attr.aria-label]=\"\n              value.valuePrice && value.valuePrice?.value !== 0\n                ? value.valuePriceTotal && value.valuePriceTotal?.value !== 0\n                  ? ('configurator.a11y.valueOfAttributeFullWithPrice'\n                    | cxTranslate\n                      : {\n                          value: value.valueDisplay,\n                          attribute: attribute.label,\n                          price: value.valuePriceTotal.formattedValue\n                        })\n                  : ('configurator.a11y.valueOfAttributeFullWithPrice'\n                    | cxTranslate\n                      : {\n                          value: value.valueDisplay,\n                          attribute: attribute.label,\n                          price: value.valuePrice.formattedValue\n                        })\n                : ('configurator.a11y.valueOfAttributeFull'\n                  | cxTranslate\n                    : { value: value.valueDisplay, attribute: attribute.label })\n            \"\n            [attr.aria-describedby]=\"\n              createAttributeUiKey('label', attribute.name)\n            \"\n          />\n          <label\n            id=\"{{\n              createValueUiKey('label', attribute.name, value.valueCode)\n            }}\"\n            for=\"{{\n              createAttributeValueIdForConfigurator(attribute, value.valueCode)\n            }}\"\n            aria-hidden=\"true\"\n            class=\"cx-configurator-attribute-value-label form-check-label\"\n            >{{ value.valueDisplay }}</label\n          >\n        </div>\n        <div class=\"cx-value-price\">\n          <cx-configurator-price\n            [formula]=\"extractValuePriceFormulaParameters(value)\"\n          ></cx-configurator-price>\n        </div>\n      </div>\n      <cx-configurator-attribute-quantity\n        *ngIf=\"value.selected && withQuantity && !withQuantityOnAttributeLevel\"\n        (changeQuantity)=\"onChangeValueQuantity($event, value.valueCode, i)\"\n        [quantityOptions]=\"\n          extractQuantityParameters(value.quantity, allowZeroValueQuantity)\n        \"\n      ></cx-configurator-attribute-quantity>\n    </ng-container>\n  </div>\n</fieldset>\n", dependencies: [{ kind: "directive", type: i3.FocusDirective, selector: "[cxFocus]", inputs: ["cxFocus"] }, { kind: "directive", type: i4.CheckboxControlValueAccessor, selector: "input[type=checkbox][formControlName],input[type=checkbox][formControl],input[type=checkbox][ngModel]" }, { kind: "directive", type: i4.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i4.FormControlDirective, selector: "[formControl]", inputs: ["formControl", "disabled", "ngModel"], outputs: ["ngModelChange"], exportAs: ["ngForm"] }, { kind: "directive", type: i5.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i5.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i6.ConfiguratorAttributeQuantityComponent, selector: "cx-configurator-attribute-quantity", inputs: ["quantityOptions"], outputs: ["changeQuantity"] }, { kind: "component", type: i7.ConfiguratorPriceComponent, selector: "cx-configurator-price", inputs: ["formula"] }, { kind: "pipe", type: i8.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: ConfiguratorAttributeCheckBoxListComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-configurator-attribute-checkbox-list', changeDetection: ChangeDetectionStrategy.OnPush, template: "<fieldset>\n  <legend style=\"display: none\">{{ attribute.label }}</legend>\n  <div id=\"{{ createAttributeIdForConfigurator(attribute) }}\">\n    <div\n      *ngIf=\"withQuantityOnAttributeLevel\"\n      class=\"cx-attribute-level-quantity-price\"\n    >\n      <cx-configurator-attribute-quantity\n        (changeQuantity)=\"onChangeQuantity($event)\"\n        [quantityOptions]=\"\n          extractQuantityParameters(attribute.quantity, !attribute.required)\n        \"\n      ></cx-configurator-attribute-quantity>\n      <cx-configurator-price\n        [formula]=\"extractPriceFormulaParameters()\"\n      ></cx-configurator-price>\n    </div>\n    <ng-container *ngFor=\"let value of attribute.values; let i = index\">\n      <div class=\"form-check\">\n        <div class=\"cx-value-label-pair\">\n          <input\n            id=\"{{\n              createAttributeValueIdForConfigurator(attribute, value.valueCode)\n            }}\"\n            type=\"checkbox\"\n            class=\"form-check-input\"\n            [cxFocus]=\"{ key: attribute.name + '-' + value.name }\"\n            [value]=\"value.valueCode\"\n            (change)=\"onSelect()\"\n            [formControl]=\"attributeCheckBoxForms[i]\"\n            name=\"{{ createAttributeIdForConfigurator(attribute) }}\"\n            [attr.aria-label]=\"\n              value.valuePrice && value.valuePrice?.value !== 0\n                ? value.valuePriceTotal && value.valuePriceTotal?.value !== 0\n                  ? ('configurator.a11y.valueOfAttributeFullWithPrice'\n                    | cxTranslate\n                      : {\n                          value: value.valueDisplay,\n                          attribute: attribute.label,\n                          price: value.valuePriceTotal.formattedValue\n                        })\n                  : ('configurator.a11y.valueOfAttributeFullWithPrice'\n                    | cxTranslate\n                      : {\n                          value: value.valueDisplay,\n                          attribute: attribute.label,\n                          price: value.valuePrice.formattedValue\n                        })\n                : ('configurator.a11y.valueOfAttributeFull'\n                  | cxTranslate\n                    : { value: value.valueDisplay, attribute: attribute.label })\n            \"\n            [attr.aria-describedby]=\"\n              createAttributeUiKey('label', attribute.name)\n            \"\n          />\n          <label\n            id=\"{{\n              createValueUiKey('label', attribute.name, value.valueCode)\n            }}\"\n            for=\"{{\n              createAttributeValueIdForConfigurator(attribute, value.valueCode)\n            }}\"\n            aria-hidden=\"true\"\n            class=\"cx-configurator-attribute-value-label form-check-label\"\n            >{{ value.valueDisplay }}</label\n          >\n        </div>\n        <div class=\"cx-value-price\">\n          <cx-configurator-price\n            [formula]=\"extractValuePriceFormulaParameters(value)\"\n          ></cx-configurator-price>\n        </div>\n      </div>\n      <cx-configurator-attribute-quantity\n        *ngIf=\"value.selected && withQuantity && !withQuantityOnAttributeLevel\"\n        (changeQuantity)=\"onChangeValueQuantity($event, value.valueCode, i)\"\n        [quantityOptions]=\"\n          extractQuantityParameters(value.quantity, allowZeroValueQuantity)\n        \"\n      ></cx-configurator-attribute-quantity>\n    </ng-container>\n  </div>\n</fieldset>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ConfiguratorStorefrontUtilsService }, { type: i2.ConfiguratorAttributeQuantityService }]; }, propDecorators: { group: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1jaGVja2JveC1saXN0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL2ZlYXR1cmUtbGlicy9wcm9kdWN0LWNvbmZpZ3VyYXRvci9ydWxlYmFzZWQvY29tcG9uZW50cy9hdHRyaWJ1dGUvdHlwZXMvY2hlY2tib3gtbGlzdC9jb25maWd1cmF0b3ItYXR0cmlidXRlLWNoZWNrYm94LWxpc3QuY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL2F0dHJpYnV0ZS90eXBlcy9jaGVja2JveC1saXN0L2NvbmZpZ3VyYXRvci1hdHRyaWJ1dGUtY2hlY2tib3gtbGlzdC5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBRUgsT0FBTyxFQUNMLHVCQUF1QixFQUN2QixTQUFTLEVBQ1QsS0FBSyxFQUNMLFNBQVMsR0FFVixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNwRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFJekUsT0FBTyxFQUFFLGdEQUFnRCxFQUFFLE1BQU0sK0RBQStELENBQUM7Ozs7Ozs7Ozs7QUFPakksTUFBTSxPQUFPLDBDQUNYLFNBQVEsZ0RBQWdEO0lBT3hELFlBQ1ksa0JBQXNELEVBQ3RELGVBQXFEO1FBRS9ELEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUhiLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0M7UUFDdEQsb0JBQWUsR0FBZixlQUFlLENBQXNDO1FBTmpFLDJCQUFzQixHQUFHLElBQUksS0FBSyxFQUFzQixDQUFDO0lBU3pELENBQUM7SUFFRCxRQUFRO1FBQ04sTUFBTSxR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QUFDO1lBQ0YsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1NBQ2pCO2FBQU07WUFDTCxJQUFJLENBQUMseUJBQXlCLENBQUMsV0FBVyxDQUFDLENBQUM7U0FDN0M7SUFDSCxDQUFDOzt1SUF6R1UsMENBQTBDOzJIQUExQywwQ0FBMEMsa0lDekJ2RCxtOUdBb0ZBOzJGRDNEYSwwQ0FBMEM7a0JBTHRELFNBQVM7K0JBQ0UseUNBQXlDLG1CQUVsQyx1QkFBdUIsQ0FBQyxNQUFNOzRLQVF0QyxLQUFLO3NCQUFiLEtBQUsiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogU1BEWC1GaWxlQ29weXJpZ2h0VGV4dDogMjAyMiBTQVAgU3BhcnRhY3VzIHRlYW0gPHNwYXJ0YWN1cy10ZWFtQHNhcC5jb20+XG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ29tcG9uZW50LFxuICBJbnB1dCxcbiAgaXNEZXZNb2RlLFxuICBPbkluaXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVW50eXBlZEZvcm1Db250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yIH0gZnJvbSAnLi4vLi4vLi4vLi4vY29yZS9tb2RlbC9jb25maWd1cmF0b3IubW9kZWwnO1xuaW1wb3J0IHsgQ29uZmlnRm9ybVVwZGF0ZUV2ZW50IH0gZnJvbSAnLi4vLi4vLi4vZm9ybS9jb25maWd1cmF0b3ItZm9ybS5ldmVudCc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3JTdG9yZWZyb250VXRpbHNTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vc2VydmljZS9jb25maWd1cmF0b3Itc3RvcmVmcm9udC11dGlscy5zZXJ2aWNlJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvckF0dHJpYnV0ZVF1YW50aXR5U2VydmljZSB9IGZyb20gJy4uLy4uL3F1YW50aXR5L2NvbmZpZ3VyYXRvci1hdHRyaWJ1dGUtcXVhbnRpdHkuc2VydmljZSc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3JBdHRyaWJ1dGVNdWx0aVNlbGVjdGlvbkJhc2VDb21wb25lbnQgfSBmcm9tICcuLi9iYXNlL2NvbmZpZ3VyYXRvci1hdHRyaWJ1dGUtbXVsdGktc2VsZWN0aW9uLWJhc2UuY29tcG9uZW50JztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnY3gtY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1jaGVja2JveC1saXN0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL2NvbmZpZ3VyYXRvci1hdHRyaWJ1dGUtY2hlY2tib3gtbGlzdC5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBDb25maWd1cmF0b3JBdHRyaWJ1dGVDaGVja0JveExpc3RDb21wb25lbnRcbiAgZXh0ZW5kcyBDb25maWd1cmF0b3JBdHRyaWJ1dGVNdWx0aVNlbGVjdGlvbkJhc2VDb21wb25lbnRcbiAgaW1wbGVtZW50cyBPbkluaXRcbntcbiAgYXR0cmlidXRlQ2hlY2tCb3hGb3JtcyA9IG5ldyBBcnJheTxVbnR5cGVkRm9ybUNvbnRyb2w+KCk7XG5cbiAgQElucHV0KCkgZ3JvdXA6IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcm90ZWN0ZWQgY29uZmlnVXRpbHNTZXJ2aWNlOiBDb25maWd1cmF0b3JTdG9yZWZyb250VXRpbHNTZXJ2aWNlLFxuICAgIHByb3RlY3RlZCBxdWFudGl0eVNlcnZpY2U6IENvbmZpZ3VyYXRvckF0dHJpYnV0ZVF1YW50aXR5U2VydmljZVxuICApIHtcbiAgICBzdXBlcihxdWFudGl0eVNlcnZpY2UpO1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgY29uc3QgZGlzYWJsZWQgPSAhdGhpcy5hbGxvd1plcm9WYWx1ZVF1YW50aXR5O1xuXG4gICAgZm9yIChjb25zdCB2YWx1ZSBvZiB0aGlzLmF0dHJpYnV0ZS52YWx1ZXMgPz8gW10pIHtcbiAgICAgIGxldCBhdHRyaWJ1dGVDaGVja0JveEZvcm07XG5cbiAgICAgIGlmICh2YWx1ZS5zZWxlY3RlZCkge1xuICAgICAgICBhdHRyaWJ1dGVDaGVja0JveEZvcm0gPSBuZXcgVW50eXBlZEZvcm1Db250cm9sKHtcbiAgICAgICAgICB2YWx1ZTogdHJ1ZSxcbiAgICAgICAgICBkaXNhYmxlZDogZGlzYWJsZWQsXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXR0cmlidXRlQ2hlY2tCb3hGb3JtID0gbmV3IFVudHlwZWRGb3JtQ29udHJvbChmYWxzZSk7XG4gICAgICB9XG4gICAgICB0aGlzLmF0dHJpYnV0ZUNoZWNrQm94Rm9ybXMucHVzaChhdHRyaWJ1dGVDaGVja0JveEZvcm0pO1xuICAgIH1cbiAgfVxuXG4gIGdldCBhbGxvd1plcm9WYWx1ZVF1YW50aXR5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnF1YW50aXR5U2VydmljZS5hbGxvd1plcm9WYWx1ZVF1YW50aXR5KHRoaXMuYXR0cmlidXRlKTtcbiAgfVxuXG4gIG9uU2VsZWN0KCk6IHZvaWQge1xuICAgIGNvbnN0IHNlbGVjdGVkVmFsdWVzID1cbiAgICAgIHRoaXMuY29uZmlnVXRpbHNTZXJ2aWNlLmFzc2VtYmxlVmFsdWVzRm9yTXVsdGlTZWxlY3RBdHRyaWJ1dGVzKFxuICAgICAgICB0aGlzLmF0dHJpYnV0ZUNoZWNrQm94Rm9ybXMsXG4gICAgICAgIHRoaXMuYXR0cmlidXRlXG4gICAgICApO1xuXG4gICAgY29uc3QgZXZlbnQ6IENvbmZpZ0Zvcm1VcGRhdGVFdmVudCA9IHtcbiAgICAgIGNoYW5nZWRBdHRyaWJ1dGU6IHtcbiAgICAgICAgLi4udGhpcy5hdHRyaWJ1dGUsXG4gICAgICAgIHZhbHVlczogc2VsZWN0ZWRWYWx1ZXMsXG4gICAgICB9LFxuICAgICAgb3duZXJLZXk6IHRoaXMub3duZXJLZXksXG4gICAgICB1cGRhdGVUeXBlOiBDb25maWd1cmF0b3IuVXBkYXRlVHlwZS5BVFRSSUJVVEUsXG4gICAgfTtcblxuICAgIHRoaXMuc2VsZWN0aW9uQ2hhbmdlLmVtaXQoZXZlbnQpO1xuICB9XG5cbiAgb25DaGFuZ2VWYWx1ZVF1YW50aXR5KFxuICAgIGV2ZW50T2JqZWN0OiBhbnksXG4gICAgdmFsdWVDb2RlOiBzdHJpbmcsXG4gICAgZm9ybUluZGV4OiBudW1iZXJcbiAgKTogdm9pZCB7XG4gICAgaWYgKGV2ZW50T2JqZWN0ID09PSAwKSB7XG4gICAgICB0aGlzLmF0dHJpYnV0ZUNoZWNrQm94Rm9ybXNbZm9ybUluZGV4XS5zZXRWYWx1ZShmYWxzZSk7XG4gICAgICB0aGlzLm9uU2VsZWN0KCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgdmFsdWU6IENvbmZpZ3VyYXRvci5WYWx1ZSB8IHVuZGVmaW5lZCA9IHRoaXMuY29uZmlnVXRpbHNTZXJ2aWNlXG4gICAgICAuYXNzZW1ibGVWYWx1ZXNGb3JNdWx0aVNlbGVjdEF0dHJpYnV0ZXMoXG4gICAgICAgIHRoaXMuYXR0cmlidXRlQ2hlY2tCb3hGb3JtcyxcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVcbiAgICAgIClcbiAgICAgIC5maW5kKChpdGVtKSA9PiBpdGVtLnZhbHVlQ29kZSA9PT0gdmFsdWVDb2RlKTtcblxuICAgIGlmICghdmFsdWUpIHtcbiAgICAgIGlmIChpc0Rldk1vZGUoKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ25vIHZhbHVlIGZvciBldmVudDonLCBldmVudE9iamVjdCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YWx1ZS5xdWFudGl0eSA9IGV2ZW50T2JqZWN0O1xuXG4gICAgY29uc3QgZXZlbnQ6IENvbmZpZ0Zvcm1VcGRhdGVFdmVudCA9IHtcbiAgICAgIGNoYW5nZWRBdHRyaWJ1dGU6IHtcbiAgICAgICAgLi4udGhpcy5hdHRyaWJ1dGUsXG4gICAgICAgIHZhbHVlczogW3ZhbHVlXSxcbiAgICAgIH0sXG4gICAgICBvd25lcktleTogdGhpcy5vd25lcktleSxcbiAgICAgIHVwZGF0ZVR5cGU6IENvbmZpZ3VyYXRvci5VcGRhdGVUeXBlLlZBTFVFX1FVQU5USVRZLFxuICAgIH07XG5cbiAgICB0aGlzLnNlbGVjdGlvbkNoYW5nZS5lbWl0KGV2ZW50KTtcbiAgfVxuXG4gIG9uQ2hhbmdlUXVhbnRpdHkoZXZlbnRPYmplY3Q6IGFueSk6IHZvaWQge1xuICAgIGlmICghZXZlbnRPYmplY3QpIHtcbiAgICAgIHRoaXMuYXR0cmlidXRlQ2hlY2tCb3hGb3Jtcy5mb3JFYWNoKChfLCBpbmRleCkgPT5cbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVDaGVja0JveEZvcm1zW2luZGV4XS5zZXRWYWx1ZShmYWxzZSlcbiAgICAgICk7XG4gICAgICB0aGlzLm9uU2VsZWN0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub25IYW5kbGVBdHRyaWJ1dGVRdWFudGl0eShldmVudE9iamVjdCk7XG4gICAgfVxuICB9XG59XG4iLCI8ZmllbGRzZXQ+XG4gIDxsZWdlbmQgc3R5bGU9XCJkaXNwbGF5OiBub25lXCI+e3sgYXR0cmlidXRlLmxhYmVsIH19PC9sZWdlbmQ+XG4gIDxkaXYgaWQ9XCJ7eyBjcmVhdGVBdHRyaWJ1dGVJZEZvckNvbmZpZ3VyYXRvcihhdHRyaWJ1dGUpIH19XCI+XG4gICAgPGRpdlxuICAgICAgKm5nSWY9XCJ3aXRoUXVhbnRpdHlPbkF0dHJpYnV0ZUxldmVsXCJcbiAgICAgIGNsYXNzPVwiY3gtYXR0cmlidXRlLWxldmVsLXF1YW50aXR5LXByaWNlXCJcbiAgICA+XG4gICAgICA8Y3gtY29uZmlndXJhdG9yLWF0dHJpYnV0ZS1xdWFudGl0eVxuICAgICAgICAoY2hhbmdlUXVhbnRpdHkpPVwib25DaGFuZ2VRdWFudGl0eSgkZXZlbnQpXCJcbiAgICAgICAgW3F1YW50aXR5T3B0aW9uc109XCJcbiAgICAgICAgICBleHRyYWN0UXVhbnRpdHlQYXJhbWV0ZXJzKGF0dHJpYnV0ZS5xdWFudGl0eSwgIWF0dHJpYnV0ZS5yZXF1aXJlZClcbiAgICAgICAgXCJcbiAgICAgID48L2N4LWNvbmZpZ3VyYXRvci1hdHRyaWJ1dGUtcXVhbnRpdHk+XG4gICAgICA8Y3gtY29uZmlndXJhdG9yLXByaWNlXG4gICAgICAgIFtmb3JtdWxhXT1cImV4dHJhY3RQcmljZUZvcm11bGFQYXJhbWV0ZXJzKClcIlxuICAgICAgPjwvY3gtY29uZmlndXJhdG9yLXByaWNlPlxuICAgIDwvZGl2PlxuICAgIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IHZhbHVlIG9mIGF0dHJpYnV0ZS52YWx1ZXM7IGxldCBpID0gaW5kZXhcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWNoZWNrXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJjeC12YWx1ZS1sYWJlbC1wYWlyXCI+XG4gICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICBpZD1cInt7XG4gICAgICAgICAgICAgIGNyZWF0ZUF0dHJpYnV0ZVZhbHVlSWRGb3JDb25maWd1cmF0b3IoYXR0cmlidXRlLCB2YWx1ZS52YWx1ZUNvZGUpXG4gICAgICAgICAgICB9fVwiXG4gICAgICAgICAgICB0eXBlPVwiY2hlY2tib3hcIlxuICAgICAgICAgICAgY2xhc3M9XCJmb3JtLWNoZWNrLWlucHV0XCJcbiAgICAgICAgICAgIFtjeEZvY3VzXT1cInsga2V5OiBhdHRyaWJ1dGUubmFtZSArICctJyArIHZhbHVlLm5hbWUgfVwiXG4gICAgICAgICAgICBbdmFsdWVdPVwidmFsdWUudmFsdWVDb2RlXCJcbiAgICAgICAgICAgIChjaGFuZ2UpPVwib25TZWxlY3QoKVwiXG4gICAgICAgICAgICBbZm9ybUNvbnRyb2xdPVwiYXR0cmlidXRlQ2hlY2tCb3hGb3Jtc1tpXVwiXG4gICAgICAgICAgICBuYW1lPVwie3sgY3JlYXRlQXR0cmlidXRlSWRGb3JDb25maWd1cmF0b3IoYXR0cmlidXRlKSB9fVwiXG4gICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cIlxuICAgICAgICAgICAgICB2YWx1ZS52YWx1ZVByaWNlICYmIHZhbHVlLnZhbHVlUHJpY2U/LnZhbHVlICE9PSAwXG4gICAgICAgICAgICAgICAgPyB2YWx1ZS52YWx1ZVByaWNlVG90YWwgJiYgdmFsdWUudmFsdWVQcmljZVRvdGFsPy52YWx1ZSAhPT0gMFxuICAgICAgICAgICAgICAgICAgPyAoJ2NvbmZpZ3VyYXRvci5hMTF5LnZhbHVlT2ZBdHRyaWJ1dGVGdWxsV2l0aFByaWNlJ1xuICAgICAgICAgICAgICAgICAgICB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZS52YWx1ZURpc3BsYXksXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZTogYXR0cmlidXRlLmxhYmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZTogdmFsdWUudmFsdWVQcmljZVRvdGFsLmZvcm1hdHRlZFZhbHVlXG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgOiAoJ2NvbmZpZ3VyYXRvci5hMTF5LnZhbHVlT2ZBdHRyaWJ1dGVGdWxsV2l0aFByaWNlJ1xuICAgICAgICAgICAgICAgICAgICB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZS52YWx1ZURpc3BsYXksXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZTogYXR0cmlidXRlLmxhYmVsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBwcmljZTogdmFsdWUudmFsdWVQcmljZS5mb3JtYXR0ZWRWYWx1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICA6ICgnY29uZmlndXJhdG9yLmExMXkudmFsdWVPZkF0dHJpYnV0ZUZ1bGwnXG4gICAgICAgICAgICAgICAgICB8IGN4VHJhbnNsYXRlXG4gICAgICAgICAgICAgICAgICAgIDogeyB2YWx1ZTogdmFsdWUudmFsdWVEaXNwbGF5LCBhdHRyaWJ1dGU6IGF0dHJpYnV0ZS5sYWJlbCB9KVxuICAgICAgICAgICAgXCJcbiAgICAgICAgICAgIFthdHRyLmFyaWEtZGVzY3JpYmVkYnldPVwiXG4gICAgICAgICAgICAgIGNyZWF0ZUF0dHJpYnV0ZVVpS2V5KCdsYWJlbCcsIGF0dHJpYnV0ZS5uYW1lKVxuICAgICAgICAgICAgXCJcbiAgICAgICAgICAvPlxuICAgICAgICAgIDxsYWJlbFxuICAgICAgICAgICAgaWQ9XCJ7e1xuICAgICAgICAgICAgICBjcmVhdGVWYWx1ZVVpS2V5KCdsYWJlbCcsIGF0dHJpYnV0ZS5uYW1lLCB2YWx1ZS52YWx1ZUNvZGUpXG4gICAgICAgICAgICB9fVwiXG4gICAgICAgICAgICBmb3I9XCJ7e1xuICAgICAgICAgICAgICBjcmVhdGVBdHRyaWJ1dGVWYWx1ZUlkRm9yQ29uZmlndXJhdG9yKGF0dHJpYnV0ZSwgdmFsdWUudmFsdWVDb2RlKVxuICAgICAgICAgICAgfX1cIlxuICAgICAgICAgICAgYXJpYS1oaWRkZW49XCJ0cnVlXCJcbiAgICAgICAgICAgIGNsYXNzPVwiY3gtY29uZmlndXJhdG9yLWF0dHJpYnV0ZS12YWx1ZS1sYWJlbCBmb3JtLWNoZWNrLWxhYmVsXCJcbiAgICAgICAgICAgID57eyB2YWx1ZS52YWx1ZURpc3BsYXkgfX08L2xhYmVsXG4gICAgICAgICAgPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImN4LXZhbHVlLXByaWNlXCI+XG4gICAgICAgICAgPGN4LWNvbmZpZ3VyYXRvci1wcmljZVxuICAgICAgICAgICAgW2Zvcm11bGFdPVwiZXh0cmFjdFZhbHVlUHJpY2VGb3JtdWxhUGFyYW1ldGVycyh2YWx1ZSlcIlxuICAgICAgICAgID48L2N4LWNvbmZpZ3VyYXRvci1wcmljZT5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxjeC1jb25maWd1cmF0b3ItYXR0cmlidXRlLXF1YW50aXR5XG4gICAgICAgICpuZ0lmPVwidmFsdWUuc2VsZWN0ZWQgJiYgd2l0aFF1YW50aXR5ICYmICF3aXRoUXVhbnRpdHlPbkF0dHJpYnV0ZUxldmVsXCJcbiAgICAgICAgKGNoYW5nZVF1YW50aXR5KT1cIm9uQ2hhbmdlVmFsdWVRdWFudGl0eSgkZXZlbnQsIHZhbHVlLnZhbHVlQ29kZSwgaSlcIlxuICAgICAgICBbcXVhbnRpdHlPcHRpb25zXT1cIlxuICAgICAgICAgIGV4dHJhY3RRdWFudGl0eVBhcmFtZXRlcnModmFsdWUucXVhbnRpdHksIGFsbG93WmVyb1ZhbHVlUXVhbnRpdHkpXG4gICAgICAgIFwiXG4gICAgICA+PC9jeC1jb25maWd1cmF0b3ItYXR0cmlidXRlLXF1YW50aXR5PlxuICAgIDwvbmctY29udGFpbmVyPlxuICA8L2Rpdj5cbjwvZmllbGRzZXQ+XG4iXX0=