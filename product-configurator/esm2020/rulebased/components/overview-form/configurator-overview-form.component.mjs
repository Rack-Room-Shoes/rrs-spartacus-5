/*
 * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { ChangeDetectionStrategy, Component } from '@angular/core';
import { distinctUntilKeyChanged, filter, switchMap } from 'rxjs/operators';
import { Configurator } from '../../core/model/configurator.model';
import * as i0 from "@angular/core";
import * as i1 from "../../core/facade/configurator-commons.service";
import * as i2 from "@spartacus/product-configurator/common";
import * as i3 from "@angular/common";
import * as i4 from "../overview-attribute/configurator-overview-attribute.component";
import * as i5 from "../overview-bundle-attribute/configurator-overview-bundle-attribute.component";
import * as i6 from "@spartacus/core";
export class ConfiguratorOverviewFormComponent {
    constructor(configuratorCommonsService, configRouterExtractorService) {
        this.configuratorCommonsService = configuratorCommonsService;
        this.configRouterExtractorService = configRouterExtractorService;
        this.attributeOverviewType = Configurator.AttributeOverviewType;
        this.configuration$ = this.configRouterExtractorService.extractRouterData().pipe(switchMap((routerData) => this.configuratorCommonsService.getOrCreateConfiguration(routerData.owner)), distinctUntilKeyChanged('configId'), switchMap((configuration) => this.configuratorCommonsService.getConfigurationWithOverview(configuration)), filter((configuration) => configuration.overview != null));
    }
    /**
     * Does the configuration contain any selected attribute values?
     * @param {Configurator.Configuration} configuration - Current configuration
     * @returns {boolean} - Any attributes available
     */
    hasAttributes(configuration) {
        return (configuration.overview?.groups?.find((group) => group.attributes ? group.attributes.length : 0 > 0) !== undefined);
    }
    /**
     * Verifies whether the next or the previous attributes are same.
     *
     * @param {Configurator.AttributeOverview[]} attributes - Attribute array
     * @param {number} index - Index of the attribute in the array
     * @return {boolean} - 'True' if it is the same attribute, otherwise 'false'
     */
    isSameAttribute(attributes, index) {
        if (attributes.length > 1) {
            if (index === 0) {
                return (attributes[index]?.attribute === attributes[index + 1]?.attribute);
            }
            else {
                return (attributes[index]?.attribute === attributes[index - 1]?.attribute);
            }
        }
        return false;
    }
    /**
     * Retrieves the styling for the corresponding element.
     *
     * @param {Configurator.AttributeOverview[]} attributes - Attribute array
     * @param {number} index - Index of the attribute in the array
     * @return {string} - corresponding style class
     */
    getStyleClasses(attributes, index) {
        let styleClass = '';
        switch (attributes[index]?.type) {
            case this.attributeOverviewType.BUNDLE:
                styleClass += 'bundle';
                break;
            case this.attributeOverviewType.GENERAL:
                styleClass += 'general';
                break;
        }
        if (index === 0 || !this.isSameAttribute(attributes, index)) {
            styleClass += ' margin';
        }
        if (!this.isSameAttribute(attributes, index + 1) &&
            !styleClass.includes('bundle')) {
            styleClass += ' last-value-pair';
        }
        return styleClass;
    }
}
ConfiguratorOverviewFormComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: ConfiguratorOverviewFormComponent, deps: [{ token: i1.ConfiguratorCommonsService }, { token: i2.ConfiguratorRouterExtractorService }], target: i0.ɵɵFactoryTarget.Component });
ConfiguratorOverviewFormComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "14.2.3", type: ConfiguratorOverviewFormComponent, selector: "cx-configurator-overview-form", ngImport: i0, template: "<ng-container *ngIf=\"configuration$ | async as configuration; else ghostForm\">\n  <ng-container *ngIf=\"hasAttributes(configuration); else noAttributes\">\n    <ng-container\n      *ngTemplateOutlet=\"\n        groups;\n        context: {\n          overviewGroups: configuration.overview.groups,\n          level: 1\n        }\n      \"\n    ></ng-container>\n  </ng-container>\n</ng-container>\n\n<ng-template #noAttributes>\n  <div class=\"cx-no-attribute-value-pairs\">\n    <!-- We currently do not support filtering on overview page so this should never be displayed -->\n    <h2>{{ 'configurator.overviewForm.noAttributeHeader' | cxTranslate }}</h2>\n    <p>{{ 'configurator.overviewForm.noAttributeText' | cxTranslate }}</p>\n  </div>\n</ng-template>\n\n<ng-template #groups let-overviewGroups=\"overviewGroups\" let-level=\"level\">\n  <span class=\"cx-visually-hidden\">\n    {{ 'configurator.a11y.listOfAttributesAndValues' | cxTranslate }}\n  </span>\n  <ng-container *ngFor=\"let group of overviewGroups\">\n    <div\n      class=\"cx-group\"\n      [class.topLevel]=\"level === 1\"\n      [class.subgroupTopLevel]=\"level === 1 && group.subGroups?.length > 0\"\n    >\n      <span class=\"cx-visually-hidden\">\n        {{\n          'configurator.a11y.group'\n            | cxTranslate\n              : {\n                  group: group.groupDescription\n                }\n        }}\n      </span>\n      <h2 aria-hidden=\"true\">\n        <span>{{ group.groupDescription }}</span>\n      </h2>\n\n      <div\n        *ngFor=\"let attributeOverview of group.attributes; let i = index\"\n        class=\"cx-attribute-value-pair\"\n        [ngClass]=\"getStyleClasses(group.attributes, i)\"\n      >\n        <ng-container [ngSwitch]=\"attributeOverview?.type\">\n          <ng-container *ngSwitchCase=\"attributeOverviewType.GENERAL\">\n            <cx-configurator-overview-attribute\n              [attributeOverview]=\"attributeOverview\"\n            >\n            </cx-configurator-overview-attribute>\n          </ng-container>\n\n          <ng-container *ngSwitchCase=\"attributeOverviewType.BUNDLE\">\n            <cx-configurator-cpq-overview-attribute\n              [attributeOverview]=\"attributeOverview\"\n            >\n            </cx-configurator-cpq-overview-attribute>\n          </ng-container>\n\n          <ng-container *ngSwitchDefault>\n            <cx-configurator-overview-attribute\n              [attributeOverview]=\"attributeOverview\"\n            >\n            </cx-configurator-overview-attribute>\n          </ng-container>\n        </ng-container>\n      </div>\n    </div>\n    <ng-container *ngIf=\"group.subGroups?.length > 0\">\n      <ng-container\n        *ngTemplateOutlet=\"\n          groups;\n          context: { overviewGroups: group.subGroups, level: level + 1 }\n        \"\n      ></ng-container>\n    </ng-container>\n  </ng-container>\n</ng-template>\n\n<ng-template #ghostForm>\n  <ng-container *ngFor=\"let number of [0, 1, 2]\">\n    <div class=\"cx-ghost-group\">\n      <div class=\"cx-ghost-header ghost\"></div>\n      <div class=\"cx-ghost-body\">\n        <ng-container *ngFor=\"let number of [0, 1, 2, 3, 4, 5]\">\n          <div class=\"cx-ghost-attribute-value\">\n            <div class=\"cx-ghost-value ghost\"></div>\n          </div>\n          <div class=\"cx-ghost-attribute-label\">\n            <div class=\"cx-ghost-label ghost\"></div>\n          </div>\n          <div class=\"cx-ghost-attribute-price ghost\"></div>\n        </ng-container>\n      </div>\n    </div>\n  </ng-container>\n</ng-template>\n", dependencies: [{ kind: "directive", type: i3.NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: i3.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i3.NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }, { kind: "directive", type: i3.NgSwitch, selector: "[ngSwitch]", inputs: ["ngSwitch"] }, { kind: "directive", type: i3.NgSwitchCase, selector: "[ngSwitchCase]", inputs: ["ngSwitchCase"] }, { kind: "directive", type: i3.NgSwitchDefault, selector: "[ngSwitchDefault]" }, { kind: "component", type: i4.ConfiguratorOverviewAttributeComponent, selector: "cx-configurator-overview-attribute", inputs: ["attributeOverview"] }, { kind: "component", type: i5.ConfiguratorOverviewBundleAttributeComponent, selector: "cx-configurator-cpq-overview-attribute", inputs: ["attributeOverview"] }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }, { kind: "pipe", type: i6.TranslatePipe, name: "cxTranslate" }], changeDetection: i0.ChangeDetectionStrategy.OnPush });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: ConfiguratorOverviewFormComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cx-configurator-overview-form', changeDetection: ChangeDetectionStrategy.OnPush, template: "<ng-container *ngIf=\"configuration$ | async as configuration; else ghostForm\">\n  <ng-container *ngIf=\"hasAttributes(configuration); else noAttributes\">\n    <ng-container\n      *ngTemplateOutlet=\"\n        groups;\n        context: {\n          overviewGroups: configuration.overview.groups,\n          level: 1\n        }\n      \"\n    ></ng-container>\n  </ng-container>\n</ng-container>\n\n<ng-template #noAttributes>\n  <div class=\"cx-no-attribute-value-pairs\">\n    <!-- We currently do not support filtering on overview page so this should never be displayed -->\n    <h2>{{ 'configurator.overviewForm.noAttributeHeader' | cxTranslate }}</h2>\n    <p>{{ 'configurator.overviewForm.noAttributeText' | cxTranslate }}</p>\n  </div>\n</ng-template>\n\n<ng-template #groups let-overviewGroups=\"overviewGroups\" let-level=\"level\">\n  <span class=\"cx-visually-hidden\">\n    {{ 'configurator.a11y.listOfAttributesAndValues' | cxTranslate }}\n  </span>\n  <ng-container *ngFor=\"let group of overviewGroups\">\n    <div\n      class=\"cx-group\"\n      [class.topLevel]=\"level === 1\"\n      [class.subgroupTopLevel]=\"level === 1 && group.subGroups?.length > 0\"\n    >\n      <span class=\"cx-visually-hidden\">\n        {{\n          'configurator.a11y.group'\n            | cxTranslate\n              : {\n                  group: group.groupDescription\n                }\n        }}\n      </span>\n      <h2 aria-hidden=\"true\">\n        <span>{{ group.groupDescription }}</span>\n      </h2>\n\n      <div\n        *ngFor=\"let attributeOverview of group.attributes; let i = index\"\n        class=\"cx-attribute-value-pair\"\n        [ngClass]=\"getStyleClasses(group.attributes, i)\"\n      >\n        <ng-container [ngSwitch]=\"attributeOverview?.type\">\n          <ng-container *ngSwitchCase=\"attributeOverviewType.GENERAL\">\n            <cx-configurator-overview-attribute\n              [attributeOverview]=\"attributeOverview\"\n            >\n            </cx-configurator-overview-attribute>\n          </ng-container>\n\n          <ng-container *ngSwitchCase=\"attributeOverviewType.BUNDLE\">\n            <cx-configurator-cpq-overview-attribute\n              [attributeOverview]=\"attributeOverview\"\n            >\n            </cx-configurator-cpq-overview-attribute>\n          </ng-container>\n\n          <ng-container *ngSwitchDefault>\n            <cx-configurator-overview-attribute\n              [attributeOverview]=\"attributeOverview\"\n            >\n            </cx-configurator-overview-attribute>\n          </ng-container>\n        </ng-container>\n      </div>\n    </div>\n    <ng-container *ngIf=\"group.subGroups?.length > 0\">\n      <ng-container\n        *ngTemplateOutlet=\"\n          groups;\n          context: { overviewGroups: group.subGroups, level: level + 1 }\n        \"\n      ></ng-container>\n    </ng-container>\n  </ng-container>\n</ng-template>\n\n<ng-template #ghostForm>\n  <ng-container *ngFor=\"let number of [0, 1, 2]\">\n    <div class=\"cx-ghost-group\">\n      <div class=\"cx-ghost-header ghost\"></div>\n      <div class=\"cx-ghost-body\">\n        <ng-container *ngFor=\"let number of [0, 1, 2, 3, 4, 5]\">\n          <div class=\"cx-ghost-attribute-value\">\n            <div class=\"cx-ghost-value ghost\"></div>\n          </div>\n          <div class=\"cx-ghost-attribute-label\">\n            <div class=\"cx-ghost-label ghost\"></div>\n          </div>\n          <div class=\"cx-ghost-attribute-price ghost\"></div>\n        </ng-container>\n      </div>\n    </div>\n  </ng-container>\n</ng-template>\n" }]
        }], ctorParameters: function () { return [{ type: i1.ConfiguratorCommonsService }, { type: i2.ConfiguratorRouterExtractorService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJhdG9yLW92ZXJ2aWV3LWZvcm0uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL292ZXJ2aWV3LWZvcm0vY29uZmlndXJhdG9yLW92ZXJ2aWV3LWZvcm0uY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jb21wb25lbnRzL292ZXJ2aWV3LWZvcm0vY29uZmlndXJhdG9yLW92ZXJ2aWV3LWZvcm0uY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7R0FJRztBQUVILE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFHbkUsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUU1RSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUNBQXFDLENBQUM7Ozs7Ozs7O0FBT25FLE1BQU0sT0FBTyxpQ0FBaUM7SUFtQjVDLFlBQ1ksMEJBQXNELEVBQ3RELDRCQUFnRTtRQURoRSwrQkFBMEIsR0FBMUIsMEJBQTBCLENBQTRCO1FBQ3RELGlDQUE0QixHQUE1Qiw0QkFBNEIsQ0FBb0M7UUFwQjVFLDBCQUFxQixHQUFHLFlBQVksQ0FBQyxxQkFBcUIsQ0FBQztRQUUzRCxtQkFBYyxHQUNaLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLElBQUksQ0FDeEQsU0FBUyxDQUFDLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FDdkIsSUFBSSxDQUFDLDBCQUEwQixDQUFDLHdCQUF3QixDQUN0RCxVQUFVLENBQUMsS0FBSyxDQUNqQixDQUNGLEVBQ0QsdUJBQXVCLENBQUMsVUFBVSxDQUFDLEVBQ25DLFNBQVMsQ0FBQyxDQUFDLGFBQWEsRUFBRSxFQUFFLENBQzFCLElBQUksQ0FBQywwQkFBMEIsQ0FBQyw0QkFBNEIsQ0FDMUQsYUFBYSxDQUNkLENBQ0YsRUFDRCxNQUFNLENBQUMsQ0FBQyxhQUFhLEVBQUUsRUFBRSxDQUFDLGFBQWEsQ0FBQyxRQUFRLElBQUksSUFBSSxDQUFDLENBQzFELENBQUM7SUFLRCxDQUFDO0lBRUo7Ozs7T0FJRztJQUNILGFBQWEsQ0FBQyxhQUF5QztRQUNyRCxPQUFPLENBQ0wsYUFBYSxDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FDN0MsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQ25ELEtBQUssU0FBUyxDQUNoQixDQUFDO0lBQ0osQ0FBQztJQUVEOzs7Ozs7T0FNRztJQUNILGVBQWUsQ0FDYixVQUE0QyxFQUM1QyxLQUFhO1FBRWIsSUFBSSxVQUFVLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUN6QixJQUFJLEtBQUssS0FBSyxDQUFDLEVBQUU7Z0JBQ2YsT0FBTyxDQUNMLFVBQVUsQ0FBQyxLQUFLLENBQUMsRUFBRSxTQUFTLEtBQUssVUFBVSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsRUFBRSxTQUFTLENBQ2xFLENBQUM7YUFDSDtpQkFBTTtnQkFDTCxPQUFPLENBQ0wsVUFBVSxDQUFDLEtBQUssQ0FBQyxFQUFFLFNBQVMsS0FBSyxVQUFVLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxFQUFFLFNBQVMsQ0FDbEUsQ0FBQzthQUNIO1NBQ0Y7UUFDRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSCxlQUFlLENBQ2IsVUFBNEMsRUFDNUMsS0FBYTtRQUViLElBQUksVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUVwQixRQUFRLFVBQVUsQ0FBQyxLQUFLLENBQUMsRUFBRSxJQUFJLEVBQUU7WUFDL0IsS0FBSyxJQUFJLENBQUMscUJBQXFCLENBQUMsTUFBTTtnQkFDcEMsVUFBVSxJQUFJLFFBQVEsQ0FBQztnQkFDdkIsTUFBTTtZQUNSLEtBQUssSUFBSSxDQUFDLHFCQUFxQixDQUFDLE9BQU87Z0JBQ3JDLFVBQVUsSUFBSSxTQUFTLENBQUM7Z0JBQ3hCLE1BQU07U0FDVDtRQUVELElBQUksS0FBSyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxFQUFFO1lBQzNELFVBQVUsSUFBSSxTQUFTLENBQUM7U0FDekI7UUFFRCxJQUNFLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxVQUFVLEVBQUUsS0FBSyxHQUFHLENBQUMsQ0FBQztZQUM1QyxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQzlCO1lBQ0EsVUFBVSxJQUFJLGtCQUFrQixDQUFDO1NBQ2xDO1FBRUQsT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQzs7OEhBaEdVLGlDQUFpQztrSEFBakMsaUNBQWlDLHFFQ2xCOUMsa2hIQXVHQTsyRkRyRmEsaUNBQWlDO2tCQUw3QyxTQUFTOytCQUNFLCtCQUErQixtQkFFeEIsdUJBQXVCLENBQUMsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIyIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvclJvdXRlckV4dHJhY3RvclNlcnZpY2UgfSBmcm9tICdAc3BhcnRhY3VzL3Byb2R1Y3QtY29uZmlndXJhdG9yL2NvbW1vbic7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBkaXN0aW5jdFVudGlsS2V5Q2hhbmdlZCwgZmlsdGVyLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3JDb21tb25zU2VydmljZSB9IGZyb20gJy4uLy4uL2NvcmUvZmFjYWRlL2NvbmZpZ3VyYXRvci1jb21tb25zLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yIH0gZnJvbSAnLi4vLi4vY29yZS9tb2RlbC9jb25maWd1cmF0b3IubW9kZWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjeC1jb25maWd1cmF0b3Itb3ZlcnZpZXctZm9ybScsXG4gIHRlbXBsYXRlVXJsOiAnLi9jb25maWd1cmF0b3Itb3ZlcnZpZXctZm9ybS5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBDb25maWd1cmF0b3JPdmVydmlld0Zvcm1Db21wb25lbnQge1xuICBhdHRyaWJ1dGVPdmVydmlld1R5cGUgPSBDb25maWd1cmF0b3IuQXR0cmlidXRlT3ZlcnZpZXdUeXBlO1xuXG4gIGNvbmZpZ3VyYXRpb24kOiBPYnNlcnZhYmxlPENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uPiA9XG4gICAgdGhpcy5jb25maWdSb3V0ZXJFeHRyYWN0b3JTZXJ2aWNlLmV4dHJhY3RSb3V0ZXJEYXRhKCkucGlwZShcbiAgICAgIHN3aXRjaE1hcCgocm91dGVyRGF0YSkgPT5cbiAgICAgICAgdGhpcy5jb25maWd1cmF0b3JDb21tb25zU2VydmljZS5nZXRPckNyZWF0ZUNvbmZpZ3VyYXRpb24oXG4gICAgICAgICAgcm91dGVyRGF0YS5vd25lclxuICAgICAgICApXG4gICAgICApLFxuICAgICAgZGlzdGluY3RVbnRpbEtleUNoYW5nZWQoJ2NvbmZpZ0lkJyksXG4gICAgICBzd2l0Y2hNYXAoKGNvbmZpZ3VyYXRpb24pID0+XG4gICAgICAgIHRoaXMuY29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2UuZ2V0Q29uZmlndXJhdGlvbldpdGhPdmVydmlldyhcbiAgICAgICAgICBjb25maWd1cmF0aW9uXG4gICAgICAgIClcbiAgICAgICksXG4gICAgICBmaWx0ZXIoKGNvbmZpZ3VyYXRpb24pID0+IGNvbmZpZ3VyYXRpb24ub3ZlcnZpZXcgIT0gbnVsbClcbiAgICApO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByb3RlY3RlZCBjb25maWd1cmF0b3JDb21tb25zU2VydmljZTogQ29uZmlndXJhdG9yQ29tbW9uc1NlcnZpY2UsXG4gICAgcHJvdGVjdGVkIGNvbmZpZ1JvdXRlckV4dHJhY3RvclNlcnZpY2U6IENvbmZpZ3VyYXRvclJvdXRlckV4dHJhY3RvclNlcnZpY2VcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBEb2VzIHRoZSBjb25maWd1cmF0aW9uIGNvbnRhaW4gYW55IHNlbGVjdGVkIGF0dHJpYnV0ZSB2YWx1ZXM/XG4gICAqIEBwYXJhbSB7Q29uZmlndXJhdG9yLkNvbmZpZ3VyYXRpb259IGNvbmZpZ3VyYXRpb24gLSBDdXJyZW50IGNvbmZpZ3VyYXRpb25cbiAgICogQHJldHVybnMge2Jvb2xlYW59IC0gQW55IGF0dHJpYnV0ZXMgYXZhaWxhYmxlXG4gICAqL1xuICBoYXNBdHRyaWJ1dGVzKGNvbmZpZ3VyYXRpb246IENvbmZpZ3VyYXRvci5Db25maWd1cmF0aW9uKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgIGNvbmZpZ3VyYXRpb24ub3ZlcnZpZXc/Lmdyb3Vwcz8uZmluZCgoZ3JvdXApID0+XG4gICAgICAgIGdyb3VwLmF0dHJpYnV0ZXMgPyBncm91cC5hdHRyaWJ1dGVzLmxlbmd0aCA6IDAgPiAwXG4gICAgICApICE9PSB1bmRlZmluZWRcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWVzIHdoZXRoZXIgdGhlIG5leHQgb3IgdGhlIHByZXZpb3VzIGF0dHJpYnV0ZXMgYXJlIHNhbWUuXG4gICAqXG4gICAqIEBwYXJhbSB7Q29uZmlndXJhdG9yLkF0dHJpYnV0ZU92ZXJ2aWV3W119IGF0dHJpYnV0ZXMgLSBBdHRyaWJ1dGUgYXJyYXlcbiAgICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gSW5kZXggb2YgdGhlIGF0dHJpYnV0ZSBpbiB0aGUgYXJyYXlcbiAgICogQHJldHVybiB7Ym9vbGVhbn0gLSAnVHJ1ZScgaWYgaXQgaXMgdGhlIHNhbWUgYXR0cmlidXRlLCBvdGhlcndpc2UgJ2ZhbHNlJ1xuICAgKi9cbiAgaXNTYW1lQXR0cmlidXRlKFxuICAgIGF0dHJpYnV0ZXM6IENvbmZpZ3VyYXRvci5BdHRyaWJ1dGVPdmVydmlld1tdLFxuICAgIGluZGV4OiBudW1iZXJcbiAgKTogYm9vbGVhbiB7XG4gICAgaWYgKGF0dHJpYnV0ZXMubGVuZ3RoID4gMSkge1xuICAgICAgaWYgKGluZGV4ID09PSAwKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgYXR0cmlidXRlc1tpbmRleF0/LmF0dHJpYnV0ZSA9PT0gYXR0cmlidXRlc1tpbmRleCArIDFdPy5hdHRyaWJ1dGVcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgYXR0cmlidXRlc1tpbmRleF0/LmF0dHJpYnV0ZSA9PT0gYXR0cmlidXRlc1tpbmRleCAtIDFdPy5hdHRyaWJ1dGVcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyB0aGUgc3R5bGluZyBmb3IgdGhlIGNvcnJlc3BvbmRpbmcgZWxlbWVudC5cbiAgICpcbiAgICogQHBhcmFtIHtDb25maWd1cmF0b3IuQXR0cmlidXRlT3ZlcnZpZXdbXX0gYXR0cmlidXRlcyAtIEF0dHJpYnV0ZSBhcnJheVxuICAgKiBAcGFyYW0ge251bWJlcn0gaW5kZXggLSBJbmRleCBvZiB0aGUgYXR0cmlidXRlIGluIHRoZSBhcnJheVxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IC0gY29ycmVzcG9uZGluZyBzdHlsZSBjbGFzc1xuICAgKi9cbiAgZ2V0U3R5bGVDbGFzc2VzKFxuICAgIGF0dHJpYnV0ZXM6IENvbmZpZ3VyYXRvci5BdHRyaWJ1dGVPdmVydmlld1tdLFxuICAgIGluZGV4OiBudW1iZXJcbiAgKTogc3RyaW5nIHtcbiAgICBsZXQgc3R5bGVDbGFzcyA9ICcnO1xuXG4gICAgc3dpdGNoIChhdHRyaWJ1dGVzW2luZGV4XT8udHlwZSkge1xuICAgICAgY2FzZSB0aGlzLmF0dHJpYnV0ZU92ZXJ2aWV3VHlwZS5CVU5ETEU6XG4gICAgICAgIHN0eWxlQ2xhc3MgKz0gJ2J1bmRsZSc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSB0aGlzLmF0dHJpYnV0ZU92ZXJ2aWV3VHlwZS5HRU5FUkFMOlxuICAgICAgICBzdHlsZUNsYXNzICs9ICdnZW5lcmFsJztcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgaWYgKGluZGV4ID09PSAwIHx8ICF0aGlzLmlzU2FtZUF0dHJpYnV0ZShhdHRyaWJ1dGVzLCBpbmRleCkpIHtcbiAgICAgIHN0eWxlQ2xhc3MgKz0gJyBtYXJnaW4nO1xuICAgIH1cblxuICAgIGlmIChcbiAgICAgICF0aGlzLmlzU2FtZUF0dHJpYnV0ZShhdHRyaWJ1dGVzLCBpbmRleCArIDEpICYmXG4gICAgICAhc3R5bGVDbGFzcy5pbmNsdWRlcygnYnVuZGxlJylcbiAgICApIHtcbiAgICAgIHN0eWxlQ2xhc3MgKz0gJyBsYXN0LXZhbHVlLXBhaXInO1xuICAgIH1cblxuICAgIHJldHVybiBzdHlsZUNsYXNzO1xuICB9XG59XG4iLCI8bmctY29udGFpbmVyICpuZ0lmPVwiY29uZmlndXJhdGlvbiQgfCBhc3luYyBhcyBjb25maWd1cmF0aW9uOyBlbHNlIGdob3N0Rm9ybVwiPlxuICA8bmctY29udGFpbmVyICpuZ0lmPVwiaGFzQXR0cmlidXRlcyhjb25maWd1cmF0aW9uKTsgZWxzZSBub0F0dHJpYnV0ZXNcIj5cbiAgICA8bmctY29udGFpbmVyXG4gICAgICAqbmdUZW1wbGF0ZU91dGxldD1cIlxuICAgICAgICBncm91cHM7XG4gICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICBvdmVydmlld0dyb3VwczogY29uZmlndXJhdGlvbi5vdmVydmlldy5ncm91cHMsXG4gICAgICAgICAgbGV2ZWw6IDFcbiAgICAgICAgfVxuICAgICAgXCJcbiAgICA+PC9uZy1jb250YWluZXI+XG4gIDwvbmctY29udGFpbmVyPlxuPC9uZy1jb250YWluZXI+XG5cbjxuZy10ZW1wbGF0ZSAjbm9BdHRyaWJ1dGVzPlxuICA8ZGl2IGNsYXNzPVwiY3gtbm8tYXR0cmlidXRlLXZhbHVlLXBhaXJzXCI+XG4gICAgPCEtLSBXZSBjdXJyZW50bHkgZG8gbm90IHN1cHBvcnQgZmlsdGVyaW5nIG9uIG92ZXJ2aWV3IHBhZ2Ugc28gdGhpcyBzaG91bGQgbmV2ZXIgYmUgZGlzcGxheWVkIC0tPlxuICAgIDxoMj57eyAnY29uZmlndXJhdG9yLm92ZXJ2aWV3Rm9ybS5ub0F0dHJpYnV0ZUhlYWRlcicgfCBjeFRyYW5zbGF0ZSB9fTwvaDI+XG4gICAgPHA+e3sgJ2NvbmZpZ3VyYXRvci5vdmVydmlld0Zvcm0ubm9BdHRyaWJ1dGVUZXh0JyB8IGN4VHJhbnNsYXRlIH19PC9wPlxuICA8L2Rpdj5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSAjZ3JvdXBzIGxldC1vdmVydmlld0dyb3Vwcz1cIm92ZXJ2aWV3R3JvdXBzXCIgbGV0LWxldmVsPVwibGV2ZWxcIj5cbiAgPHNwYW4gY2xhc3M9XCJjeC12aXN1YWxseS1oaWRkZW5cIj5cbiAgICB7eyAnY29uZmlndXJhdG9yLmExMXkubGlzdE9mQXR0cmlidXRlc0FuZFZhbHVlcycgfCBjeFRyYW5zbGF0ZSB9fVxuICA8L3NwYW4+XG4gIDxuZy1jb250YWluZXIgKm5nRm9yPVwibGV0IGdyb3VwIG9mIG92ZXJ2aWV3R3JvdXBzXCI+XG4gICAgPGRpdlxuICAgICAgY2xhc3M9XCJjeC1ncm91cFwiXG4gICAgICBbY2xhc3MudG9wTGV2ZWxdPVwibGV2ZWwgPT09IDFcIlxuICAgICAgW2NsYXNzLnN1Ymdyb3VwVG9wTGV2ZWxdPVwibGV2ZWwgPT09IDEgJiYgZ3JvdXAuc3ViR3JvdXBzPy5sZW5ndGggPiAwXCJcbiAgICA+XG4gICAgICA8c3BhbiBjbGFzcz1cImN4LXZpc3VhbGx5LWhpZGRlblwiPlxuICAgICAgICB7e1xuICAgICAgICAgICdjb25maWd1cmF0b3IuYTExeS5ncm91cCdcbiAgICAgICAgICAgIHwgY3hUcmFuc2xhdGVcbiAgICAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICBncm91cDogZ3JvdXAuZ3JvdXBEZXNjcmlwdGlvblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgfX1cbiAgICAgIDwvc3Bhbj5cbiAgICAgIDxoMiBhcmlhLWhpZGRlbj1cInRydWVcIj5cbiAgICAgICAgPHNwYW4+e3sgZ3JvdXAuZ3JvdXBEZXNjcmlwdGlvbiB9fTwvc3Bhbj5cbiAgICAgIDwvaDI+XG5cbiAgICAgIDxkaXZcbiAgICAgICAgKm5nRm9yPVwibGV0IGF0dHJpYnV0ZU92ZXJ2aWV3IG9mIGdyb3VwLmF0dHJpYnV0ZXM7IGxldCBpID0gaW5kZXhcIlxuICAgICAgICBjbGFzcz1cImN4LWF0dHJpYnV0ZS12YWx1ZS1wYWlyXCJcbiAgICAgICAgW25nQ2xhc3NdPVwiZ2V0U3R5bGVDbGFzc2VzKGdyb3VwLmF0dHJpYnV0ZXMsIGkpXCJcbiAgICAgID5cbiAgICAgICAgPG5nLWNvbnRhaW5lciBbbmdTd2l0Y2hdPVwiYXR0cmlidXRlT3ZlcnZpZXc/LnR5cGVcIj5cbiAgICAgICAgICA8bmctY29udGFpbmVyICpuZ1N3aXRjaENhc2U9XCJhdHRyaWJ1dGVPdmVydmlld1R5cGUuR0VORVJBTFwiPlxuICAgICAgICAgICAgPGN4LWNvbmZpZ3VyYXRvci1vdmVydmlldy1hdHRyaWJ1dGVcbiAgICAgICAgICAgICAgW2F0dHJpYnV0ZU92ZXJ2aWV3XT1cImF0dHJpYnV0ZU92ZXJ2aWV3XCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgIDwvY3gtY29uZmlndXJhdG9yLW92ZXJ2aWV3LWF0dHJpYnV0ZT5cbiAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cblxuICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nU3dpdGNoQ2FzZT1cImF0dHJpYnV0ZU92ZXJ2aWV3VHlwZS5CVU5ETEVcIj5cbiAgICAgICAgICAgIDxjeC1jb25maWd1cmF0b3ItY3BxLW92ZXJ2aWV3LWF0dHJpYnV0ZVxuICAgICAgICAgICAgICBbYXR0cmlidXRlT3ZlcnZpZXddPVwiYXR0cmlidXRlT3ZlcnZpZXdcIlxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgPC9jeC1jb25maWd1cmF0b3ItY3BxLW92ZXJ2aWV3LWF0dHJpYnV0ZT5cbiAgICAgICAgICA8L25nLWNvbnRhaW5lcj5cblxuICAgICAgICAgIDxuZy1jb250YWluZXIgKm5nU3dpdGNoRGVmYXVsdD5cbiAgICAgICAgICAgIDxjeC1jb25maWd1cmF0b3Itb3ZlcnZpZXctYXR0cmlidXRlXG4gICAgICAgICAgICAgIFthdHRyaWJ1dGVPdmVydmlld109XCJhdHRyaWJ1dGVPdmVydmlld1wiXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICA8L2N4LWNvbmZpZ3VyYXRvci1vdmVydmlldy1hdHRyaWJ1dGU+XG4gICAgICAgICAgPC9uZy1jb250YWluZXI+XG4gICAgICAgIDwvbmctY29udGFpbmVyPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImdyb3VwLnN1Ykdyb3Vwcz8ubGVuZ3RoID4gMFwiPlxuICAgICAgPG5nLWNvbnRhaW5lclxuICAgICAgICAqbmdUZW1wbGF0ZU91dGxldD1cIlxuICAgICAgICAgIGdyb3VwcztcbiAgICAgICAgICBjb250ZXh0OiB7IG92ZXJ2aWV3R3JvdXBzOiBncm91cC5zdWJHcm91cHMsIGxldmVsOiBsZXZlbCArIDEgfVxuICAgICAgICBcIlxuICAgICAgPjwvbmctY29udGFpbmVyPlxuICAgIDwvbmctY29udGFpbmVyPlxuICA8L25nLWNvbnRhaW5lcj5cbjwvbmctdGVtcGxhdGU+XG5cbjxuZy10ZW1wbGF0ZSAjZ2hvc3RGb3JtPlxuICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCBudW1iZXIgb2YgWzAsIDEsIDJdXCI+XG4gICAgPGRpdiBjbGFzcz1cImN4LWdob3N0LWdyb3VwXCI+XG4gICAgICA8ZGl2IGNsYXNzPVwiY3gtZ2hvc3QtaGVhZGVyIGdob3N0XCI+PC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzPVwiY3gtZ2hvc3QtYm9keVwiPlxuICAgICAgICA8bmctY29udGFpbmVyICpuZ0Zvcj1cImxldCBudW1iZXIgb2YgWzAsIDEsIDIsIDMsIDQsIDVdXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImN4LWdob3N0LWF0dHJpYnV0ZS12YWx1ZVwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImN4LWdob3N0LXZhbHVlIGdob3N0XCI+PC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImN4LWdob3N0LWF0dHJpYnV0ZS1sYWJlbFwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImN4LWdob3N0LWxhYmVsIGdob3N0XCI+PC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImN4LWdob3N0LWF0dHJpYnV0ZS1wcmljZSBnaG9zdFwiPjwvZGl2PlxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICA8L25nLWNvbnRhaW5lcj5cbjwvbmctdGVtcGxhdGU+XG4iXX0=