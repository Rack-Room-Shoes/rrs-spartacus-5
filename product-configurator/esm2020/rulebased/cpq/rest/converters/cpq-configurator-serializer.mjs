/*
 * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { Injectable } from '@angular/core';
import { Configurator } from '@spartacus/product-configurator/rulebased';
import { CpqConfiguratorUtils } from './../cpq-configurator-utils';
import * as i0 from "@angular/core";
const VALUE_SEPARATOR = ',';
export class CpqConfiguratorSerializer {
    convert(source) {
        const attribute = CpqConfiguratorUtils.findFirstChangedAttribute(source);
        let updateAttribute;
        if (source.updateType === Configurator.UpdateType.ATTRIBUTE_QUANTITY) {
            updateAttribute = this.convertQuantity(attribute, source.configId);
        }
        else {
            updateAttribute = this.convertAttribute(attribute, source.configId);
        }
        return updateAttribute;
    }
    convertQuantity(attribute, configId) {
        const updateInformation = CpqConfiguratorUtils.getUpdateInformation(attribute);
        const updateAttribute = {
            configurationId: configId,
            standardAttributeCode: updateInformation.standardAttributeCode,
            changeAttributeValue: { quantity: attribute.quantity },
            tabId: updateInformation.tabId,
        };
        return updateAttribute;
    }
    convertAttribute(attribute, configurationId) {
        const updateInformation = CpqConfiguratorUtils.getUpdateInformation(attribute);
        const updateAttribute = {
            configurationId: configurationId,
            standardAttributeCode: updateInformation.standardAttributeCode,
            changeAttributeValue: {},
            tabId: updateInformation.tabId,
        };
        if (attribute.uiType === Configurator.UiType.DROPDOWN ||
            attribute.uiType === Configurator.UiType.DROPDOWN_PRODUCT ||
            attribute.uiType === Configurator.UiType.RADIOBUTTON ||
            attribute.uiType === Configurator.UiType.RADIOBUTTON_PRODUCT ||
            attribute.uiType === Configurator.UiType.SINGLE_SELECTION_IMAGE) {
            updateAttribute.changeAttributeValue.attributeValueIds =
                this.processSelectedSingleValue(attribute.selectedSingleValue);
        }
        else if (attribute.uiType === Configurator.UiType.CHECKBOXLIST ||
            attribute.uiType === Configurator.UiType.CHECKBOXLIST_PRODUCT ||
            attribute.uiType === Configurator.UiType.CHECKBOX ||
            attribute.uiType === Configurator.UiType.MULTI_SELECTION_IMAGE) {
            updateAttribute.changeAttributeValue.attributeValueIds =
                this.prepareValueIds(attribute);
        }
        else if (attribute.uiType === Configurator.UiType.STRING ||
            attribute.uiType === Configurator.UiType.NUMERIC) {
            updateAttribute.changeAttributeValue.userInput = attribute.userInput;
            if (!updateAttribute.changeAttributeValue?.userInput) {
                updateAttribute.changeAttributeValue.userInput = ' ';
            }
        }
        return updateAttribute;
    }
    processSelectedSingleValue(singleValue) {
        let processedValue = singleValue;
        if (!processedValue) {
            // Is required to remove the value
            processedValue = VALUE_SEPARATOR;
        }
        return processedValue;
    }
    prepareValueIds(attribute) {
        let valueIds = '';
        const selectedValues = attribute.values?.filter((value) => value.selected);
        if (selectedValues && selectedValues.length > 0) {
            selectedValues.forEach((value) => {
                valueIds += value.valueCode + VALUE_SEPARATOR;
            });
        }
        else {
            // Is required to remove the value
            valueIds = VALUE_SEPARATOR;
        }
        return valueIds;
    }
}
CpqConfiguratorSerializer.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: CpqConfiguratorSerializer, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
CpqConfiguratorSerializer.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: CpqConfiguratorSerializer });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: CpqConfiguratorSerializer, decorators: [{
            type: Injectable
        }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3BxLWNvbmZpZ3VyYXRvci1zZXJpYWxpemVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vZmVhdHVyZS1saWJzL3Byb2R1Y3QtY29uZmlndXJhdG9yL3J1bGViYXNlZC9jcHEvcmVzdC9jb252ZXJ0ZXJzL2NwcS1jb25maWd1cmF0b3Itc2VyaWFsaXplci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBRUgsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMkNBQTJDLENBQUM7QUFFekUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sNkJBQTZCLENBQUM7O0FBRW5FLE1BQU0sZUFBZSxHQUFHLEdBQUcsQ0FBQztBQUc1QixNQUFNLE9BQU8seUJBQXlCO0lBR3BDLE9BQU8sQ0FBQyxNQUFrQztRQUN4QyxNQUFNLFNBQVMsR0FDYixvQkFBb0IsQ0FBQyx5QkFBeUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN6RCxJQUFJLGVBQW9DLENBQUM7UUFDekMsSUFBSSxNQUFNLENBQUMsVUFBVSxLQUFLLFlBQVksQ0FBQyxVQUFVLENBQUMsa0JBQWtCLEVBQUU7WUFDcEUsZUFBZSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUNwRTthQUFNO1lBQ0wsZUFBZSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ3JFO1FBQ0QsT0FBTyxlQUFlLENBQUM7SUFDekIsQ0FBQztJQUVTLGVBQWUsQ0FDdkIsU0FBaUMsRUFDakMsUUFBZ0I7UUFFaEIsTUFBTSxpQkFBaUIsR0FDckIsb0JBQW9CLENBQUMsb0JBQW9CLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFdkQsTUFBTSxlQUFlLEdBQXdCO1lBQzND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QUUsRUFBRTtnQkFDL0IsUUFBUSxJQUFJLEtBQUssQ0FBQyxTQUFTLEdBQUcsZUFBZSxDQUFDO1lBQ2hELENBQUMsQ0FBQyxDQUFDO1NBQ0o7YUFBTTtZQUNMLGtDQUFrQztZQUNsQyxRQUFRLEdBQUcsZUFBZSxDQUFDO1NBQzVCO1FBQ0QsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQzs7c0hBL0ZVLHlCQUF5QjswSEFBekIseUJBQXlCOzJGQUF6Qix5QkFBeUI7a0JBRHJDLFVBQVUiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICogU1BEWC1GaWxlQ29weXJpZ2h0VGV4dDogMjAyMiBTQVAgU3BhcnRhY3VzIHRlYW0gPHNwYXJ0YWN1cy10ZWFtQHNhcC5jb20+XG4gKlxuICogU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IEFwYWNoZS0yLjBcbiAqL1xuXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDb252ZXJ0ZXIgfSBmcm9tICdAc3BhcnRhY3VzL2NvcmUnO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yIH0gZnJvbSAnQHNwYXJ0YWN1cy9wcm9kdWN0LWNvbmZpZ3VyYXRvci9ydWxlYmFzZWQnO1xuaW1wb3J0IHsgQ3BxIH0gZnJvbSAnLi4vY3BxLm1vZGVscyc7XG5pbXBvcnQgeyBDcHFDb25maWd1cmF0b3JVdGlscyB9IGZyb20gJy4vLi4vY3BxLWNvbmZpZ3VyYXRvci11dGlscyc7XG5cbmNvbnN0IFZBTFVFX1NFUEFSQVRPUiA9ICcsJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIENwcUNvbmZpZ3VyYXRvclNlcmlhbGl6ZXJcbiAgaW1wbGVtZW50cyBDb252ZXJ0ZXI8Q29uZmlndXJhdG9yLkNvbmZpZ3VyYXRpb24sIENwcS5VcGRhdGVBdHRyaWJ1dGU+XG57XG4gIGNvbnZlcnQoc291cmNlOiBDb25maWd1cmF0b3IuQ29uZmlndXJhdGlvbik6IENwcS5VcGRhdGVBdHRyaWJ1dGUge1xuICAgIGNvbnN0IGF0dHJpYnV0ZTogQ29uZmlndXJhdG9yLkF0dHJpYnV0ZSA9XG4gICAgICBDcHFDb25maWd1cmF0b3JVdGlscy5maW5kRmlyc3RDaGFuZ2VkQXR0cmlidXRlKHNvdXJjZSk7XG4gICAgbGV0IHVwZGF0ZUF0dHJpYnV0ZTogQ3BxLlVwZGF0ZUF0dHJpYnV0ZTtcbiAgICBpZiAoc291cmNlLnVwZGF0ZVR5cGUgPT09IENvbmZpZ3VyYXRvci5VcGRhdGVUeXBlLkFUVFJJQlVURV9RVUFOVElUWSkge1xuICAgICAgdXBkYXRlQXR0cmlidXRlID0gdGhpcy5jb252ZXJ0UXVhbnRpdHkoYXR0cmlidXRlLCBzb3VyY2UuY29uZmlnSWQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB1cGRhdGVBdHRyaWJ1dGUgPSB0aGlzLmNvbnZlcnRBdHRyaWJ1dGUoYXR0cmlidXRlLCBzb3VyY2UuY29uZmlnSWQpO1xuICAgIH1cbiAgICByZXR1cm4gdXBkYXRlQXR0cmlidXRlO1xuICB9XG5cbiAgcHJvdGVjdGVkIGNvbnZlcnRRdWFudGl0eShcbiAgICBhdHRyaWJ1dGU6IENvbmZpZ3VyYXRvci5BdHRyaWJ1dGUsXG4gICAgY29uZmlnSWQ6IHN0cmluZ1xuICApOiBDcHEuVXBkYXRlQXR0cmlidXRlIHtcbiAgICBjb25zdCB1cGRhdGVJbmZvcm1hdGlvbiA9XG4gICAgICBDcHFDb25maWd1cmF0b3JVdGlscy5nZXRVcGRhdGVJbmZvcm1hdGlvbihhdHRyaWJ1dGUpO1xuXG4gICAgY29uc3QgdXBkYXRlQXR0cmlidXRlOiBDcHEuVXBkYXRlQXR0cmlidXRlID0ge1xuICAgICAgY29uZmlndXJhdGlvbklkOiBjb25maWdJZCxcbiAgICAgIHN0YW5kYXJkQXR0cmlidXRlQ29kZTogdXBkYXRlSW5mb3JtYXRpb24uc3RhbmRhcmRBdHRyaWJ1dGVDb2RlLFxuICAgICAgY2hhbmdlQXR0cmlidXRlVmFsdWU6IHsgcXVhbnRpdHk6IGF0dHJpYnV0ZS5xdWFudGl0eSB9LFxuICAgICAgdGFiSWQ6IHVwZGF0ZUluZm9ybWF0aW9uLnRhYklkLFxuICAgIH07XG4gICAgcmV0dXJuIHVwZGF0ZUF0dHJpYnV0ZTtcbiAgfVxuXG4gIHByb3RlY3RlZCBjb252ZXJ0QXR0cmlidXRlKFxuICAgIGF0dHJpYnV0ZTogQ29uZmlndXJhdG9yLkF0dHJpYnV0ZSxcbiAgICBjb25maWd1cmF0aW9uSWQ6IHN0cmluZ1xuICApOiBDcHEuVXBkYXRlQXR0cmlidXRlIHtcbiAgICBjb25zdCB1cGRhdGVJbmZvcm1hdGlvbiA9XG4gICAgICBDcHFDb25maWd1cmF0b3JVdGlscy5nZXRVcGRhdGVJbmZvcm1hdGlvbihhdHRyaWJ1dGUpO1xuICAgIGNvbnN0IHVwZGF0ZUF0dHJpYnV0ZTogQ3BxLlVwZGF0ZUF0dHJpYnV0ZSA9IHtcbiAgICAgIGNvbmZpZ3VyYXRpb25JZDogY29uZmlndXJhdGlvbklkLFxuICAgICAgc3RhbmRhcmRBdHRyaWJ1dGVDb2RlOiB1cGRhdGVJbmZvcm1hdGlvbi5zdGFuZGFyZEF0dHJpYnV0ZUNvZGUsXG4gICAgICBjaGFuZ2VBdHRyaWJ1dGVWYWx1ZToge30sXG4gICAgICB0YWJJZDogdXBkYXRlSW5mb3JtYXRpb24udGFiSWQsXG4gICAgfTtcblxuICAgIGlmIChcbiAgICAgIGF0dHJpYnV0ZS51aVR5cGUgPT09IENvbmZpZ3VyYXRvci5VaVR5cGUuRFJPUERPV04gfHxcbiAgICAgIGF0dHJpYnV0ZS51aVR5cGUgPT09IENvbmZpZ3VyYXRvci5VaVR5cGUuRFJPUERPV05fUFJPRFVDVCB8fFxuICAgICAgYXR0cmlidXRlLnVpVHlwZSA9PT0gQ29uZmlndXJhdG9yLlVpVHlwZS5SQURJT0JVVFRPTiB8fFxuICAgICAgYXR0cmlidXRlLnVpVHlwZSA9PT0gQ29uZmlndXJhdG9yLlVpVHlwZS5SQURJT0JVVFRPTl9QUk9EVUNUIHx8XG4gICAgICBhdHRyaWJ1dGUudWlUeXBlID09PSBDb25maWd1cmF0b3IuVWlUeXBlLlNJTkdMRV9TRUxFQ1RJT05fSU1BR0VcbiAgICApIHtcbiAgICAgIHVwZGF0ZUF0dHJpYnV0ZS5jaGFuZ2VBdHRyaWJ1dGVWYWx1ZS5hdHRyaWJ1dGVWYWx1ZUlkcyA9XG4gICAgICAgIHRoaXMucHJvY2Vzc1NlbGVjdGVkU2luZ2xlVmFsdWUoYXR0cmlidXRlLnNlbGVjdGVkU2luZ2xlVmFsdWUpO1xuICAgIH0gZWxzZSBpZiAoXG4gICAgICBhdHRyaWJ1dGUudWlUeXBlID09PSBDb25maWd1cmF0b3IuVWlUeXBlLkNIRUNLQk9YTElTVCB8fFxuICAgICAgYXR0cmlidXRlLnVpVHlwZSA9PT0gQ29uZmlndXJhdG9yLlVpVHlwZS5DSEVDS0JPWExJU1RfUFJPRFVDVCB8fFxuICAgICAgYXR0cmlidXRlLnVpVHlwZSA9PT0gQ29uZmlndXJhdG9yLlVpVHlwZS5DSEVDS0JPWCB8fFxuICAgICAgYXR0cmlidXRlLnVpVHlwZSA9PT0gQ29uZmlndXJhdG9yLlVpVHlwZS5NVUxUSV9TRUxFQ1RJT05fSU1BR0VcbiAgICApIHtcbiAgICAgIHVwZGF0ZUF0dHJpYnV0ZS5jaGFuZ2VBdHRyaWJ1dGVWYWx1ZS5hdHRyaWJ1dGVWYWx1ZUlkcyA9XG4gICAgICAgIHRoaXMucHJlcGFyZVZhbHVlSWRzKGF0dHJpYnV0ZSk7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIGF0dHJpYnV0ZS51aVR5cGUgPT09IENvbmZpZ3VyYXRvci5VaVR5cGUuU1RSSU5HIHx8XG4gICAgICBhdHRyaWJ1dGUudWlUeXBlID09PSBDb25maWd1cmF0b3IuVWlUeXBlLk5VTUVSSUNcbiAgICApIHtcbiAgICAgIHVwZGF0ZUF0dHJpYnV0ZS5jaGFuZ2VBdHRyaWJ1dGVWYWx1ZS51c2VySW5wdXQgPSBhdHRyaWJ1dGUudXNlcklucHV0O1xuICAgICAgaWYgKCF1cGRhdGVBdHRyaWJ1dGUuY2hhbmdlQXR0cmlidXRlVmFsdWU/LnVzZXJJbnB1dCkge1xuICAgICAgICB1cGRhdGVBdHRyaWJ1dGUuY2hhbmdlQXR0cmlidXRlVmFsdWUudXNlcklucHV0ID0gJyAnO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdXBkYXRlQXR0cmlidXRlO1xuICB9XG5cbiAgcHJvdGVjdGVkIHByb2Nlc3NTZWxlY3RlZFNpbmdsZVZhbHVlKHNpbmdsZVZhbHVlPzogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBsZXQgcHJvY2Vzc2VkVmFsdWUgPSBzaW5nbGVWYWx1ZTtcbiAgICBpZiAoIXByb2Nlc3NlZFZhbHVlKSB7XG4gICAgICAvLyBJcyByZXF1aXJlZCB0byByZW1vdmUgdGhlIHZhbHVlXG4gICAgICBwcm9jZXNzZWRWYWx1ZSA9IFZBTFVFX1NFUEFSQVRPUjtcbiAgICB9XG4gICAgcmV0dXJuIHByb2Nlc3NlZFZhbHVlO1xuICB9XG5cbiAgcHJvdGVjdGVkIHByZXBhcmVWYWx1ZUlkcyhhdHRyaWJ1dGU6IENvbmZpZ3VyYXRvci5BdHRyaWJ1dGUpOiBzdHJpbmcge1xuICAgIGxldCB2YWx1ZUlkcyA9ICcnO1xuICAgIGNvbnN0IHNlbGVjdGVkVmFsdWVzID0gYXR0cmlidXRlLnZhbHVlcz8uZmlsdGVyKCh2YWx1ZSkgPT4gdmFsdWUuc2VsZWN0ZWQpO1xuXG4gICAgaWYgKHNlbGVjdGVkVmFsdWVzICYmIHNlbGVjdGVkVmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgIHNlbGVjdGVkVmFsdWVzLmZvckVhY2goKHZhbHVlKSA9PiB7XG4gICAgICAgIHZhbHVlSWRzICs9IHZhbHVlLnZhbHVlQ29kZSArIFZBTFVFX1NFUEFSQVRPUjtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJcyByZXF1aXJlZCB0byByZW1vdmUgdGhlIHZhbHVlXG4gICAgICB2YWx1ZUlkcyA9IFZBTFVFX1NFUEFSQVRPUjtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlSWRzO1xuICB9XG59XG4iXX0=