/*
 * SPDX-FileCopyrightText: 2022 SAP Spartacus team <spartacus-team@sap.com>
 *
 * SPDX-License-Identifier: Apache-2.0
 */
import { Injectable } from '@angular/core';
import { createEffect, ofType } from '@ngrx/effects';
import { CartActions } from '@spartacus/cart/base/core';
import { normalizeHttpError } from '@spartacus/core';
import { of } from 'rxjs';
import { catchError, map, switchMap } from 'rxjs/operators';
import { ConfiguratorTextfieldActions } from '../actions/index';
import * as i0 from "@angular/core";
import * as i1 from "@ngrx/effects";
import * as i2 from "../../connectors/configurator-textfield.connector";
export class ConfiguratorTextfieldEffects {
    constructor(actions$, configuratorTextfieldConnector) {
        this.actions$ = actions$;
        this.configuratorTextfieldConnector = configuratorTextfieldConnector;
        this.createConfiguration$ = createEffect(() => this.actions$.pipe(ofType(ConfiguratorTextfieldActions.CREATE_CONFIGURATION), map((action) => action.payload), switchMap((payload) => {
            return this.configuratorTextfieldConnector
                .createConfiguration(payload.productCode, payload.owner)
                .pipe(switchMap((configuration) => {
                return [
                    new ConfiguratorTextfieldActions.CreateConfigurationSuccess(configuration),
                ];
            }), catchError((error) => of(new ConfiguratorTextfieldActions.CreateConfigurationFail(normalizeHttpError(error)))));
        })));
        this.addToCart$ = createEffect(() => this.actions$.pipe(ofType(ConfiguratorTextfieldActions.ADD_TO_CART), map((action) => action.payload), switchMap((payload) => {
            return this.configuratorTextfieldConnector.addToCart(payload).pipe(switchMap(() => {
                return [
                    new ConfiguratorTextfieldActions.RemoveConfiguration(),
                    new CartActions.LoadCart({
                        cartId: payload.cartId,
                        userId: payload.userId,
                    }),
                ];
            }), catchError((error) => of(new ConfiguratorTextfieldActions.AddToCartFail(normalizeHttpError(error)))));
        })));
        this.updateCartEntry$ = createEffect(() => this.actions$.pipe(ofType(ConfiguratorTextfieldActions.UPDATE_CART_ENTRY_CONFIGURATION), map((action) => action.payload), switchMap((payload) => {
            return this.configuratorTextfieldConnector
                .updateConfigurationForCartEntry(payload)
                .pipe(switchMap(() => {
                return [
                    new ConfiguratorTextfieldActions.RemoveConfiguration(),
                    new CartActions.LoadCart({
                        cartId: payload.cartId,
                        userId: payload.userId,
                    }),
                ];
            }), catchError((error) => of(new ConfiguratorTextfieldActions.UpdateCartEntryConfigurationFail(normalizeHttpError(error)))));
        })));
        this.readConfigurationForCartEntry$ = createEffect(() => this.actions$.pipe(ofType(ConfiguratorTextfieldActions.READ_CART_ENTRY_CONFIGURATION), switchMap((action) => {
            const parameters = action.payload;
            return this.configuratorTextfieldConnector
                .readConfigurationForCartEntry(parameters)
                .pipe(switchMap((result) => [
                new ConfiguratorTextfieldActions.ReadCartEntryConfigurationSuccess(result),
            ]), catchError((error) => [
                new ConfiguratorTextfieldActions.ReadCartEntryConfigurationFail(normalizeHttpError(error)),
            ]));
        })));
        this.readConfigurationForOrderEntry$ = createEffect(() => this.actions$.pipe(ofType(ConfiguratorTextfieldActions.READ_ORDER_ENTRY_CONFIGURATION), switchMap((action) => {
            const parameters = action.payload;
            return this.configuratorTextfieldConnector
                .readConfigurationForOrderEntry(parameters)
                .pipe(switchMap((result) => [
                new ConfiguratorTextfieldActions.ReadOrderEntryConfigurationSuccess(result),
            ]), catchError((error) => [
                new ConfiguratorTextfieldActions.ReadOrderEntryConfigurationFail(normalizeHttpError(error)),
            ]));
        })));
    }
}
ConfiguratorTextfieldEffects.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: ConfiguratorTextfieldEffects, deps: [{ token: i1.Actions }, { token: i2.ConfiguratorTextfieldConnector }], target: i0.ɵɵFactoryTarget.Injectable });
ConfiguratorTextfieldEffects.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: ConfiguratorTextfieldEffects });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.2.3", ngImport: i0, type: ConfiguratorTextfieldEffects, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return [{ type: i1.Actions }, { type: i2.ConfiguratorTextfieldConnector }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmlndXJhdG9yLXRleHRmaWVsZC5lZmZlY3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9mZWF0dXJlLWxpYnMvcHJvZHVjdC1jb25maWd1cmF0b3IvdGV4dGZpZWxkL2NvcmUvc3RhdGUvZWZmZWN0cy9jb25maWd1cmF0b3ItdGV4dGZpZWxkLmVmZmVjdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBRUgsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQVcsWUFBWSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM5RCxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDeEQsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFckQsT0FBTyxFQUFjLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN0QyxPQUFPLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUc1RCxPQUFPLEVBQUUsNEJBQTRCLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQzs7OztBQUdoRSxNQUFNLE9BQU8sNEJBQTRCO0lBaUt2QyxZQUNVLFFBQWlCLEVBQ2pCLDhCQUE4RDtRQUQ5RCxhQUFRLEdBQVIsUUFBUSxDQUFTO1FBQ2pCLG1DQUE4QixHQUE5Qiw4QkFBOEIsQ0FBZ0M7UUFsS3hFLHlCQUFvQixHQUdoQixZQUFZLENBQUMsR0FBRyxFQUFFLENBQ3BCLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUNoQixNQUFNLENBQUMsNEJBQTRCLENBQUMsb0JBQW9CLENBQUMsRUFDekQsR0FBRyxDQUNELENBQUMsTUFBd0QsRUFBRSxFQUFFLENBQzNELE1BQU0sQ0FBQyxPQUFPLENBQ2pCLEVBQ0QsU0FBUyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUU7WUFDcEIsT0FB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LDRCQUE0QjtrQkFEeEMsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBTUERYLUZpbGVDb3B5cmlnaHRUZXh0OiAyMDIyIFNBUCBTcGFydGFjdXMgdGVhbSA8c3BhcnRhY3VzLXRlYW1Ac2FwLmNvbT5cbiAqXG4gKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuICovXG5cbmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFjdGlvbnMsIGNyZWF0ZUVmZmVjdCwgb2ZUeXBlIH0gZnJvbSAnQG5ncngvZWZmZWN0cyc7XG5pbXBvcnQgeyBDYXJ0QWN0aW9ucyB9IGZyb20gJ0BzcGFydGFjdXMvY2FydC9iYXNlL2NvcmUnO1xuaW1wb3J0IHsgbm9ybWFsaXplSHR0cEVycm9yIH0gZnJvbSAnQHNwYXJ0YWN1cy9jb3JlJztcbmltcG9ydCB7IENvbW1vbkNvbmZpZ3VyYXRvciB9IGZyb20gJ0BzcGFydGFjdXMvcHJvZHVjdC1jb25maWd1cmF0b3IvY29tbW9uJztcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yLCBtYXAsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IENvbmZpZ3VyYXRvclRleHRmaWVsZENvbm5lY3RvciB9IGZyb20gJy4uLy4uL2Nvbm5lY3RvcnMvY29uZmlndXJhdG9yLXRleHRmaWVsZC5jb25uZWN0b3InO1xuaW1wb3J0IHsgQ29uZmlndXJhdG9yVGV4dGZpZWxkIH0gZnJvbSAnLi4vLi4vbW9kZWwvY29uZmlndXJhdG9yLXRleHRmaWVsZC5tb2RlbCc7XG5pbXBvcnQgeyBDb25maWd1cmF0b3JUZXh0ZmllbGRBY3Rpb25zIH0gZnJvbSAnLi4vYWN0aW9ucy9pbmRleCc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBDb25maWd1cmF0b3JUZXh0ZmllbGRFZmZlY3RzIHtcbiAgY3JlYXRlQ29uZmlndXJhdGlvbiQ6IE9ic2VydmFibGU8XG4gICAgfCBDb25maWd1cmF0b3JUZXh0ZmllbGRBY3Rpb25zLkNyZWF0ZUNvbmZpZ3VyYXRpb25TdWNjZXNzXG4gICAgfCBDb25maWd1cmF0b3JUZXh0ZmllbGRBY3Rpb25zLkNyZWF0ZUNvbmZpZ3VyYXRpb25GYWlsXG4gID4gPSBjcmVhdGVFZmZlY3QoKCkgPT5cbiAgICB0aGlzLmFjdGlvbnMkLnBpcGUoXG4gICAgICBvZlR5cGUoQ29uZmlndXJhdG9yVGV4dGZpZWxkQWN0aW9ucy5DUkVBVEVfQ09ORklHVVJBVElPTiksXG4gICAgICBtYXAoXG4gICAgICAgIChhY3Rpb246IENvbmZpZ3VyYXRvclRleHRmaWVsZEFjdGlvbnMuQ3JlYXRlQ29uZmlndXJhdGlvbikgPT5cbiAgICAgICAgICBhY3Rpb24ucGF5bG9hZFxuICAgICAgKSxcbiAgICAgIHN3aXRjaE1hcCgocGF5bG9hZCkgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25maWd1cmF0b3JUZXh0ZmllbGRDb25uZWN0b3JcbiAgICAgICAgICAuY3JlYXRlQ29uZmlndXJhdGlvbihwYXlsb2FkLnByb2R1Y3RDb2RlLCBwYXlsb2FkLm93bmVyKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgc3dpdGNoTWFwKChjb25maWd1cmF0aW9uOiBDb25maWd1cmF0b3JUZXh0ZmllbGQuQ29uZmlndXJhdGlvbikgPT4ge1xuICAgICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICAgIG5ldyBDb25maWd1cmF0b3JUZXh0ZmllbGRBY3Rpb25zLkNyZWF0ZUNvbmZpZ3VyYXRpb25TdWNjZXNzKFxuICAgICAgICAgICAgICAgICAgY29uZmlndXJhdGlvblxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIF07XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIGNhdGNoRXJyb3IoKGVycm9yKSA9PlxuICAgICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgICBuZXcgQ29uZmlndXJhdG9yVGV4dGZpZWxkQWN0aW9ucy5DcmVhdGVDb25maWd1cmF0aW9uRmFpbChcbiAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvcilcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgfSlcbiAgICApXG4gICk7XG5cbiAgYWRkVG9DYXJ0JDogT2JzZXJ2YWJsZTxcbiAgICB8IENvbmZpZ3VyYXRvclRleHRmaWVsZEFjdGlvbnMuUmVtb3ZlQ29uZmlndXJhdGlvblxuICAgIHwgQ29uZmlndXJhdG9yVGV4dGZpZWxkQWN0aW9ucy5BZGRUb0NhcnRGYWlsXG4gICAgfCBDYXJ0QWN0aW9ucy5Mb2FkQ2FydFxuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKENvbmZpZ3VyYXRvclRleHRmaWVsZEFjdGlvbnMuQUREX1RPX0NBUlQpLFxuICAgICAgbWFwKChhY3Rpb246IENvbmZpZ3VyYXRvclRleHRmaWVsZEFjdGlvbnMuQWRkVG9DYXJ0KSA9PiBhY3Rpb24ucGF5bG9hZCksXG4gICAgICBzd2l0Y2hNYXAoKHBheWxvYWQpID0+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlndXJhdG9yVGV4dGZpZWxkQ29ubmVjdG9yLmFkZFRvQ2FydChwYXlsb2FkKS5waXBlKFxuICAgICAgICAgIHN3aXRjaE1hcCgoKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgICBuZXcgQ29uZmlndXJhdG9yVGV4dGZpZWxkQWN0aW9ucy5SZW1vdmVDb25maWd1cmF0aW9uKCksXG4gICAgICAgICAgICAgIG5ldyBDYXJ0QWN0aW9ucy5Mb2FkQ2FydCh7XG4gICAgICAgICAgICAgICAgY2FydElkOiBwYXlsb2FkLmNhcnRJZCxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHBheWxvYWQudXNlcklkLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIF07XG4gICAgICAgICAgfSksXG4gICAgICAgICAgY2F0Y2hFcnJvcigoZXJyb3IpID0+XG4gICAgICAgICAgICBvZihcbiAgICAgICAgICAgICAgbmV3IENvbmZpZ3VyYXRvclRleHRmaWVsZEFjdGlvbnMuQWRkVG9DYXJ0RmFpbChcbiAgICAgICAgICAgICAgICBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9KVxuICAgIClcbiAgKTtcblxuICB1cGRhdGVDYXJ0RW50cnkkOiBPYnNlcnZhYmxlPFxuICAgIHwgQ29uZmlndXJhdG9yVGV4dGZpZWxkQWN0aW9ucy5SZW1vdmVDb25maWd1cmF0aW9uXG4gICAgfCBDb25maWd1cmF0b3JUZXh0ZmllbGRBY3Rpb25zLlVwZGF0ZUNhcnRFbnRyeUNvbmZpZ3VyYXRpb25GYWlsXG4gICAgfCBDYXJ0QWN0aW9ucy5Mb2FkQ2FydFxuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKENvbmZpZ3VyYXRvclRleHRmaWVsZEFjdGlvbnMuVVBEQVRFX0NBUlRfRU5UUllfQ09ORklHVVJBVElPTiksXG4gICAgICBtYXAoXG4gICAgICAgIChhY3Rpb246IENvbmZpZ3VyYXRvclRleHRmaWVsZEFjdGlvbnMuVXBkYXRlQ2FydEVudHJ5Q29uZmlndXJhdGlvbikgPT5cbiAgICAgICAgICBhY3Rpb24ucGF5bG9hZFxuICAgICAgKSxcbiAgICAgIHN3aXRjaE1hcCgocGF5bG9hZCkgPT4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25maWd1cmF0b3JUZXh0ZmllbGRDb25uZWN0b3JcbiAgICAgICAgICAudXBkYXRlQ29uZmlndXJhdGlvbkZvckNhcnRFbnRyeShwYXlsb2FkKVxuICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgc3dpdGNoTWFwKCgpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgICAgICBuZXcgQ29uZmlndXJhdG9yVGV4dGZpZWxkQWN0aW9ucy5SZW1vdmVDb25maWd1cmF0aW9uKCksXG4gICAgICAgICAgICAgICAgbmV3IENhcnRBY3Rpb25zLkxvYWRDYXJ0KHtcbiAgICAgICAgICAgICAgICAgIGNhcnRJZDogcGF5bG9hZC5jYXJ0SWQsXG4gICAgICAgICAgICAgICAgICB1c2VySWQ6IHBheWxvYWQudXNlcklkLFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcikgPT5cbiAgICAgICAgICAgICAgb2YoXG4gICAgICAgICAgICAgICAgbmV3IENvbmZpZ3VyYXRvclRleHRmaWVsZEFjdGlvbnMuVXBkYXRlQ2FydEVudHJ5Q29uZmlndXJhdGlvbkZhaWwoXG4gICAgICAgICAgICAgICAgICBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgIH0pXG4gICAgKVxuICApO1xuXG4gIHJlYWRDb25maWd1cmF0aW9uRm9yQ2FydEVudHJ5JDogT2JzZXJ2YWJsZTxcbiAgICB8IENvbmZpZ3VyYXRvclRleHRmaWVsZEFjdGlvbnMuUmVhZENhcnRFbnRyeUNvbmZpZ3VyYXRpb25TdWNjZXNzXG4gICAgfCBDb25maWd1cmF0b3JUZXh0ZmllbGRBY3Rpb25zLlJlYWRDYXJ0RW50cnlDb25maWd1cmF0aW9uRmFpbFxuICA+ID0gY3JlYXRlRWZmZWN0KCgpID0+XG4gICAgdGhpcy5hY3Rpb25zJC5waXBlKFxuICAgICAgb2ZUeXBlKENvbmZpZ3VyYXRvclRleHRmaWVsZEFjdGlvbnMuUkVBRF9DQVJUX0VOVFJZX0NPTkZJR1VSQVRJT04pLFxuICAgICAgc3dpdGNoTWFwKFxuICAgICAgICAoYWN0aW9uOiBDb25maWd1cmF0b3JUZXh0ZmllbGRBY3Rpb25zLlJlYWRDYXJ0RW50cnlDb25maWd1cmF0aW9uKSA9PiB7XG4gICAgICAgICAgY29uc3QgcGFyYW1ldGVyczogQ29tbW9uQ29uZmlndXJhdG9yLlJlYWRDb25maWd1cmF0aW9uRnJvbUNhcnRFbnRyeVBhcmFtZXRlcnMgPVxuICAgICAgICAgICAgYWN0aW9uLnBheWxvYWQ7XG5cbiAgICAgICAgICByZXR1cm4gdGhpcy5jb25maWd1cmF0b3JUZXh0ZmllbGRDb25uZWN0b3JcbiAgICAgICAgICAgIC5yZWFkQ29uZmlndXJhdGlvbkZvckNhcnRFbnRyeShwYXJhbWV0ZXJzKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgIHN3aXRjaE1hcCgocmVzdWx0OiBDb25maWd1cmF0b3JUZXh0ZmllbGQuQ29uZmlndXJhdGlvbikgPT4gW1xuICAgICAgICAgICAgICAgIG5ldyBDb25maWd1cmF0b3JUZXh0ZmllbGRBY3Rpb25zLlJlYWRDYXJ0RW50cnlDb25maWd1cmF0aW9uU3VjY2VzcyhcbiAgICAgICAgICAgICAgICAgIHJlc3VsdFxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcikgPT4gW1xuICAgICAgICAgICAgICAgIG5ldyBDb25maWd1cmF0b3JUZXh0ZmllbGRBY3Rpb25zLlJlYWRDYXJ0RW50cnlDb25maWd1cmF0aW9uRmFpbChcbiAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZUh0dHBFcnJvcihlcnJvcilcbiAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICBdKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgKVxuICAgIClcbiAgKTtcblxuICByZWFkQ29uZmlndXJhdGlvbkZvck9yZGVyRW50cnkkOiBPYnNlcnZhYmxlPFxuICAgIHwgQ29uZmlndXJhdG9yVGV4dGZpZWxkQWN0aW9ucy5SZWFkT3JkZXJFbnRyeUNvbmZpZ3VyYXRpb25TdWNjZXNzXG4gICAgfCBDb25maWd1cmF0b3JUZXh0ZmllbGRBY3Rpb25zLlJlYWRPcmRlckVudHJ5Q29uZmlndXJhdGlvbkZhaWxcbiAgPiA9IGNyZWF0ZUVmZmVjdCgoKSA9PlxuICAgIHRoaXMuYWN0aW9ucyQucGlwZShcbiAgICAgIG9mVHlwZShDb25maWd1cmF0b3JUZXh0ZmllbGRBY3Rpb25zLlJFQURfT1JERVJfRU5UUllfQ09ORklHVVJBVElPTiksXG4gICAgICBzd2l0Y2hNYXAoXG4gICAgICAgIChhY3Rpb246IENvbmZpZ3VyYXRvclRleHRmaWVsZEFjdGlvbnMuUmVhZE9yZGVyRW50cnlDb25maWd1cmF0aW9uKSA9PiB7XG4gICAgICAgICAgY29uc3QgcGFyYW1ldGVyczogQ29tbW9uQ29uZmlndXJhdG9yLlJlYWRDb25maWd1cmF0aW9uRnJvbU9yZGVyRW50cnlQYXJhbWV0ZXJzID1cbiAgICAgICAgICAgIGFjdGlvbi5wYXlsb2FkO1xuXG4gICAgICAgICAgcmV0dXJuIHRoaXMuY29uZmlndXJhdG9yVGV4dGZpZWxkQ29ubmVjdG9yXG4gICAgICAgICAgICAucmVhZENvbmZpZ3VyYXRpb25Gb3JPcmRlckVudHJ5KHBhcmFtZXRlcnMpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgc3dpdGNoTWFwKChyZXN1bHQ6IENvbmZpZ3VyYXRvclRleHRmaWVsZC5Db25maWd1cmF0aW9uKSA9PiBbXG4gICAgICAgICAgICAgICAgbmV3IENvbmZpZ3VyYXRvclRleHRmaWVsZEFjdGlvbnMuUmVhZE9yZGVyRW50cnlDb25maWd1cmF0aW9uU3VjY2VzcyhcbiAgICAgICAgICAgICAgICAgIHJlc3VsdFxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgIF0pLFxuICAgICAgICAgICAgICBjYXRjaEVycm9yKChlcnJvcikgPT4gW1xuICAgICAgICAgICAgICAgIG5ldyBDb25maWd1cmF0b3JUZXh0ZmllbGRBY3Rpb25zLlJlYWRPcmRlckVudHJ5Q29uZmlndXJhdGlvbkZhaWwoXG4gICAgICAgICAgICAgICAgICBub3JtYWxpemVIdHRwRXJyb3IoZXJyb3IpXG4gICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICApXG4gICk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBhY3Rpb25zJDogQWN0aW9ucyxcbiAgICBwcml2YXRlIGNvbmZpZ3VyYXRvclRleHRmaWVsZENvbm5lY3RvcjogQ29uZmlndXJhdG9yVGV4dGZpZWxkQ29ubmVjdG9yXG4gICkge31cbn1cbiJdfQ==